<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><title>Kategorie: frontend - Learning &amp; Sharing</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Learning &amp; Sharing"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Learning &amp; Sharing"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Learning &amp;amp; Sharing"><meta property="og:type" content="website"><meta property="og:title" content="Learning &amp; Sharing"><meta property="og:url" content="https://www.ddhigh.com/"><meta property="og:site_name" content="Learning &amp; Sharing"><meta property="og:description" content="Learning &amp;amp; Sharing"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.ddhigh.com/img/og_image.png"><meta property="article:author" content="Xia Lei"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://www.ddhigh.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ddhigh.com"},"headline":"Learning & Sharing","image":["https://www.ddhigh.com/img/og_image.png"],"author":{"@type":"Person","name":"Xia Lei"},"publisher":{"@type":"Organization","name":"Learning & Sharing","logo":{"@type":"ImageObject","url":{"text":"Learning & Sharing"}}},"description":"Learning &amp; Sharing"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.4.1/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?78141f99bbb49f1564a7af89344f5add";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Learning &amp; Sharing</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Suche" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">Kategorien</a></li><li class="is-active"><a href="#" aria-current="page">frontend</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-11-14T03:00:00.000Z" title="11/14/2019, 3:00:00 AM">2019-11-14</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">4 minutes lesen (Über 622 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/14/2019-11-13-es6-iterator.html">深入浅出ES6的迭代器</a></p><div class="content"><p>迭代器是ES2015中新增的规范，与之相关的for…of也是ES2015新增的。</p>
<p>本文来深入研究一下迭代器是什么，以及迭代器能够干什么？</p>
<p>或许你对for … of的执行还不了解，比如什么情况下可以使用for … of去遍历对象，什么情况下会报错等等，这篇文章应该能帮到你。</p>
<h2 id="迭代器协议"><a href="#迭代器协议" class="headerlink" title="迭代器协议"></a>迭代器协议</h2><blockquote>
<p> for … of只能迭代满足【迭代器协议】的对象</p>
</blockquote>
<p>可迭代对象的必须存在[Symbol.iterator]方法，该方法一个无参函数，返回迭代器协议的对象。</p>
<p>迭代器对象包含一个<code>next()</code>函数，该函数返回值有两种:</p>
<ul>
<li><p>如果迭代未结束，返回如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;item&#x27;</span>, <span class="comment">// item是本次迭代值，可以为任意对象</span></span><br><span class="line">  <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果迭代已结束，返回如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>下面是未提供迭代器的示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> item <span class="keyword">of</span> obj) &#123; <span class="comment">// TypeError: obj is not iterable</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是提供迭代器的示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]: <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// 迭代器属性</span></span><br><span class="line">        <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>); <span class="comment">// 读取对象键列表</span></span><br><span class="line">        <span class="keyword">let</span> keyIndex = <span class="number">0</span>; <span class="comment">// 遍历未知</span></span><br><span class="line">        <span class="keyword">const</span> self = <span class="variable language_">this</span>; <span class="comment">// 保存this，next中的function会有自己的this</span></span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="comment">// 返回带有next()的对象</span></span><br><span class="line">            <span class="attr">next</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (keyIndex &lt; keys.<span class="property">length</span>) &#123; <span class="comment">// 防止越界</span></span><br><span class="line">                    <span class="keyword">const</span> key = keys[keyIndex];</span><br><span class="line">                    keyIndex++; <span class="comment">// 移动到下一个位置</span></span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        <span class="attr">value</span>: [key, self[key]], <span class="comment">// 键值对数组</span></span><br><span class="line">                        <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> &#123; <span class="comment">// 遍历结束</span></span><br><span class="line">                    <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>通过给obj提供迭代器方法让obj也可以使用for…of遍历。</p>
<p>直接去理解迭代器概念比较困难，用一个简单的例子去简化理解是一件很容易的事情。</p>
<h2 id="其他可迭代对象"><a href="#其他可迭代对象" class="headerlink" title="其他可迭代对象"></a>其他可迭代对象</h2><p><code>String</code>,<code>Array</code>,<code>Map</code>,<code>Set</code>,<code>TypedArray</code>是所有内置的可迭代对象，他们的原型对象都有一个[Symbol.iterator]方法。</p>
<p>下面是两种方法迭代String对象的示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for ... of</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xialei&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> char <span class="keyword">of</span> str) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(char);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// iterator</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xialei&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> iterator = str[<span class="title class_">Symbol</span>.<span class="property">iterator</span>](); <span class="comment">// 返回一个&#123;next:方法&#125;对象</span></span><br><span class="line"><span class="keyword">let</span> obj = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    obj = iterator.<span class="title function_">next</span>(); <span class="comment">// 返回的是对象，&#123;value:任意对象,done:布尔型&#125;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">value</span>);</span><br><span class="line">&#125;<span class="keyword">while</span>(!obj.<span class="property">done</span>);</span><br></pre></td></tr></table></figure>

<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>迭代器协议虽然一般用的比较少，但是了解其原理是非常有必要的，这样才可以才需要的实现定义自己的迭代器来遍历对象。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-11-04T04:00:00.000Z" title="11/4/2019, 4:00:00 AM">2019-11-04</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">14 minutes lesen (Über 2128 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/04/2019-11-04-es6-proxy.html">深入浅出ES6的标准内置对象Proxy</a></p><div class="content"><p>Proxy是ES6规范定义的标准内置对象，可以对目标对象的读取、函数调用等操作进行拦截。一般来说，通过Proxy可以让目标对象“可控”，比如是否能调用对象的某个方法，能否往对象添加属性等等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> originalObj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> publicObj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(originalObj, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">        <span class="comment">// 将属性值转化为大写</span></span><br><span class="line">        target[prop] = value.<span class="title function_">toString</span>().<span class="title function_">toUpperCase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">publicObj.<span class="property">name</span> = <span class="string">&#x27;xialei&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(publicObj.<span class="property">name</span>); <span class="comment">// XIALEI</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>从上例可以看出Proxy不需要更改目标对象(也就是originalObj)，就可以对originalObj的行为进行拦截。</p>
</blockquote>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><blockquote>
<p>let obj &#x3D; new Proxy(target, handler);</p>
</blockquote>
<ul>
<li>target <code>Object</code> 目标对象。可以是任何类型的对象，甚至包括原生对象（比如数组，函数，另一个Proxy对象）</li>
<li>handler <code>Object</code> 代理行为对象。访问目标对象时会自动触发该handler的对应属性。</li>
</ul>
<p>和大多数开发者一样，刚开始学习Proxy的时候，这个handler不知道是个什么东西，什么时候能触发。</p>
<p>先看一个简单的例子，看看handler到底是什么东西。假设我们开发一个游戏脚本，由于内存修改器的盛行，我们需要对内存中的数据进行安全处理，但是不能影响外部使用，我们使用Proxy完成这个功能。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gameObj = &#123;</span><br><span class="line">    <span class="attr">hp</span>: <span class="number">0</span></span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> publicGameObj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(gameObj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> target[prop]/<span class="number">2</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">      target[prop] = value*<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  publicGameObj.<span class="property">hp</span> = <span class="number">10000</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(publicGameObj.<span class="property">hp</span>, gameObj); <span class="comment">// 10000 &#123;hp: 20000&#125;</span></span><br></pre></td></tr></table></figure>

<p>gameObj是我们在内存中真实存储数据的地方，可以看到HP是20000，但是publicGameObj.hp是10000，外部使用publicGameObj.hp即可(比如UI层展示HP为10000);</p>
<h3 id="例程handler使用到的属性"><a href="#例程handler使用到的属性" class="headerlink" title="例程handler使用到的属性"></a>例程handler使用到的属性</h3><ul>
<li>get <code>publicGameObj.hp</code>进行了读取操作，因此会自动触发handler的get方法</li>
<li>set <code>publicGameObj.hp=10000</code>进行了赋值操作，因此为自动触发handler的set方法</li>
</ul>
<h2 id="handler对象"><a href="#handler对象" class="headerlink" title="handler对象"></a>handler对象</h2><p>handler对象是Proxy的核心基础，所有对目标对象的操作都需要通过handler来处理，虽然内容有点多，但是常用的不多。</p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul>
<li>目标对象 被代理的对象。外部不能直接访问(当然语法上是可以访问的，你都用上Proxy了，还访问他干嘛?)</li>
<li>代理对象 new Proxy的返回值。外部直接访问。目标对象会作为handler对应函数的参数传入</li>
<li>带*号的是常用属性</li>
</ul>
<blockquote>
<p>所有访问都是对代理对象访问才会触发，直接访问目标对象不会触发(代理对象压根没参与进来，如果触发那一定是出bug了)</p>
</blockquote>
<h3 id="handler-getPrototypeOf-target"><a href="#handler-getPrototypeOf-target" class="headerlink" title="handler.getPrototypeOf(target)"></a>handler.getPrototypeOf(target)</h3><p>说明：获取目标对象的原型</p>
<p>触发时机：Object.getPrototypeOf(代理对象)</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>Object</code> 对象的原型</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [];</span><br><span class="line"><span class="keyword">const</span> myArray = <span class="keyword">new</span> <span class="title class_">Proxy</span>(array, &#123;</span><br><span class="line">  <span class="title function_">getPrototypeOf</span>(<span class="params">target</span>) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取对象原型&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(array);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(myArray));</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// 读取对象原型</span></span><br><span class="line"><span class="comment">// []</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-setPrototypeOf-target-prototype"><a href="#handler-setPrototypeOf-target-prototype" class="headerlink" title="handler.setPrototypeOf(target, prototype)"></a>handler.setPrototypeOf(target, prototype)</h3><p>说明：设置对象的原型</p>
<p>触发时机：Object.setPrototypeOf(代理对象, 原型)<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prototype <code>Object</code> 原型对象或null</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 设置成功返回true，否则返回false(比如不让设置)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [];</span><br><span class="line"><span class="keyword">const</span> myArray = <span class="keyword">new</span> <span class="title class_">Proxy</span>(array, &#123;</span><br><span class="line">    <span class="title function_">setPrototypeOf</span>(<span class="params">target, prototype</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(target, prototype);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(myArray, <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(myArray)); <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-isExtensible-target"><a href="#handler-isExtensible-target" class="headerlink" title="handler.isExtensible(target)"></a>handler.isExtensible(target)</h3><p>说明：检测对象是否可扩展(个人理解：也就是能否添加属性、函数)<br>触发时机：Object.isExtensible(代理对象)<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
</ul>
<p>返回参数：</p>
<ul>
<li><code>boolean</code></li>
</ul>
<h3 id="handler-preventExtensions-target"><a href="#handler-preventExtensions-target" class="headerlink" title="handler.preventExtensions(target)"></a>handler.preventExtensions(target)</h3><p>说明：设置目标对象为不可扩展<br>触发时机：Object.preventExtensions(代理对象)<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 设置目标对象不可扩展后返回true，不管是否设置目标对象不可扩展，返回false都会报错</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">preventExtensions</span>(<span class="params">target</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">preventExtensions</span>(target);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">preventExtensions</span>(p);</span><br><span class="line"></span><br><span class="line">p.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p); <span class="comment">// &#123;&#125; 目标对象不可扩展，所以a属性设置不进去</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-getOwnPropertyDescriptor-target-prop"><a href="#handler-getOwnPropertyDescriptor-target-prop" class="headerlink" title="*handler.getOwnPropertyDescriptor(target, prop)"></a>*handler.getOwnPropertyDescriptor(target, prop)</h3><p>说明：获取目标对象属性的描述符</p>
<p>触发时机：Object.getOwnPropertyDescriptor(代理对象)</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>&lt;string|Symbol|number&gt;</code> 属性名</li>
</ul>
<p>返回参数：</p>
<ul>
<li><code>Object</code> 属性描述符</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">getOwnPropertyDescriptor</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> target[prop];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&#x27;a&#x27;</span>)); <span class="comment">// &#123; value: 1, writable: true, enumerable: true, configurable: true &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-defineProperty-target-prop-properties"><a href="#handler-defineProperty-target-prop-properties" class="headerlink" title="*handler.defineProperty(target,prop,properties)"></a>*handler.defineProperty(target,prop,properties)</h3><p>说明：在对象上定义属性(添加新属性或修改现有属性)<br>触发时机：Object.defineProperty(代理对象，属性名，属性描述对象)<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
<li>properties <code>Object</code> 属性描述对象</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 定义成功返回true，定义失败或不允许定义返回false</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">name2</span>: <span class="string">&#x27;xx&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">defineProperty</span>(<span class="params">target, prop, properties</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop === <span class="string">&#x27;name&#x27;</span>) &#123;</span><br><span class="line">            <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, prop, properties);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(p, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(p, <span class="string">&#x27;name2&#x27;</span>, &#123; <span class="comment">// TypeError</span></span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="handler-has-target-prop"><a href="#handler-has-target-prop" class="headerlink" title="*handler.has(target, prop)"></a>*handler.has(target, prop)</h3><p>说明：判断对象是否有指定属性<br>触发时机：prop in 代理对象<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code></li>
</ul>
<h3 id="handler-get-target-prop-receiver"><a href="#handler-get-target-prop-receiver" class="headerlink" title="*handler.get(target, prop, receiver)"></a>*handler.get(target, prop, receiver)</h3><p>说明: 属性读取器<br>触发时机：读取代理对象的属性时触发</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
<li>receiver <code>Proxy</code> 代理对象或者原型链上的代理对象</li>
</ul>
<p>返回值：</p>
<ul>
<li>任何值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="keyword">return</span> target[prop].<span class="title function_">toUpperCase</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>); <span class="comment">// XIALEI</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-set-target-prop-value-receiver"><a href="#handler-set-target-prop-value-receiver" class="headerlink" title="*handler.set(target, prop, value, receiver)"></a>*handler.set(target, prop, value, receiver)</h3><p>说明：属性写入访问器<br>触发时机：对代理对象的属性进行赋值时触发</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
<li>value <code>any</code> 属性值</li>
<li>receiver <code>Proxy</code> 代理对象或原型链上的代理对象</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 赋值成功返回true，否则返回false。严格模式下返回false会抛出TypeError</li>
</ul>
<h3 id="handler-deleteProperty-target-prop"><a href="#handler-deleteProperty-target-prop" class="headerlink" title="*handler.deleteProperty(target, prop)"></a>*handler.deleteProperty(target, prop)</h3><p>说明：删除对象属性<br>触发时机：对代理对象的属性进行delete时触发</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 删除成功返回true，否则返回false。严格模式下返回false会抛出TypeError</li>
</ul>
<h3 id="handler-apply-target-thisArg-args"><a href="#handler-apply-target-thisArg-args" class="headerlink" title="*handler.apply(target, thisArg, args)"></a>*handler.apply(target, thisArg, args)</h3><p>说明：拦截函数调用，被代理对象必须是函数<br>触发时机：</p>
<ul>
<li>直接调用函数 obj.xxx()或xxx()</li>
<li>apply&#x2F;call</li>
</ul>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标函数</li>
<li>thisArg <code>Object</code> this对象</li>
<li>args <code>Array</code> 参数列表</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>any</code> 任何值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> absSum = <span class="keyword">new</span> <span class="title class_">Proxy</span>(sum, &#123;</span><br><span class="line">    <span class="title function_">apply</span>(<span class="params">target, thisArg, args</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> value = target.<span class="title function_">apply</span>(thisArg, args);</span><br><span class="line">        <span class="keyword">return</span> value &lt; <span class="number">0</span> ? -value : value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">absSum</span>(-<span class="number">1</span>, -<span class="number">2</span>)); <span class="comment">// 3，因为被拦截了</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-construct-target-args"><a href="#handler-construct-target-args" class="headerlink" title="*handler.construct(target,args)"></a>*handler.construct(target,args)</h3><p>说明：拦截构造过程<br>触发时机：new 目标构造函数(…args)</p>
<p>参数：</p>
<ul>
<li>target <code>Function</code> 构造函数</li>
<li>args <code>Array</code> 构造函数的参数</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>Object</code> 对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> P = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="title class_">Person</span>, &#123;</span><br><span class="line">    <span class="title function_">construct</span>(<span class="params">target, args, newTarget</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(newTarget, newTarget === P, newTarget === <span class="title class_">Person</span>); <span class="comment">// [Function: Person] true false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">target</span>(args[<span class="number">0</span>].<span class="title function_">toUpperCase</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title function_">P</span>(<span class="string">&#x27;xialei&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p); <span class="comment">// Person &#123; name: &#x27;XIALEI&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li><p>保护目标对象(通过钩子方法进行拦截)</p>
</li>
<li><p>数据转换(上文有一个内存保护的例子)</p>
</li>
<li><p>数据验证(不符合规则的值不允许设置)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> privateUser = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">phone</span>: <span class="string">&#x27;13888888888&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(privateUser, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop === <span class="string">&#x27;phone&#x27;</span> &amp;&amp; !<span class="regexp">/^(\+86)?1[\d]&#123;10&#125;$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        target[prop] = value;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">user.<span class="property">phone</span> = <span class="string">&#x27;13666666666&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">phone</span>); <span class="comment">// 13666666666</span></span><br><span class="line">user.<span class="property">phone</span> = <span class="string">&#x27;+8613777777777&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">phone</span>); <span class="comment">// +8613777777777</span></span><br><span class="line">user.<span class="property">phone</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">phone</span>); <span class="comment">// +8613777777777</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>数据修正(也做数据标准化)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> privateUser = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">phone</span>: <span class="string">&#x27;13888888888&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(privateUser, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop === <span class="string">&#x27;phone&#x27;</span> &amp;&amp; !<span class="regexp">/^(\+86)?1[\d]&#123;10&#125;$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        target[prop] = value.<span class="title function_">replace</span>(<span class="string">&#x27;+86&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">user.<span class="property">phone</span> = <span class="string">&#x27;+8613666666666&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">phone</span>); <span class="comment">// 13666666666</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加实用方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>, <span class="attr">phone</span>: <span class="string">&#x27;13888888888&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;xialei1&#x27;</span>, <span class="attr">phone</span>: <span class="string">&#x27;13899999999&#x27;</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mList = <span class="keyword">new</span> <span class="title class_">Proxy</span>(list, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="keyword">return</span> target[prop];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> target) &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">name</span> === prop) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> firstItem = mList[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">const</span> itemXialei = mList[<span class="string">&quot;xialei&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(firstItem); <span class="comment">// &#123; name: &#x27;xialei&#x27;, phone: &#x27;13888888888&#x27; &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(itemXialei);<span class="comment">// &#123; name: &#x27;xialei&#x27;, phone: &#x27;13888888888&#x27; &#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>提供易用API</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 本例对localStorage做了封装，可以像普通对象一样操作localStorage,而不需要调用方法</span></span><br><span class="line"><span class="keyword">const</span> storage = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="variable language_">localStorage</span>, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(prop);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(prop, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">deleteProperty</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(prop);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">has</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(prop) !== <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">storage.<span class="property">aaa</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(storage.<span class="property">aaa</span>); <span class="comment">// &#x27;1&#x27;</span></span><br><span class="line"><span class="keyword">delete</span> storage.<span class="property">aaa</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(storage.<span class="property">aaa</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Proxy的语法虽然简单，但是可谓前途无量，比如开了一个Virtual Dom框架也是可以的。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-31T04:00:00.000Z" title="10/31/2019, 4:00:00 AM">2019-10-31</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">4 minutes lesen (Über 541 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/31/2019-10-31-es6-set.html">ES6的Set类型</a></p><div class="content"><p>本文内容</p>
<ul>
<li>Set的基本使用</li>
<li>常用用法</li>
</ul>
<blockquote>
<p>Set 对象允许你存储任何类型的唯一值，无论是原始值或者是对象引用。</p>
</blockquote>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Set</span>([iterator])</span><br></pre></td></tr></table></figure>

<ul>
<li>iterator <Iterator> 与Map类似，Set接收一个可选的Iterator对象，所有元素将按照顺序不重复地添加到Set中。传递null或者undefined将返回一个空Set</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line"><span class="comment">// 添加元素</span></span><br><span class="line">set.<span class="title function_">add</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 移除元素</span></span><br><span class="line">set.<span class="title function_">delete</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 检测元素是否存在</span></span><br><span class="line">set.<span class="title function_">has</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 清空Set</span></span><br><span class="line">set.<span class="title function_">clear</span>();</span><br></pre></td></tr></table></figure>

<h2 id="数据类型的唯一性判定"><a href="#数据类型的唯一性判定" class="headerlink" title="数据类型的唯一性判定"></a>数据类型的唯一性判定</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(<span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line">set.</span><br><span class="line">    <span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>).<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>).</span><br><span class="line">    <span class="title function_">add</span>(<span class="number">1</span>).<span class="title function_">add</span>(<span class="number">1</span>).</span><br><span class="line">    <span class="title function_">add</span>(<span class="literal">true</span>).<span class="title function_">add</span>(<span class="literal">true</span>).</span><br><span class="line">    <span class="title function_">add</span>(<span class="literal">null</span>).<span class="title function_">add</span>(<span class="literal">null</span>).</span><br><span class="line">    <span class="title function_">add</span>(<span class="literal">undefined</span>).<span class="title function_">add</span>(<span class="literal">undefined</span>)</span><br><span class="line">    .<span class="title function_">add</span>(<span class="title class_">NaN</span>).<span class="title function_">add</span>(<span class="title class_">NaN</span>)</span><br><span class="line">    .<span class="title function_">add</span>(&#123;&#125;).<span class="title function_">add</span>(&#123;&#125;)</span><br><span class="line">    .<span class="title function_">add</span>([]).<span class="title function_">add</span>([])</span><br><span class="line">    .<span class="title function_">add</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;).<span class="title function_">add</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set);</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Set &#123;</span><br><span class="line">  &#x27;string&#x27;,</span><br><span class="line">  1,</span><br><span class="line">  true,</span><br><span class="line">  null,</span><br><span class="line">  undefined,</span><br><span class="line">  NaN,</span><br><span class="line">  &#123;&#125;,</span><br><span class="line">  &#123;&#125;,</span><br><span class="line">  [],</span><br><span class="line">  [],</span><br><span class="line">  [Function],</span><br><span class="line">  [Function]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><ul>
<li>string&#x2F;number&#x2F;boolean&#x2F;null&#x2F;undefined&#x2F;NaN是使用值判重<ul>
<li>NaN!&#x3D;&#x3D;NaN，但是Set也只会存一份，所以值判定应该不完全是用&#x3D;&#x3D;&#x3D;做的</li>
</ul>
</li>
<li>object&#x2F;array&#x2F;function等object类型使用引用判重</li>
</ul>
<h2 id="Set的迭代"><a href="#Set的迭代" class="headerlink" title="Set的迭代"></a>Set的迭代</h2><p>for…of</p>
<blockquote>
<p>由于Set实现了Symol.iteator方法，所以可以使用for…of迭代</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(<span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line">set.<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>).<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> v <span class="keyword">of</span> set.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forEach</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(<span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line">set.<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>).<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>);</span><br><span class="line"></span><br><span class="line">set.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>Set和数组相互转化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(array); <span class="comment">// 数组转化为set</span></span><br><span class="line"><span class="keyword">const</span> newArray = [...set]; <span class="comment">// set转化为数组</span></span><br></pre></td></tr></table></figure>

<p>去除字符串重复字符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="string">&#x27;aabbcc&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(s);</span><br><span class="line"><span class="keyword">const</span> newString = [...set].<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newString); <span class="comment">// abc</span></span><br></pre></td></tr></table></figure>

<p>数组去重</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(list);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([...set]); <span class="comment">// [1,2,3]</span></span><br></pre></td></tr></table></figure>

<p>并集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">const</span> set2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br><span class="line"><span class="keyword">const</span> set3 = <span class="keyword">new</span> <span class="title class_">Set</span>([...set], [...set2]); <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>交集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">const</span> set2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br><span class="line"><span class="keyword">const</span> set3 = <span class="keyword">new</span> <span class="title class_">Set</span>([...set].<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> set2.<span class="title function_">has</span>(item))); <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>差集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">const</span> set2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br><span class="line"><span class="keyword">const</span> set3 = <span class="keyword">new</span> <span class="title class_">Set</span>([...set2].<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> !set.<span class="title function_">has</span>(item))); <span class="comment">// [4], 注意set2和set的顺序</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在需要唯一性的场景中，Set使用起来比数组要方便许多，比如添加标签，这个肯定是不重复的，用Set去实现就可以省去重复判断之类的操作，可以专注业务逻辑。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-30T04:00:00.000Z" title="10/30/2019, 4:00:00 AM">2019-10-30</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">8 minutes lesen (Über 1270 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/30/2019-10-30-es6-map.html">ES6的Map类型</a></p><div class="content"><p>本文内容</p>
<ul>
<li>Map的基本使用</li>
<li>Map支持的数据类型</li>
<li>Map的迭代</li>
<li>Map与其他对象的转化</li>
</ul>
<p>在Map出现之前，要实现类似需求，只能使用Object，但是Object还是存在一些问题的。</p>
<ul>
<li>如果使用Object作为key存储在{}中，key最终是当做<code>[object Object]</code>来使用的</li>
<li>Object的keys是无序的</li>
<li>无法安全遍历Object</li>
<li>无法直接获取Object大小</li>
</ul>
<blockquote>
<p>Map 对象保存键值对。任何值(对象或者原始值) 都可以作为一个键或一个值。</p>
</blockquote>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Map</span>([iterator])</span><br></pre></td></tr></table></figure>

<ul>
<li>iterator <Iterator> 可以是一个数组或者其他iterator对象，其元素为键值对(如<code>[&#39;key&#39;, &#39;value&#39;]</code>)。</li>
<li>null或undefined不会生效，返回一个空的Map</li>
<li>非iterator会抛出错误 <code>TypeError: object is not iterable</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="comment">// Create</span></span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;xialei&#x27;</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;https://www.ddhigh.com&#x27;</span>);</span><br><span class="line"><span class="comment">// Update</span></span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;xialeistudio&#x27;</span>);</span><br><span class="line"><span class="comment">// Read</span></span><br><span class="line">map.<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="comment">// Delete</span></span><br><span class="line">map.<span class="title function_">delete</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="comment">// 清空</span></span><br><span class="line">map.<span class="title function_">clear</span>();</span><br><span class="line"><span class="comment">// map大小</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="property">size</span>);</span><br></pre></td></tr></table></figure>

<h2 id="数据类型测试"><a href="#数据类型测试" class="headerlink" title="数据类型测试"></a>数据类型测试</h2><p>JS中基本数据类型有string、number、boolean、null、undefined、symbol，复杂数据类型有object(包括object,array,function等)，还有个特殊的NaN(typeof结果是number)，分别对这些类型进行测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">const</span> sKey = <span class="string">&#x27;key&#x27;</span>,</span><br><span class="line">    nKey = <span class="number">1</span>,</span><br><span class="line">    bKey = <span class="literal">true</span>,</span><br><span class="line">    nullKey = <span class="literal">null</span>,</span><br><span class="line">    uKey = <span class="literal">undefined</span>,</span><br><span class="line">    symbolKey = <span class="title class_">Symbol</span>(<span class="string">&quot;key&quot;</span>),</span><br><span class="line">    oKey = &#123;&#125;,</span><br><span class="line">    ooKey = oKey,</span><br><span class="line">    aKey = [],</span><br><span class="line">    fKey = <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;,</span><br><span class="line">    nanKey = <span class="title class_">NaN</span>;</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">set</span>(sKey, <span class="string">&quot;string&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(nKey, <span class="string">&quot;number&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(bKey, <span class="string">&quot;boolean&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(nullKey, <span class="string">&quot;null&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(uKey, <span class="string">&quot;undefined&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(symbolKey, <span class="string">&quot;symbol&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(oKey, <span class="string">&quot;object&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(aKey, <span class="string">&quot;array&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(fKey, <span class="string">&quot;function&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(nanKey, <span class="string">&quot;NaN&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(sKey) === <span class="string">&quot;string&quot;</span>, map.<span class="title function_">get</span>(<span class="string">&quot;key&quot;</span>) === <span class="string">&quot;string&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(nKey) === <span class="string">&quot;number&quot;</span>, map.<span class="title function_">get</span>(<span class="number">1</span>) === <span class="string">&quot;number&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(bKey) === <span class="string">&quot;boolean&quot;</span>, map.<span class="title function_">get</span>(<span class="literal">true</span>) === <span class="string">&quot;boolean&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(nullKey) === <span class="string">&quot;null&quot;</span>, map.<span class="title function_">get</span>(<span class="literal">null</span>) === <span class="string">&quot;null&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(uKey) === <span class="string">&quot;undefined&quot;</span>, map.<span class="title function_">get</span>(<span class="literal">undefined</span>) === <span class="string">&quot;undefined&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(symbolKey) === <span class="string">&quot;symbol&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(oKey) === <span class="string">&quot;object&quot;</span>, map.<span class="title function_">get</span>(&#123;&#125;) === <span class="string">&quot;object&quot;</span>, map.<span class="title function_">get</span>(oKey) === map.<span class="title function_">get</span>(ooKey));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(aKey) === <span class="string">&quot;array&quot;</span>, map.<span class="title function_">get</span>([]) === <span class="string">&quot;array&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(fKey) === <span class="string">&quot;function&quot;</span>, map.<span class="title function_">get</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;) === <span class="string">&quot;function&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(nanKey) === <span class="string">&quot;NaN&quot;</span>, map.<span class="title function_">get</span>(<span class="title class_">NaN</span>) === <span class="string">&quot;NaN&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>输出如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Map &#123;</span><br><span class="line">  &#x27;key&#x27; =&gt; &#x27;string&#x27;,</span><br><span class="line">  1 =&gt; &#x27;number&#x27;,</span><br><span class="line">  true =&gt; &#x27;boolean&#x27;,</span><br><span class="line">  null =&gt; &#x27;null&#x27;,</span><br><span class="line">  undefined =&gt; &#x27;undefined&#x27;,</span><br><span class="line">  Symbol(key) =&gt; &#x27;symbol&#x27;,</span><br><span class="line">  &#123;&#125; =&gt; &#x27;object&#x27;,</span><br><span class="line">  [] =&gt; &#x27;array&#x27;,</span><br><span class="line">  [Function: fKey] =&gt; &#x27;function&#x27;,</span><br><span class="line">  NaN =&gt; &#x27;NaN&#x27;</span><br><span class="line">&#125;</span><br><span class="line">true true</span><br><span class="line">true true</span><br><span class="line">true true</span><br><span class="line">true true</span><br><span class="line">true true</span><br><span class="line">true</span><br><span class="line">true false true</span><br><span class="line">true false</span><br><span class="line">true false</span><br><span class="line">true true</span><br></pre></td></tr></table></figure>

<p>结论</p>
<ul>
<li>string&#x2F;number&#x2F;boolean&#x2F;null&#x2F;undefined&#x2F;NaN 按值存储，值一致即可访问</li>
<li>symbol必须是同一个Symbol才能访问，详见<a href="https://www.ddhigh.com/2019/10/28/symbol.html">深入浅出ES6的Symbol类型</a></li>
<li>object&#x2F;array&#x2F;function等Object类型按照引用访问，必须是同一个引用才可以访问</li>
<li>Map是<code>有序</code>的，按照插入顺序</li>
<li>Map.set方法支持链式操作</li>
</ul>
<h2 id="Map的迭代"><a href="#Map的迭代" class="headerlink" title="Map的迭代"></a>Map的迭代</h2><h4 id="for…of"><a href="#for…of" class="headerlink" title="for…of"></a>for…of</h4><p>同时迭代键值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [k, v] <span class="keyword">of</span> map) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 迭代器版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [k, v] <span class="keyword">of</span> map.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>迭代键</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">of</span> map.<span class="title function_">keys</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, map.<span class="title function_">get</span>(k));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 迭代器版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [k] <span class="keyword">of</span> map.<span class="title function_">entries</span>()) &#123; <span class="comment">// 解构赋值</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, map.<span class="title function_">get</span>(k));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>迭代值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> v <span class="keyword">of</span> map.<span class="title function_">values</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 迭代器版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [,v] <span class="keyword">of</span> map.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forEach()</p>
<blockquote>
<p>forEach方法的顺序是value, key，不是key, value!</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">forEach</span>(<span class="function">(<span class="params">value, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value, key);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Map与其他类型的转换"><a href="#Map与其他类型的转换" class="headerlink" title="Map与其他类型的转换"></a>Map与其他类型的转换</h2><h3 id="Map与Object"><a href="#Map与Object" class="headerlink" title="Map与Object"></a>Map与Object</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">site</span>: <span class="string">&#x27;https://www.ddhigh.com&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>(obj);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map);</span><br></pre></td></tr></table></figure>

<p>执行报错<code>TypeError: object is not iterable</code>，因为Object不是可迭代对象。</p>
<blockquote>
<p>可迭代对象：ES6新出的语法，对象或对象的原型链实现了Symbol.iterator方法，关于迭代器的内容将在下一篇文章中详细介绍</p>
</blockquote>
<p>我们给Object.prototype添加属性方法来支持迭代：</p>
<blockquote>
<p>warning: 正式代码请谨慎修改原型链!</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">site</span>: <span class="string">&#x27;https://www.ddhigh.com&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// Symbol.iterator可以理解为全局唯一的标识</span></span><br><span class="line">    <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">let</span> keyIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (keyIndex &lt; keys.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> key = keys[keyIndex++];</span><br><span class="line">                <span class="keyword">return</span> &#123; <span class="attr">value</span>: [key, obj[key]] &#125;; <span class="comment">// 迭代值</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span> &#125;; <span class="comment">// 迭代结束</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>(obj);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map);</span><br></pre></td></tr></table></figure>

<h3 id="Map与数组"><a href="#Map与数组" class="headerlink" title="Map与数组"></a>Map与数组</h3><blockquote>
<p>只支持[[key, value]]这种二维数组。二维数组的每一个元素包含key和value两个子元素</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;xialeistudio&#x27;</span>], [<span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;https://www.ddhigh.com&#x27;</span>]]);</span><br></pre></td></tr></table></figure>

<h3 id="Map与Map"><a href="#Map与Map" class="headerlink" title="Map与Map"></a>Map与Map</h3><blockquote>
<p>由于Map是可迭代对象，因此可以作为参数传给Map构造函数</p>
<p>两个Map的元素是一样的，不是Map不相等，因为不是同一个对象</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;xialeistudio&#x27;</span>], [<span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;https://www.ddhigh.com&#x27;</span>]]);</span><br><span class="line"><span class="keyword">const</span> map2 = <span class="keyword">new</span> <span class="title class_">Map</span>(map);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map === map2); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h3 id="Map的合并"><a href="#Map的合并" class="headerlink" title="Map的合并"></a>Map的合并</h3><blockquote>
<p>多个Map可以合并，相同key会被覆盖，规则为后面的覆盖前面的</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">2</span>]</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">const</span> map2 = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map3 = <span class="keyword">new</span> <span class="title class_">Map</span>([...map, ...map2]);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map3); <span class="comment">// Map &#123; 1 =&gt; 2, 2 =&gt; 2 &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Map的出现解决了传统object无法直接解决的问题，更好地向标准编程语言靠近(标准编程语言一般会提供Map集合)，使用的坑也比较少（比如没有object作为key时转换为[object Object]的问题）。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-28T04:00:00.000Z" title="10/28/2019, 4:00:00 AM">2019-10-28</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">7 minutes lesen (Über 1013 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/28/2019-10-28-symbol.html">深入浅出ES6的Symbol类型</a></p><div class="content"><h2 id="本文内容"><a href="#本文内容" class="headerlink" title="本文内容"></a>本文内容</h2><ul>
<li>JS基本数据类型种类</li>
<li>Symbol的主要用法, 全局Symbol的使用与检测</li>
<li>Symbol与其他基本类型转换时的规则</li>
</ul>
<p>ES6引入了一种新的原始数据类型，表示独一无二的值，最大的用处是作为对象属性的唯一标识符。</p>
<p>至此，Javascript拥有6种基本数据类型和一种复杂数据类型。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>基本类型</p>
<ul>
<li>string</li>
<li>number</li>
<li>boolean</li>
<li>undefined</li>
<li>null</li>
<li>symbol</li>
</ul>
<p>复杂类型</p>
<ul>
<li>object</li>
</ul>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Symbol</span>([description])</span><br></pre></td></tr></table></figure>

<ul>
<li>description 可选的描述，一般用在调试的时候作为区分，但是 <strong>不能用来访问Symbol</strong>。</li>
<li>该方法返回一个symbol值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="title class_">Symbol</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="title class_">Symbol</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> s3 = <span class="keyword">new</span> <span class="title class_">Symbol</span>(<span class="string">&#x27;test&#x27;</span>); <span class="comment">// TypeError</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s === s2); <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> s); <span class="comment">// symbol</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s.<span class="property">description</span>); <span class="comment">// test</span></span><br></pre></td></tr></table></figure>

<ul>
<li>每次调用Symbol()返回的值都是独一无二的，不管描述是否一致。</li>
<li><code>Symbol</code>不支持<code>new</code>调用</li>
<li>通过description属性可以获取到传入Symbol的描述性字符串</li>
</ul>
<h3 id="全局单例的Symbol"><a href="#全局单例的Symbol" class="headerlink" title="全局单例的Symbol"></a>全局单例的Symbol</h3><p>使用Symbol.for()可以创建全局单例的symbol值，语法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">for</span>([name])</span><br></pre></td></tr></table></figure>

<ul>
<li>name 可选的描述，建议传入，否则name会作为undefined传入</li>
</ul>
<ol>
<li>类似于单例模式，执行环境(一般是浏览器)内部维护了一个全局Symbol注册表，记录name和Symbol(name)关系</li>
<li>尝试通过name在该注册表查找对应symbol值，如果找到，则返回这个symbol值</li>
<li>如果没找到，则使用Symbol(name)创建一个symbol值，并记录该symbol值与name的关联关系，之后返回该symbol</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> name2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> name3 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name === name2); <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name2 === name3); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>全局Symbol映射关系中name是作为字符串来使用的，结构类似下面的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> globalSymbols = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用同样的字符串描述调用Symbol()和Symbol.for()获取到的symbol值不相等</p>
</li>
</ul>
<h3 id="查找是否为全局的单例Symbol"><a href="#查找是否为全局的单例Symbol" class="headerlink" title="查找是否为全局的单例Symbol"></a>查找是否为全局的单例Symbol</h3><p>使用Symbol.keyFor()可以检测给定的symbol值是否是全局单例的symbol(简单来说就是检测是否是Symbol.for()创建的)，语法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(symbol)</span><br></pre></td></tr></table></figure>

<ul>
<li>symbol 必传， 待检测的symbol值</li>
<li>如果给定的symbol值是通过Symbol.for()得到的，该方法返回传入symbol的字符串描述</li>
<li>如果给定的symbol值不是通过Symbol.for()得到的，该方法返回undefined</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="title class_">Symbol</span>(<span class="string">&#x27;s1&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;s2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(s)); <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(s2)); <span class="comment">// s2</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol与JSON-stringify"><a href="#Symbol与JSON-stringify" class="headerlink" title="Symbol与JSON.stringify"></a>Symbol与JSON.stringify</h3><blockquote>
<p>Symbol类型的属性不会参与JSON的序列化</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  [name]: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj)); <span class="comment">// &#123;&quot;data&quot;: 1&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol与for-…-in和for-…-of"><a href="#Symbol与for-…-in和for-…-of" class="headerlink" title="Symbol与for … in和for … of"></a>Symbol与for … in和for … of</h3><blockquote>
<p>Symbol类型的属性不会出现在for … in和for … of循环中</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  [name]: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> user) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(i, user[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 上述循环输出 data 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">of</span> user) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(i, user[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TypeError: user不是可迭代对象</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol与Object-keys-和Object-getOwnPropertyNames"><a href="#Symbol与Object-keys-和Object-getOwnPropertyNames" class="headerlink" title="Symbol与Object.keys()和Object.getOwnPropertyNames()"></a>Symbol与Object.keys()和Object.getOwnPropertyNames()</h3><blockquote>
<p>Symbol类型的属性不会出现在Object.keys()和Object.getOwnPropertyNames()返回结果中</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  [name]: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(user)); <span class="comment">// [&quot;data&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(user)); <span class="comment">// [&quot;data&quot;]</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol与Object-getOwnPropertySymbols"><a href="#Symbol与Object-getOwnPropertySymbols" class="headerlink" title="Symbol与Object.getOwnPropertySymbols()"></a>Symbol与Object.getOwnPropertySymbols()</h3><blockquote>
<p>Symbol类型的属性会出现在Object.Object.getOwnPropertySymbols()</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  [name]: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(user)); <span class="comment">// [Symbol(name)]</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol数据类型转换"><a href="#Symbol数据类型转换" class="headerlink" title="Symbol数据类型转换"></a>Symbol数据类型转换</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name + <span class="number">1</span>); <span class="comment">// TypeError</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(name)); <span class="comment">// 创建包装对象</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name + <span class="string">&#x27;1&#x27;</span>); <span class="comment">// TypeError</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">String</span>(name)); <span class="comment">// Symbol(1)</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(!!name); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Boolean</span>(name)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>symbol值不能转换为数字</li>
<li>symbol不能直接转换为字符串，需要通过String包装才能转化</li>
<li>symbol可以直接转换为boolean，转化后为true</li>
</ul>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><ul>
<li>使用Symbol最大的注意事项应该是使用方括号语法去访问对应的属性，而不是字符串。</li>
<li>Symbol数据类型转换规范比较简单，大部分场景下也没用拿Symbol去做数据转换</li>
</ul>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"><img src="https://static.ddhigh.com/blog/2021-02-25-112206-2.png" alt="image-20210225112205987"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-22T04:00:00.000Z" title="10/22/2019, 4:00:00 AM">2019-10-22</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">7 minutes lesen (Über 1018 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/22/2019-10-22-let-and-const.html">不只是块级作用域，你不知道的let和const</a></p><div class="content"><p>ES6新增了两个重要的关键字<code>let</code>和<code>const</code>，相信大家都不陌生，但是包括我在内，在系统学习ES6之前也只使用到了【不存在变量提升】这个特性。</p>
<ul>
<li><strong>let</strong>声明一个块级作用域的本地变量</li>
<li><strong>const</strong>语句声明一个块级作用域的本地常量，不可以重新赋值</li>
</ul>
<h2 id="支持块级作用域"><a href="#支持块级作用域" class="headerlink" title="支持块级作用域"></a>支持块级作用域</h2><p><code>var</code>定义的变量会提升到整个函数作用域内，<code>let/const</code>则支持块级作用域。</p>
<blockquote>
<p>块级作用域: 由<code>&#123;&#125;</code>包裹的作用域（函数那种{}不算）</p>
</blockquote>
<p>来看一个<code>var</code>的例子:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure>

<p>此时输出1，因为<code>var</code>没有块级作用域。</p>
<p>来看一个<code>let</code>的例子(<code>const</code>效果一样):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure>

<p>此时会报错<code>ReferenceError</code>，因为<code>let/const</code>支持块级作用域，所以<code>let</code>定义的<code>a</code>只在<code>&#123;&#125;</code>可以访问</p>
<h2 id="不存在变量提升"><a href="#不存在变量提升" class="headerlink" title="不存在变量提升"></a>不存在变量提升</h2><p>与<code>var</code>不同的是，<code>let/const</code>声明的变量不存在变量提升，也就是说<code>&#123;&#125;</code>对于<code>let/const</code>是有效的。</p>
<p>来看一个<code>var</code>的例子:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>此时会输出undefined，因为var声明的变量会提升到作用域顶部（只提升声明，不提升赋值）</p>
<p>来看一个<code>let</code>的例子(<code>const</code>效果也一样):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时会报错<code>ReferenceError</code>，因为<code>let</code>不存在变量提升</p>
<h2 id="同一作用域内不可以重复声明"><a href="#同一作用域内不可以重复声明" class="headerlink" title="同一作用域内不可以重复声明"></a>同一作用域内不可以重复声明</h2><p>同一作用域内<code>let/const</code>不可以重复声明,<code>var</code>可以。</p>
<p>来看一个<code>var</code>的例子:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure>

<p>此时会输出2，var是支持重复声明的，后面声明的值会覆盖前面声明的值。</p>
<p>来看一个<code>let</code>的例子(<code>const</code>效果也一样):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure>

<p>此时会报错<code>SyntaxError</code>，因为同一作用域内<code>let/const</code>不可以重复声明。</p>
<p>再来看一个不同作用域的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">let</span> a = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a);</span><br></pre></td></tr></table></figure>

<p>此时输出1，因为两者作用域不同</p>
<h2 id="暂存死区"><a href="#暂存死区" class="headerlink" title="暂存死区"></a>暂存死区</h2><p>**暂存死区TDZ(Temporal Dead Zone)**是ES6中对作用域新的语义。</p>
<p>通过<code>let/const</code>定义的变量直到执行他们的初始化代码时才被初始化。在初始化之前访问<code>该变量</code>会导致<code>ReferenceError</code>。该变量处于<code>一个自作用域顶部到初始化代码</code>之间的“暂存死区”中。</p>
<p>来看以下例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">do_something</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(bar); <span class="comment">// undefined</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(foo); <span class="comment">// ReferenceError</span></span><br><span class="line">  <span class="keyword">var</span> bar = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">let</span> foo = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">do_something</span>();</span><br></pre></td></tr></table></figure>

<p><code>var</code>定义的变量声明会提升到作用域顶部，所以<code>bar</code>是undefined，而<code>let</code>定义的变量<code>从作用域开始到let foo=2</code>这中间都无法访问，访问会报错<code>ReferenceError</code></p>
<h2 id="暂存死区与typeof"><a href="#暂存死区与typeof" class="headerlink" title="暂存死区与typeof"></a>暂存死区与typeof</h2><p>typeof检测var定义的变量或者检测不存在的变量时会返回undefined，如果检测暂存死区内的变量，会报错<code>ReferenceError</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> foo); <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> bar); <span class="comment">// ReferenceError</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> bar2); <span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">let</span> bar = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> bar2 = <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p>也就是说typeof去检测未初始化的<code>let</code>变量时会报错，<code>var</code>或者未声明的变量不会报错</p>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="keyword">var</span> foo = <span class="number">33</span>;</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">let</span> foo = (foo + <span class="number">55</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>();</span><br></pre></td></tr></table></figure>

<p>以上函数执行结果是什么?为什么?</p>
<blockquote>
<p>报错</p>
<p><code>&#123;&#125;</code>内有<code>let</code>定义的<code>foo</code>，所以存在暂存死区，<code>(foo + 55)</code>这个表达式是在<code>let foo</code>之前执行的(赋值时先执行等号右边的，执行完毕把结果赋给等号左边)，表达式执行的时候还没有初始化foo，所以报错<code>ReferenceError</code></p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>let&#x2F;const支持函数作用域和块级作用域,var只有函数作用域</li>
<li>let&#x2F;const不存在变量提升，var存在变量提升</li>
<li>let&#x2F;const同一作用域内不可以重复声明，var可以重复声明</li>
<li>let&#x2F;const存在暂存死区，var不存在</li>
</ol>
<h2 id="面试题-1"><a href="#面试题-1" class="headerlink" title="面试题"></a>面试题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> b = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">test4</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(b);</span><br><span class="line">    <span class="keyword">let</span> b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test4</span>()</span><br></pre></td></tr></table></figure>

<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-15T04:00:00.000Z" title="10/15/2019, 4:00:00 AM">2019-10-15</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">12 minutes lesen (Über 1816 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/15/2019-10-15-valueof-and-tostring.html">聊一聊valueOf和toString</a></p><div class="content"><p>valueOf和toString是Object.prototype的方法。一般很少直接调用，但是在使用对象参与运算的时候就会调用这两个方法了。我想大部分人都存在以下疑问：</p>
<ul>
<li>valueOf和toString哪个优先级较高?</li>
<li>是不是所有场景都会调用valueOf和toString</li>
</ul>
<h2 id="概念解释"><a href="#概念解释" class="headerlink" title="概念解释"></a>概念解释</h2><ul>
<li>valueOf: 返回对象的原始值表示</li>
<li>toString: 返回对象的字符串表示</li>
</ul>
<p>在介绍下面的内容之前先了解一下转换规则，下面的内容解释都是基于这个规则表来的：</p>
<h3 id="valueOf转换规则"><a href="#valueOf转换规则" class="headerlink" title="valueOf转换规则"></a>valueOf转换规则</h3><p>valueOf是Object.prototype的方法，由Object来的对象都会有该方法，但是很多内置对象会重写这个方法，以适合实际需要。</p>
<p>说到原始值就必须说到原始类型，JS规范中 <strong>原始类型</strong> 如下：</p>
<ul>
<li>Boolean</li>
<li>Null</li>
<li>Undefined</li>
<li>Number</li>
<li>String</li>
</ul>
<p>非原始值(也就是对象)重写规则如下：</p>
<table>
<thead>
<tr>
<th>对象</th>
<th>valueOf返回值</th>
</tr>
</thead>
<tbody><tr>
<td>Array</td>
<td>数组本身</td>
</tr>
<tr>
<td>Boolean</td>
<td>布尔值</td>
</tr>
<tr>
<td>Date</td>
<td>返回毫秒形式的时间戳</td>
</tr>
<tr>
<td>Function</td>
<td>函数本身</td>
</tr>
<tr>
<td>Number</td>
<td>数字值</td>
</tr>
<tr>
<td>Object</td>
<td>对象本身</td>
</tr>
<tr>
<td>String</td>
<td>字符串值</td>
</tr>
</tbody></table>
<blockquote>
<p>以下规则是经过验证的，如果对验证过程不关心，可以只看转换规则。</p>
<p>建议看一下验证过程，这样可以加深理解</p>
</blockquote>
<h4 id="对象转换为布尔值"><a href="#对象转换为布尔值" class="headerlink" title="对象转换为布尔值"></a>对象转换为布尔值</h4><ol>
<li>直接转换为true（包装类型也一样），不调用valueOf和toString</li>
</ol>
<h4 id="对象转换为数字"><a href="#对象转换为数字" class="headerlink" title="对象转换为数字"></a>对象转换为数字</h4><p>在预期会将对象用作数字使用时，比如参与算术运算等等操作，对象转换为数字会依次调用valueOf和toString方法，具体规则如下：</p>
<ol>
<li>如果对象具有<code>valueOf</code>方法且返回原始值(string、number、boolean、undefined、null)，则将该原始值转换为数字(转换失败会返回NaN)，并返回这个数字</li>
<li>如果对象具有<code>toString</code>方法且返回原始值(string、number、boolean、undefined、null)，则将该原始值转换为数字(转换失败会返回NaN)，并返回这个数字</li>
<li>转换失败，抛出TypeError</li>
</ol>
<h4 id="对象转换为字符串"><a href="#对象转换为字符串" class="headerlink" title="对象转换为字符串"></a>对象转换为字符串</h4><ol>
<li>如果对象具有<code>toString</code>方法且返回原始值(string、number、boolean、undefined、null)，则将该原始值转换为字符串，并返回该字符串</li>
<li>如果对象具有<code>valueOf</code>方法且返回原始值(string、number、boolean、undefined、null)，则将该原始值转换为字符串，并返回该字符串</li>
<li>转换失败，抛出TypeError</li>
</ol>
<h3 id="toString转换规则"><a href="#toString转换规则" class="headerlink" title="toString转换规则"></a>toString转换规则</h3><table>
<thead>
<tr>
<th>对象</th>
<th>toString返回值</th>
</tr>
</thead>
<tbody><tr>
<td>Array</td>
<td>以逗号分割的字符串，如[1,2]的toString返回值为”1,2”</td>
</tr>
<tr>
<td>Boolean</td>
<td>“True”</td>
</tr>
<tr>
<td>Date</td>
<td>可读的时间字符串，如”Tue Oct 15 2019 12:20:56 GMT+0800 (中国标准时间)”</td>
</tr>
<tr>
<td>Function</td>
<td>声明函数的JS源代码字符串</td>
</tr>
<tr>
<td>Number</td>
<td>“数字值”</td>
</tr>
<tr>
<td>Object</td>
<td>“[object Object]”</td>
</tr>
<tr>
<td>String</td>
<td>“字符串”</td>
</tr>
</tbody></table>
<h2 id="验证对象到原始值的转换"><a href="#验证对象到原始值的转换" class="headerlink" title="验证对象到原始值的转换"></a>验证对象到原始值的转换</h2><p>光看valueOf和toString没啥东西可说，日常开发中也很少直接调用，但是当我们将对象当做原始值来使用时会发生转换，而且转换过程还略微有点迷糊。</p>
<h3 id="对象转换为Boolean"><a href="#对象转换为Boolean" class="headerlink" title="对象转换为Boolean"></a>对象转换为Boolean</h3><p>为了能够直观的看到JS内部的转换过程，我把valueOf和toString都简单重写了，加了日志。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存原始的valueOf</span></span><br><span class="line"><span class="keyword">var</span> valueOf = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>;</span><br><span class="line"><span class="keyword">var</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加valueOf日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;valueOf&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> valueOf.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 添加toString日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toString&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> toString.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (a) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(b) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上例子的输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>未调用valueOf和toString，符合[对象到布尔值]的转换规则</p>
</blockquote>
<h3 id="对象转换为Number"><a href="#对象转换为Number" class="headerlink" title="对象转换为Number"></a>对象转换为Number</h3><h4 id="例子1"><a href="#例子1" class="headerlink" title="例子1"></a>例子1</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存原始的valueOf</span></span><br><span class="line"><span class="keyword">var</span> valueOf = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>;</span><br><span class="line"><span class="keyword">var</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加valueOf日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;valueOf&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> valueOf.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 添加toString日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toString&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> toString.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(++a);</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">valueOf</span><br><span class="line">toString</span><br><span class="line">NaN</span><br></pre></td></tr></table></figure>

<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><ol>
<li>valueOf方法返回的是对象本身，不是原始值，继续执行</li>
<li>toString方法返回的是”[object Object]”，是原始值(字符串)，将字符串转换为数字NaN</li>
</ol>
<h4 id="例子2"><a href="#例子2" class="headerlink" title="例子2"></a>例子2</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存原始的valueOf</span></span><br><span class="line"><span class="keyword">var</span> valueOf = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>;</span><br><span class="line"><span class="keyword">var</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加valueOf日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;valueOf&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>; <span class="comment">// 强制返回原始值</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 添加toString日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toString&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> toString.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(++a);</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">valueOf</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<h4 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h4><ol>
<li>valueOf返回原始值(字符串)，直接将该字符串转换为数字，得到1</li>
</ol>
<h3 id="对象转换为字符串-1"><a href="#对象转换为字符串-1" class="headerlink" title="对象转换为字符串"></a>对象转换为字符串</h3><p>在预期会将对象用作字符串时，比如一个字符串拼接了字符串，传入了一个对象，此时会发生转换。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存原始的valueOf</span></span><br><span class="line"><span class="keyword">var</span> valueOf = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>;</span><br><span class="line"><span class="keyword">var</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加valueOf日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;valueOf&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> valueOf.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 添加toString日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toString&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> toString.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="title function_">alert</span>(a);</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">toString</span><br><span class="line">// 弹出[object Object]</span><br></pre></td></tr></table></figure>

<h4 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h4><ol>
<li>调用toString方法，返回了字符串”[object Object]”，对象最终转换为该字符串</li>
</ol>
<h4 id="例子2-1"><a href="#例子2-1" class="headerlink" title="例子2"></a>例子2</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存原始的valueOf</span></span><br><span class="line"><span class="keyword">var</span> valueOf = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>;</span><br><span class="line"><span class="keyword">var</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加valueOf日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;valueOf&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> valueOf.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 添加toString日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toString&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="title function_">alert</span>(a);</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">toString</span><br><span class="line">valueOf</span><br><span class="line">Uncaught TypeError: Cannot convert object to primitive value</span><br><span class="line">    at 1.js:16</span><br></pre></td></tr></table></figure>

<h4 id="分析-3"><a href="#分析-3" class="headerlink" title="分析"></a>分析</h4><ol>
<li>调用toString方法，返回的不是原始值，继续执行</li>
<li>调用valueOf方法，返回的不是原始值，继续执行</li>
<li>抛出TypeError</li>
</ol>
<p>##【番外】使用加号运算符连接字符串和对象时的处理</p>
<p>在测试对象到字符串转换时发现如下代码的表现和预期并不一致：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存原始的valueOf</span></span><br><span class="line"><span class="keyword">var</span> valueOf = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span>;</span><br><span class="line"><span class="keyword">var</span> toString = <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加valueOf日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;valueOf&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> valueOf.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 添加toString日志</span></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;toString&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> toString.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;a&quot;</span> + &#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">valueOf</span><br><span class="line">toString</span><br><span class="line">a[object Object]</span><br></pre></td></tr></table></figure>

<h3 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h3><p><code>&quot;a&quot;+ &#123;&#125;</code> 应该是预期把<code>&#123;&#125;</code>当做字符串使用，应该先调用toString方法的，实际情况却不是这样。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>通过查找资料得到的结论如下：</p>
<ol>
<li>如果有一个是对象，则遵循对象对原始值的转换过程(Date对象直接调用toString完成转换，其他对象通过valueOf转化，如果转换不成功则调用toString)</li>
<li>如果两个都是对象，两个对象都遵循步骤1转换到字符串</li>
<li>两个数字，进行算数运算</li>
<li>两个字符串，直接拼接</li>
<li>一个字符串一个数字，直接拼接为字符串</li>
</ol>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> c = &#123;&#125;;</span><br><span class="line">c[a] = <span class="number">1</span>;</span><br><span class="line">c[b] = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c[a]);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(c[b]);</span><br></pre></td></tr></table></figure>

<h3 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h3><p>由于对象的key是字符串，所以<code>c[a]</code>和<code>c[b]</code>中的<code>a</code>和<code>b</code>会执行[对象到字符串]的转换。</p>
<p>根据转换规则, <code>a</code>和<code>b</code>都转换为了<code>[object Object]</code>，所以<code>c[a]</code>和<code>c[b]</code>操作的是同一个键。</p>
<p>答案是<code>输出两个2</code>，c对象的最终结构如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&#x27;[object Object]&#x27;</span>:<span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://static.ddhigh.com/blog/2019-10-15-093620.jpg" alt="0.jpeg"></p>
<p><img src="https://static.ddhigh.com/blog/2021-02-25-113209-2.png" alt="image-20210225113209566"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-14T04:00:00.000Z" title="10/14/2019, 4:00:00 AM">2019-10-14</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">6 minutes lesen (Über 957 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/14/2019-10-14-js-Closure.html">搞懂JS闭包</a></p><div class="content"><p>闭包(Closure)是JS比较难懂的一个东西，或者说别人说的难以理解， 本文将以简洁的语言+面试题来深入浅出地介绍一下。</p>
<h2 id="作用域和作用域链"><a href="#作用域和作用域链" class="headerlink" title="作用域和作用域链"></a>作用域和作用域链</h2><p>在将闭包之前，需要先讲一下作用域。</p>
<p>JS中有全局作用域和局部作用域两种。</p>
<p>全局作用域任何地方都能访问，而局部作用于只有内部能访问。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> num = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(num);</span><br></pre></td></tr></table></figure>

<p>在上面的例子中会报错，num不存在。</p>
<blockquote>
<p>总结：函数外部无法访问函数内部的值</p>
</blockquote>
<p>当代码在一个作用域中执行时，JS引擎会默认创建一个作用域链(从当前作用域一直链接到全局作用域)。</p>
<p>在访问变量或者函数时，如果当前作用域查找不到，则向上级作用域查找，找到就返回，如果查找到全局作用域还没找到的话就报错。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> num = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">b</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上面的例子中，num是在<code>a</code>函数作用域下的局部变量，我们在<code>b</code>函数访问num时会有以下过程：</p>
<ol>
<li>在<code>b</code>的作用域查找num，发现找不到</li>
<li>往上一级作用域查找，发现num在<code>a</code>作用域，查找成功</li>
</ol>
<blockquote>
<p>总结：函数可以访问同级或上级作用域的值</p>
</blockquote>
<h2 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h2><p>当我们需要在函数外部访问函数内部的值时，闭包就产生了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">a</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> num = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">b</span> () &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bb = <span class="title function_">a</span>();</span><br><span class="line"><span class="title function_">bb</span>(); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在函数<code>a</code>的内部声明一个函数<code>b</code>，然后把<code>return b</code>，这个时候的<code>b()</code>函数就可以在外部访问，最终能够访问到num。</p>
</blockquote>
<p>简单来说：</p>
<blockquote>
<p>闭包就是函数内部的函数，上面的那个b就是闭包，可以在外面访问到内部的num</p>
</blockquote>
<h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 每隔1秒输出0-10的数字</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++) &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">  &#125;,<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 上面这段代码输出什么?如果需要修改为正确的情况，怎么修改？</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>1秒后输出10，因为setTimeout是到下一轮tick中执行，而for循环在当前这轮循环完毕后i的值已经是最后一个值了。需要使用闭包来保留现场</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    (<span class="keyword">function</span> (<span class="params">i</span>) &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;(i))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就是正常的输出了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;Window&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Object&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">f</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(object.<span class="title function_">f</span>()());</span><br></pre></td></tr></table></figure>

<p>答案是Window。</p>
<blockquote>
<p><code>object.getNameFunc()()</code>可以分开两部分来看。</p>
<ol>
<li>object.f()得到了一个这样的函数</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li><code>object.f()()</code>相当于执行上面那个函数，也就是<code>普通函数调用方式</code>，this指向<code>全局环境</code>，this指向搞不清楚的同学可以看看我之前发的<a href="https://www.ddhigh.com/2019/09/27/javascript-this.html">Javavscript基础——this指向</a></li>
<li>所以this.name也就是<code>var name = &quot;Window&quot;</code></li>
</ol>
</blockquote>
<p>还是那道题，不过我们把this保存一下，变成下面这种形式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;Window&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> object = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;Object&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="attr">f</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> that = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> that.<span class="property">name</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(object.<span class="title function_">f</span>()());</span><br></pre></td></tr></table></figure>

<p>答案是Object。</p>
<blockquote>
<ol>
<li>object.f()中调用时这个this指向object，当用变量保存时，这个that相当于object</li>
<li>object.f()()调用时，由于that相当于object，所以that.name就是object中的Object</li>
</ol>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>闭包可以在外部访问函数内部的变量</li>
<li>闭包可以保留现场</li>
</ol>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>来道面试题给大家看看吧</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> buttons = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.btn&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; buttons.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  buttons[i].<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上例子显示什么?如果需要正常显示需要怎么修改?</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-14-103646.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-11T04:00:00.000Z" title="10/11/2019, 4:00:00 AM">2019-10-11</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a></span><span class="level-item">15 minutes lesen (Über 2301 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/11/2019-10-11-https-protocol.html">HTTPS协议是如何保证安全的?</a></p><div class="content"><p>相信大家对于HTTPS协议都不陌生，但是应该存在以下疑问：</p>
<ol>
<li><p>HTTPS协议到底是如何运作的?</p>
</li>
<li><p>HTTPS是如何解决HTTP协议的不安全特性的?</p>
</li>
<li><p>HTTPS网站抓包为什么要信任证书?</p>
</li>
</ol>
<h2 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h2><p>HTTP协议是一个<strong>应用层</strong>协议，通常运行在TCP协议之上。它是一个<code>明文协议</code>，客户端发起请求，服务端给出响应的响应。</p>
<p>由于网络并不是可信任的，HTTP协议的明文特性会存在以下风险：</p>
<ul>
<li>通信数据有被窃听和被篡改的风险</li>
<li>目标网站有被冒充的风险</li>
</ul>
<p>一般的网站可能没什么影响，但是如果是银行这种网站呢?</p>
<p>好在国内的银行在HTTP协议时代针对IE开发了ActiveX插件来保证安全性，这一点算是值得点赞了。</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>既然HTTP协议是明文协议，如果对数据进行加密之后是否就能保证安全性了呢?</p>
<p>在回答这个问题之前，我们先看看比较常见的两种加密算法。</p>
<h3 id="加密算法"><a href="#加密算法" class="headerlink" title="加密算法"></a>加密算法</h3><p>常见的有对称加密算法和非对称加密算法。</p>
<p><strong>对称加密</strong></p>
<p>加密和解密使用同一个密钥。加解密效率比非对称加密高。但是密钥一旦泄露，通信就不安全了</p>
<p><strong>非对称加密</strong></p>
<p>存在密钥对，公钥加密私钥解密或者私钥加密公钥解密，无法通过公钥反推私钥，也无法通过私钥反推公钥。</p>
<blockquote>
<p>一般情况下，使用非对称加密来传输通信所用的密钥，通信过程中采用对称加密，可以解决对称加密的安全问题以及非对称加密的性能问题。</p>
</blockquote>
<h3 id="HTTP加密通信过程"><a href="#HTTP加密通信过程" class="headerlink" title="HTTP加密通信过程"></a>HTTP加密通信过程</h3><ol>
<li>浏览器生成随机串A作为通信密钥</li>
<li>浏览器使用公钥将随机串A加密后得到密文B发送给服务器，这一步是安全的，因为黑客没有服务端私钥无法解密</li>
<li>服务端利用私钥解密出随机串A得到通信密钥</li>
<li>服务端和客户端用随机串A以及对称加密算法进行通信</li>
</ol>
<p>这么一看似乎没有问题，毕竟黑客无法破解非对称加密的的内容，但是浏览器是如何得到公钥的?</p>
<p>有以下两种办法：</p>
<ol>
<li>浏览器内置(不太可能，网站域名这么多，浏览器内置这么多公钥不现实)</li>
<li>服务器给浏览器下发(由于是明文下发，存在被窃听和篡改风险，也就是著名的中间人攻击)</li>
</ol>
<h3 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h3><ol>
<li>浏览器请求服务器获取公钥</li>
<li>中间人劫持了服务器的公钥，保存在自己手里</li>
<li>中间人生成一对密钥对，把伪造的公钥下发给浏览器</li>
<li>浏览器使用伪造的公钥和中间人通信</li>
<li>中间人和服务器进行通信</li>
</ol>
<blockquote>
<p>由于浏览器使用了伪造的公钥进行通信，所以通信过程是不可靠的</p>
</blockquote>
<h3 id="需要解决的问题"><a href="#需要解决的问题" class="headerlink" title="需要解决的问题"></a>需要解决的问题</h3><p>只要保证浏览器得到的公钥是目标网站的公钥即可保证通信安全，那么问题来了，如何在不可靠的网络上安全的传输公钥呢?</p>
<p>这就是HTTPS协议需要解决的问题</p>
<h2 id="HTTPS协议"><a href="#HTTPS协议" class="headerlink" title="HTTPS协议"></a>HTTPS协议</h2><p>HTTPS协议涉及到的知识很多，本文只关注<strong>密钥安全交换部分</strong>，这也是HTTPS协议的精华。</p>
<p>HTTPS协议引入了<strong>CA</strong>和<strong>数字证书</strong>的概念。</p>
<h3 id="数字证书"><a href="#数字证书" class="headerlink" title="数字证书"></a>数字证书</h3><p>包含签发机构、有效期、申请人公钥、证书所有者、证书签名算法、证书指纹以及指纹算法等信息。</p>
<h3 id="CA"><a href="#CA" class="headerlink" title="CA"></a>CA</h3><p>数字证书签发机构，权威CA是受操作系统信任的，安装操作系统就会内置。</p>
<h3 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h3><p>用Hash算法对数据进行计算得到Hash值，利用私钥对该Hash加密得到签名。</p>
<p>只有匹配的公钥才能解密出签名，来保证签名是本人私钥签发的</p>
<h3 id="证书签发过程"><a href="#证书签发过程" class="headerlink" title="证书签发过程"></a>证书签发过程</h3><ol>
<li>网站生成密钥对，将私钥自己保存，公钥和网站域名等信息提交给CA</li>
<li>CA把证书签发机构(也就是自己)、证书有效期、网站的公钥、网站域名等信息以<strong>明文</strong>形式写入到一个文本文件</li>
<li>CA选择一个<strong>指纹算法</strong>(一般为hash算法)计算文本文件的内容得到<strong>指纹</strong>，用CA的<strong>私钥</strong>对<strong>指纹</strong>和<strong>指纹算法</strong>进行加密得到<strong>数字签名</strong>，签名算法包含在证书的<strong>明文</strong>部分</li>
<li>CA把明文证书、指纹、指纹算法、数字签名等信息打包在一起得到证书下发给服务器</li>
<li>此时服务器拥有了权威CA颁发的数字证书以及自己的私钥</li>
</ol>
<h3 id="证书验证过程"><a href="#证书验证过程" class="headerlink" title="证书验证过程"></a>证书验证过程</h3><p>浏览器是如何验证网站的有效性的呢?</p>
<ol>
<li>浏览器以HTTPS协议请求服务器的443端口</li>
<li>服务器下发自己的数字证书给浏览器(明文)</li>
<li>浏览器先校验CA、有效期、域名是否有效，如果无效，则终止连接(服务器此时不可信任)</li>
<li>如果有效，则从<strong>操作系统</strong>取出证书颁发机构的公钥，根据<strong>签名算法</strong>对<strong>数字签名</strong>解密得到<strong>证书指纹</strong>和<strong>指纹算法</strong></li>
<li>浏览器用解密得到的指纹算法计算证书的指纹，与解密得到的指纹进行比对，如果一致，证书有效，公钥也安全拿到了</li>
<li>浏览器此时已经和真实的服务器进行通信了，中间人无法得知通信内容，因为中间人没有网站私钥</li>
</ol>
<h3 id="问题是如何解决的"><a href="#问题是如何解决的" class="headerlink" title="问题是如何解决的"></a>问题是如何解决的</h3><ol>
<li><p>黑客冒充CA给了一个假证书给浏览器</p>
<blockquote>
<p>浏览器通过CA名称从操作系统取出CA公钥时对数字签名进行解密，发现解密失败，证明这个CA签名用的私钥和操作系统内置的不是一对，就发现了伪造</p>
</blockquote>
</li>
<li><p>黑客篡改了证书中的网站公钥</p>
<blockquote>
<p>证书中的网站公钥可以被篡改，但是数字签名是CA私钥计算出来的，黑客无法计算数字签名，浏览器用内置的CA公钥对数字签名解密时就会发现指纹不匹配了，这也发现了伪造</p>
</blockquote>
</li>
<li><p>黑客也能正常获取网站公钥</p>
<blockquote>
<p>的确，黑客自己通过浏览器访问网站时也能得到公钥，这个公钥跟正常用户的公钥是一致的。</p>
<p>但是每个客户端和服务器通信使用的对称密钥都是临时生成且随机的，黑客只能知道自己的随机密钥，但是不知道其他的随机密钥</p>
</blockquote>
</li>
</ol>
<p>综上，浏览器通过操作系统内置权威CA公钥的方式解决了网站公钥下发问题。</p>
<h2 id="HTTPS中间人攻击"><a href="#HTTPS中间人攻击" class="headerlink" title="HTTPS中间人攻击"></a>HTTPS中间人攻击</h2><p>HTTPS从协议上解决了HTTP时代的中间人攻击问题，但是HTTPS在用户主动信任了伪造证书的时候也会发生中间人攻击(比如早期的12306需要手动信任证书)，HTTPS中间人攻击流程如下：</p>
<ol>
<li>客户端用HTTPS连接服务器的443端口</li>
<li>服务器下发自己的数字证书给客户端</li>
<li>黑客劫持了服务器的真实证书，并伪造了一个假的证书给浏览器</li>
<li>浏览器可以发现得到的网站证书是假的，但是浏览器选择信任</li>
<li>浏览器生成随机对称密钥A，用伪造的证书中的公钥加密发往服务器</li>
<li>黑客同样可以劫持这个请求，得到浏览器的对称密钥A，从而能够窃听或者篡改通信数据</li>
<li>黑客利用服务器的真实公钥将客户端的对称密钥A加密发往服务器</li>
<li>服务器利用私钥解密这个对称密钥A之后与黑客通信</li>
<li>黑客利用对称密钥A解密服务器的数据，篡改之后利用对称密钥A加密发给客户端</li>
<li>客户端收到的数据已经是不安全的了</li>
</ol>
<blockquote>
<p>以上就是HTTPS中间人攻击的原理，这也就是HTTPS抓包为什么要信任证书的原因。</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>操作系统内置权威CA公钥来保证数字签名以及数字证书的安全性</li>
<li>实施HTTPS中间人攻击需要手动信任攻击者的假证书</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-09-27T04:00:00.000Z" title="9/27/2019, 4:00:00 AM">2019-09-27</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">13 minutes lesen (Über 1904 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/09/27/2019-09-27-javascript-this.html">Javavscript基础——this指向</a></p><div class="content"><p>本文研究一下Javascript的this指向。</p>
<p>Javascript的this指向问题，有些人可能觉得很简单，有些人却觉得扑朔迷离，看完本文之后相应会对this的掌握有一个直观的判断，而不是”开局全靠猜”。</p>
<h2 id="敲黑板"><a href="#敲黑板" class="headerlink" title="敲黑板"></a>敲黑板</h2><ol>
<li><p>function函数this指向由<code>调用方式</code>确定，跟定义环境无关。</p>
</li>
<li><p>箭头函数this指向由<code>定义环境</code>决定，与<code>调用方式无关</code>，也不可以<code>bind(this)</code>。</p>
</li>
</ol>
<h2 id="严格模式"><a href="#严格模式" class="headerlink" title="严格模式"></a>严格模式</h2><ol>
<li><p>非严格模式下，全局作用域下的this指向<code>window</code></p>
</li>
<li><p>严格模式下，全局作用域下的this指向<code>undefined</code></p>
</li>
</ol>
<p>以下讨论均为<code>非严格模式</code>，这个不影响今天的讨论。</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>说结论往往是让人难以理解的，下面通过不同的调用场景对this做一个说明。</p>
<h3 id="1-直接调用"><a href="#1-直接调用" class="headerlink" title="1. 直接调用"></a>1. 直接调用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">test</span>(); <span class="comment">// 输出undefined</span></span><br></pre></td></tr></table></figure>

<p>直接调用是最简单的， 大部分人在这里都能回答的很好。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><blockquote>
<p>直接调用时this指向<code>全局作用域</code>。</p>
<ul>
<li>非严格模式this指向window</li>
<li>严格模式this指向undefined</li>
</ul>
</blockquote>
<h3 id="2-对象调用"><a href="#2-对象调用" class="headerlink" title="2. 对象调用"></a>2. 对象调用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span></span><br><span class="line"><span class="keyword">var</span> n = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">n</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">n</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a.<span class="title function_">b</span>(); <span class="comment">// 输出2</span></span><br><span class="line"><span class="keyword">var</span> b = a.<span class="property">b</span>;</span><br><span class="line"><span class="title function_">b</span>(); <span class="comment">// 输出1</span></span><br></pre></td></tr></table></figure>

<h4 id="面试题：请问上述例子输出什么"><a href="#面试题：请问上述例子输出什么" class="headerlink" title="面试题：请问上述例子输出什么?"></a>面试题：请问上述例子输出什么?</h4><blockquote>
<p>非严格模式下，输出2和1，严格模式下输出2和一个报错(this指向undefined，访问undefined的n属性肯定报错)</p>
</blockquote>
<p>那如果你这么回答，<code>满分</code>!</p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>知其然还要知其所以然，我们分析一下：</p>
<p>为什么输出2?</p>
<blockquote>
<p> 因为<code>a.b()</code>是对象调用方式，所以b()中的this指向a</p>
</blockquote>
<p>为什么输出1?</p>
<p>这个非常有意思，而且也很有迷惑性，面试的时候经常问到，也经常有人被问倒。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> b = a.<span class="property">b</span></span><br></pre></td></tr></table></figure>

<p>把<code>a.b</code>赋值给<code>变量b</code>，b就是一个函数，<code>请注意: 这里只是赋值，没有调用，所以b中的this指向还不确定</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b();</span><br></pre></td></tr></table></figure>

<p>调用函数<code>b</code>，这是什么调用方式? **<code>普通调用</code>**，所以this指向全局作用域。</p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p>对象调用方式下this指向调用对象。</p>
<p>是否GET? 如果没有GET，请关注公众号<code>NodeJs之路</code>，我在线给你答疑。</p>
<p>开胃菜已经吃了，下面来点”有难度的(实际上也没啥难度)”。</p>
<h3 id="3-嵌套对象调用"><a href="#3-嵌套对象调用" class="headerlink" title="3. 嵌套对象调用"></a>3. 嵌套对象调用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">n</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">b</span>: &#123;</span><br><span class="line">    <span class="attr">n</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">n</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="面试题：请问上述例子中function中的this指向哪里"><a href="#面试题：请问上述例子中function中的this指向哪里" class="headerlink" title="面试题：请问上述例子中function中的this指向哪里?"></a>面试题：请问上述例子中function中的this指向哪里?</h4><blockquote>
<p>正确答案：<code>未确定调用环境</code>的情况下，this的指向<code>不确定</code>。</p>
<p>错误答案：指向a.b对象，Too young too simple!</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">n</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">b</span>: &#123;</span><br><span class="line">    <span class="attr">n</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="attr">c</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">n</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">a.<span class="property">b</span>.<span class="title function_">c</span>(); <span class="comment">// 输出3</span></span><br><span class="line"></span><br><span class="line">a.<span class="property">c</span> = a.<span class="property">b</span>.<span class="property">c</span>;</span><br><span class="line">a.<span class="title function_">c</span>(); <span class="comment">// 输出2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = a.<span class="property">b</span>.<span class="property">c</span>; </span><br><span class="line"><span class="title function_">c</span>(); <span class="comment">// 输出1</span></span><br></pre></td></tr></table></figure>

<p>这道题跟之前那道<code>对象调用</code>很像。</p>
<p>为什么输出3?</p>
<blockquote>
<p>对象调用方式下指向调用对象，a.b.c()中c()是通过<code>a.b</code>对象调用，指向对象<code>a.b</code></p>
</blockquote>
<p>为什么输出?</p>
<blockquote>
<p>a.c &#x3D; a.b.c 给a对象定义一个函数c，注意，此时没有调用！this指向不确定</p>
<p>a.c() 通过a对象来调用c()，所以this指向对象<code>a</code></p>
</blockquote>
<p>为什么输出1？</p>
<blockquote>
<p>var c &#x3D; a.b.c 函数赋值给普通变量，注意，此时没有调用!</p>
<p>c(); 普通方式调用，指向window</p>
</blockquote>
<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><p>嵌套对象调用方式下，this指向<code>最终调用</code>函数的对象。</p>
<p><code>a.b.c.d.e.f.g.h()</code> h函数中的this指向<code>a.b.c.d.e.f.g</code></p>
<h3 id="4-构造函数方式调用"><a href="#4-构造函数方式调用" class="headerlink" title="4. 构造函数方式调用"></a>4. 构造函数方式调用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p1= <span class="title class_">Person</span>(); <span class="comment">// p1为undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">name</span>); <span class="comment">// 报错</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p2 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p2.<span class="property">name</span>); <span class="comment">// 输出2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>p1为什么是undefined?</p>
<blockquote>
<p>这道题比较坑，跟调用方式和this指向无关，因为Person函数没有返回值，js中，默认会返回undefined.</p>
</blockquote>
<p>p2.name为什么是2?</p>
<blockquote>
<p>使用new操作符时，构造函数的返回值<code>默认</code>指向对象实例，所以p2.name就是Person()中的this.name</p>
</blockquote>
<p>如果在<code>Person()</code>函数中加上<code>return this</code>的话，<code>Person()</code>返回值还是<code>this</code>，因为这是普通调用。</p>
<h3 id="5-构造函数中指明返回值"><a href="#5-构造函数中指明返回值" class="headerlink" title="5. 构造函数中指明返回值"></a>5. 构造函数中指明返回值</h3><p>原则上构造函数不应该有返回值，但是如果真的写了会怎么样？我们来探讨一下。</p>
<h4 id="返回复杂对象"><a href="#返回复杂对象" class="headerlink" title="返回复杂对象"></a>返回复杂对象</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">name</span>)<span class="comment">// 输出undefined</span></span><br></pre></td></tr></table></figure>

<h4 id="返回简单对象"><a href="#返回简单对象" class="headerlink" title="返回简单对象"></a>返回简单对象</h4><p>虽然Js只有对象，但是有一些如string,number这种一般叫做简单对象,date,regex,array,object等等叫复杂对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">name</span>)<span class="comment">// 输出2</span></span><br></pre></td></tr></table></figure>

<h4 id="返回null"><a href="#返回null" class="headerlink" title="返回null"></a>返回null</h4><p>使用<code>typeof null</code>返回的是<code>[object]</code>，证明null是个对象，不过咱们来看看构造函数返回null的表现。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p1.<span class="property">name</span>)<span class="comment">// 输出2</span></span><br></pre></td></tr></table></figure>

<h4 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h4><p>构造函数中this指向对象实例本身，如果构造函数指明了返回值，那么表现如下：</p>
<ul>
<li>返回普通值，this指向不变，还是对象实例本身</li>
<li>返回复杂对象，this指向新对象，也就是你new Person()返回的是那个新对象</li>
</ul>
<h3 id="6-bind"><a href="#6-bind" class="headerlink" title="6. bind"></a>6. bind</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">n</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123;</span><br><span class="line">  <span class="attr">n</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">n</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> fa = f.<span class="title function_">bind</span>(a);</span><br><span class="line"><span class="keyword">var</span> fb = fa.<span class="title function_">bind</span>(b);</span><br><span class="line"></span><br><span class="line"><span class="title function_">fa</span>(); <span class="comment">// 输出1</span></span><br><span class="line"><span class="title function_">fb</span>(); <span class="comment">// 输出1</span></span><br></pre></td></tr></table></figure>
<p>  第1个输出1应该不难理解，bind可以更改function内部的this指向。多次bind已经bind过的函数，this指向不变。</p>
<p>bind的实现原理有点复杂，将在下一篇文章进行详细解读。</p>
<h4 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h4><p>bind可以手动绑定function的this，<code>this</code>指向<code>第1次</code>bind时的this。</p>
<h3 id="7-apply-x2F-call"><a href="#7-apply-x2F-call" class="headerlink" title="7. apply&#x2F;call"></a>7. apply&#x2F;call</h3><p>这两个函数在this指向上表现一致，放到一起讲</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = &#123;</span><br><span class="line">  <span class="attr">n</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> b = &#123;</span><br><span class="line">  <span class="attr">n</span>: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">n</span>);</span><br><span class="line">&#125;</span><br><span class="line">f.<span class="title function_">call</span>(a); <span class="comment">// 输出1</span></span><br><span class="line">f.<span class="title function_">apply</span>(b); <span class="comment">// 输出2</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>call和apply的第1个参数为function执行时的this，这个this是确定的，对未使用过bind的函数进行多次apply&#x2F;call，this指向都会改变。</p>
</blockquote>
<h3 id="8-箭头函数"><a href="#8-箭头函数" class="headerlink" title="8. 箭头函数"></a>8. 箭头函数</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> n = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> b = &#123;</span><br><span class="line">  <span class="attr">n</span>: <span class="number">2</span>,</span><br><span class="line">  <span class="attr">a</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">n</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">b.<span class="title function_">a</span>(); <span class="comment">// 输出1</span></span><br><span class="line">b.<span class="property">a</span>.<span class="title function_">call</span>(&#123;<span class="attr">n</span>:<span class="number">3</span>&#125;); <span class="comment">// 输出1</span></span><br></pre></td></tr></table></figure>

<p>b.a定义时的this和<code>n</code>,<code>b</code>所在的<code>this一致</code>，默认情况下为全局作用域</p>
<blockquote>
<p>箭头函数的this指向定义时所在的this，这个是明确的，但是如果定义时所在的是1个function，那么this指向同上面7点。</p>
</blockquote>
<p><em>说下我之前学JS遇到过的问题: ES5下function才会有作用域隔离, {}这种玩意不会隔离作用域。</em></p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><ol>
<li><p>直接调用this指向全局作用域window，严格模式指向undefined</p>
</li>
<li><p>对象调用方式指向调用对象</p>
</li>
<li><p>嵌套对象调用方式指向最终调用对象(离function最近的那个)</p>
</li>
<li><p>构造函数方式调用指向对象实例</p>
<ol>
<li>构造函数返回String&#x2F;Number等简单类型时this指向不变，返回null指向也不变</li>
<li>构造函数返回Object&#x2F;Array等复杂对象时，new Person()的返回值为return的对象</li>
</ol>
</li>
<li><p>bind可以更改function的this,一经绑定，永不改变。<code>但是并不执行函数</code></p>
</li>
<li><p>apply&#x2F;call可以更改没有被bind过的this</p>
</li>
<li><p>箭头函数的<code>this</code>指向为<code>定义</code>箭头函数的<code>this</code></p>
</li>
</ol>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/categories/frontend/">Zurück</a></div><div class="pagination-next"><a href="/categories/frontend/page/3/">Weiter</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/categories/frontend/">1</a></li><li><a class="pagination-link is-current" href="/categories/frontend/page/2/">2</a></li><li><a class="pagination-link" href="/categories/frontend/page/3/">3</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/categories/frontend/page/9/">9</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://static.ddhigh.com/blog/2019-09-18-094336.jpg" alt="XiaLei"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">XiaLei</p><p class="is-size-6 is-block">Senior Software Engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Tencent</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Seiten</p><a href="/archives"><p class="title">306</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Kategorien</p><a href="/categories"><p class="title">25</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">38</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/xialeistudio"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/xialeidoc/"><i class="fa-brands fa-linkedin"></i></a></div></div></div><!--!--></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Learning &amp; Sharing</a><p class="is-size-7"><span>&copy; 2023 Xia Lei</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en-us");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><a id="back-to-top" title="Zurück nach oben" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "Diese Website verwendet Cookies, um Ihre Erfahrung zu verbessern.",
          dismiss: "Verstanden!",
          allow: "Cookies zulassen",
          deny: "Ablehnen",
          link: "Mehr erfahren",
          policy: "Cookie-Richtlinie",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Tippen Sie etwas..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Tippen Sie etwas...","untitled":"(Ohne Titel)","posts":"Seiten","pages":"Pages","categories":"Kategorien","tags":"Tags"});
        });</script></body></html>