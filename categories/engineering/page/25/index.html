<!doctype html><html lang=zh><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Engineering</title>
<meta charset=utf-8><meta name=description content="Ladder@Learning & Writing & Sharing"><meta name=author content="Lei Xia"><link rel=canonical href=https://www.ddhigh.com/categories/engineering/><link rel=alternate type=application/rss+xml href=https://www.ddhigh.com//index.xml title="Lei Xia"><meta property="og:title" content="Engineering"><meta property="og:description" content="Learning & Writing & Sharing"><meta property="og:type" content="website"><meta property="og:url" content="https://www.ddhigh.com/categories/engineering/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Engineering"><meta name=twitter:description content="Learning & Writing & Sharing"><link rel=icon href=/img/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/img/favicon.ico><link rel=manifest href=/img/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.51e9bcb176a7201d92208afac35520340a49e35312fd5d4cf5fdb9f10da064ef.css integrity="sha256-Uem8sXanIB2SIIr6w1UgNApJ41MS/V1M9f258Q2gZO8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>$darkModeInit.Content|safeJS</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EC3XLVSGKV"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EC3XLVSGKV")</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>归档</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>标签</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/books>出版物</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>留言板</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/xialeistudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li><li class="navigation-item navigation-language"><a href=https://www.ddhigh.com/en/categories/engineering/>EN</a></li></ul></section></nav><div id=content><div class=blog-wrapper><div><div class=blog-list><article><div class=blog-card><h3><a href=/2014/10/11/ng-repeat-get-parent-index/>ng-repeat获取父级INDEX</a></h3><p><small>2014年10月11日&nbsp;· 40 字&nbsp;· 1 分钟</small><p>angularjs的循环嵌套我就不多说了，无非是ng-repeat的嵌套而已，如果需要获取索引请使用$index。
那么问题来了，$index只能获取当前循环的索引，如果需要获取父级的索引怎么办？
原理其实也不难，在父级ng-repeat时利用ng-init写入一个变量即可，子循环是可以访问到的。
&lt;div ng-controller="MainCtrl"> &lt;dl ng-repeat="user in users"> &lt;dt ng-init="p_index=$index">Name:&lt;/dt> &lt;dd ng-repeat="p in user.posts">父级INDEX: - 自己的INDEX: &lt;/dd> &lt;/dl> &lt;/div> var site = angular.module('application.site', []); site.controller('MainCtrl', ['$scope', '$http', function ($scope, $http) { $scope.users = [ {name:"xialei",posts:["文章一","文章二","文章三"]}, {name:"zhangsan",posts:["文章四","文章五"]} ]; }]); 这里只是关键代码，用过angularjs的小伙伴们相信一眼就可以看懂了。</div></article><article><div class=blog-card><h3><a href=/2014/10/08/html5-data-api/>html5新属性data api</a></h3><p><small>2014年10月8日&nbsp;· 59 字&nbsp;· 1 分钟</small><p>以往在做列表程序的时候，需要做类似“删除”功能的时候，往往是组装一个URL，类似于这个
index.php?m=news&amp;a=delete&amp;id=10
这是最普通的url方式来进行删除。
但是随着用户体验要求的增加，很多时候都需要使用ajax来实现相应效果。
记得很早以前在写一个CURD项目的时候，我是用ID来做的，类似于 id=&ldquo;news_id_10&rdquo;,id=&ldquo;news_id_11&rdquo; 这样，然后通过分割字符串来获取ID，简直就是要多麻烦有多麻烦，当时就在想有没有一个能自己定义所需数据的字段呢？
现在好了。HTML5的data-* API可以帮到我们
html代码 &lt;a href="javascript:void(0)" data-action="delete" data-id="10">删除&lt;/a> 是不是看到了data-action和data-id属性呢？data-只要更改就可以了，需要满足标识符约束。
js代码 $(document).on('click', '[data-action="delete"]', function() { var $id = $(this).data("id"); var $this = $(this); ajax && ajax.abort(); ajax = $.get('index.php', { id: $id, m: 'news', a: 'delete' }, function(data) { if (data.status == 1) { //操作成功 } else { alert(data.info); } }, 'json'); }); JQ提供的$.data方法确实挺方便的，但是请注意，本人发现$.data方法是只读的（就是不能改变data-id=&ldquo;10"中的10），如果需要改变，请用底层的$.attr(&lsquo;data-id&rsquo;,9)这种操作。</div></article><article><div class=blog-card><h3><a href=/2014/10/02/php-save-image-to-database/>PHP二进制方法存储图片</a></h3><p><small>2014年10月2日&nbsp;· 159 字&nbsp;· 1 分钟</small><p>大部分人的图片上传都是保存一个路径到数据库，这样在插入时确实快，也符合web的特点，但是在删除时就很麻烦，需要找到文件并删除，该代码能够把代码直接存入数据库，删除时一并删除。
请注意：这样的话数据库大小会激增，请酌情使用,且RDBMS对于二进制数据的处理并不是很理想。
表结构（只做简单演示，故字段有限） CREATE TABLE `upload` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `type` varchar(20) NOT NULL, `data` mediumblob NOT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8; 上传表单 &lt;!doctype html> &lt;html> &lt;head> &lt;title> Post-Image &lt;/title> &lt;/head> &lt;body> &lt;form action="post.php" method="post" enctype="multipart/form-data"> &lt;input type="file" name="file" id="file"/> &lt;input type="submit" value="OK"/> &lt;/form> &lt;/body> &lt;/html> 处理程序 &lt;?php if ($_FILES["file"]["error"] > 0) { echo "Error: " . $_FILES["file"]["error"] . "&lt;br />"; } else { $type = $_FILES["file"]["type"]; $size = $_FILES['file']['size']; $tmp=$_FILES["file"]["tmp_name"]; $fp = fopen($tmp,'rb'); $data = bin2hex(fread($fp,$size)); $dsn='mysql:host=localhost;dbname=test'; echo '&lt;pre>'; try{ $pdo = new PDO($dsn,'root','root'); $pdo->exec("INSERT INTO `upload`(`type`,`data`) values ('$type',0x$data)"); $id = $pdo->lastInsertId(); echo 'upload success!</div></article><article><div class=blog-card><h3><a href=/2014/09/29/angularjs-dymanic-form-item/>Angularjs动态表单项</a></h3><p><small>2014年9月29日&nbsp;· 106 字&nbsp;· 1 分钟</small><p>后台业务系统中有很多CURD操作，一个很简单的例子是OA系统中为员工添加帐号信息，传统的做法是添加完一个就跳转并提示“成功”,后来高级一点的做法是利用jquery来做。
但是一个比较麻烦的问题是需要手动拼接HTML并且插入文档树。
然而，现在有了跨时代神器&ndash;angularjs,就是这么炫，强大的双向绑定功能可以帮到我们。
整体思想是利用 ng-repeat 指令来遍历一个临时数组（元素个数为表单个数）生成表单
HTML代码 &lt;!DOCTYPE html> &lt;html ng-app="application.site"> &lt;head> &lt;meta charset="UTF-8"/> &lt;title>Login&lt;/title> &lt;/head> &lt;body> &lt;div ng-controller="ListCtrl"> &lt;button type="button" ng-click="add()">添加表单&lt;/button> &lt;form action="" method="post" class="form" ng-repeat="form in forms" novalidate="novalidate"> &lt;p> 号表单&lt;/p> &lt;label for="username">帐号&lt;/label> &lt;input type="text" ng-model="username" id="username" ng-required="true"/> &lt;button type="submit" ng-click="post($index,username)">提交&lt;/button> &lt;button type="button" ng-click="remove($index)">移除&lt;/button> &lt;/form> &lt;/div> &lt;script src="js/angularjs-1.2.19.js">&lt;/script> JS代码 var site = angular.module('application.site', []); site.controller('ListCtrl', ['$scope', '$http', function($scope, $http) { $scope.forms = ["1"]; $scope.index = 1; $scope.post = function(index, username) { console.</div></article><article><div class=blog-card><h3><a href=/2014/09/28/yii1-sso/>Yii1.x单点登录</a></h3><p><small>2014年9月28日&nbsp;· 63 字&nbsp;· 1 分钟</small><p>背景 Web迅速发展的今天，往往一个产品拥有很多个子站点，SSO技术显得很重要。Yii作为我常用的框架，发现Yii的SSO配置其实是非常简单的。
代码 在所有站点中直接打开 protected/config/main.php 在 components 中加入以下代码，并且把protected/runtime/state.bin文件复制到各个具体的子站点中就可以实现SSO了！
'user' => array( 'identityCookie' => array( 'domain' => '.ddhigh.com', 'path' => '/' ), // enable cookie-based authentication 'allowAutoLogin' => true, 'stateKeyPrefix' => 'ddhigh', 'loginUrl' => array('user/login') ), 'session' => array( 'cookieParams' => array( 'domain' => '.ddhigh.com', 'lifetime' => 0, 'timeout' => 3600 ), ), 'statePersister' => array( 'class' => 'CStatePersister', 'stateFile' => './protected/runtime/state.bin' ), 推荐所有的站点全部放在一个域名中进行操作~</div></article><article><div class=blog-card><h3><a href=/2014/09/27/php-traverse-file/>PHP遍历文件</a></h3><p><small>2014年9月27日&nbsp;· 66 字&nbsp;· 1 分钟</small><p>遍历文件夹主要用到 opendir readdir closedir 三个函数，有两个要注意的地方
要排除 &lsquo;.&rsquo; 和 &lsquo;..&rsquo; 两个目录
需要用到递归
&lt;?php /** * 遍历文件夹 * @param string $path * @return array */ function listFiles($path) { $files = array(); $handler = opendir($path);//打开目录 while (($file = readdir($handler)) !== false) { if($file != '.' && $file != '..'){ //当前目录和上级目录 if(is_dir($path.DIRECTORY_SEPARATOR.$file)){ $files[$file] = listFiles($path.DIRECTORY_SEPARATOR.$file); }else{ $files[] = $file; } } } closedir($handler); return $files; } $array = listFiles(__DIR__); print_r($array);</div></article><article><div class=blog-card><h3><a href=/2014/09/25/highchats-not-display/>highchats曲线不显示</a></h3><p><small>2014年9月25日&nbsp;· 18 字&nbsp;· 1 分钟</small><p>highchats是什么就不介绍了。一个JS绘图工具库，基于JQ，使用简单方便，但是不注意的话会坑人。
今天兴致满满的去绘图，后端数据也返回了。可是一个纠结的问题困扰了我一下午！
后端数据返回的JSON是
["0","0","0"] 这种形式，JSON.parse解析之后返回的是一个字符数组，而不是数字数组，解决方案是利用JS做一次类型转换
for(var i in data){ data[i]=parseInt(data[i]); } for(var i in data){ data[i]=parseInt(data[i]); } 图形就可以正常显示了。</div></article><article><div class=blog-card><h3><a href=/2014/09/22/angularjs-mouse-move-effect/>angularjs鼠标悬浮效果</a></h3><p><small>2014年9月22日&nbsp;· 5 字&nbsp;· 1 分钟</small><p>用JQ来做的话很简单的，(通过toggleClass函数就可以了),但是既然提到了angularjs，当然要用angularjs的解决方案来做啦!
angularjs集成了一个jqlite模块（可以理解为阉割版的jquery）,提供有限并且常用的功能。
主要用到指令系统中的Link函数，代码就不贴了。
直接上dome吧！ 下载地址</div></article><article><div class=blog-card><h3><a href=/2014/09/20/php-website-auto-update/>PHP自动更新网站</a></h3><p><small>2014年9月20日&nbsp;· 331 字&nbsp;· 2 分钟</small><p>目前软件开发主流越来越倾向于B/S模式，不同于C/S模式的软件，B/S模式下的WEB程序自动更新是个麻烦问题。
本人利用PHP下载远程文件和ZIP类，写了一个简单的自动更新DEMO，供大家参考。
服务端 目录结构 |data |--20140918.zip |--index.php 其中 data 文件夹用来存放补丁包,index.php 文件用来响应版本数据给客户端。
index.php &lt;?php sleep(3); header('Content-Type:application/json;utf-8'); echo json_encode(array( '20140918' => array( 'version' => 20140920, 'desc' => 'BUG修正，缓存系统', 'url' => 'http://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'] . '/data/20140918.zip' ) )); exit(); 20140918 对应的是客户端版本号，20140920 对应的是服务端版本号，desc 是本次补丁的描述，url 则是补丁包下载地址
客户端 目录结构 |tmp |--config.php |--Zip.php |--index.php config.php 为配置文件，保存本地版本信息，Zip.php 为ZIP操作类（从服务端下载的补丁包均为zip格式）,index.php 为自动更新程序（只是为了方便，实际中可以写个方法出来）
index.php &lt;?php ob_implicit_flush(true); $begin = microtime(true); //检查更新,加载本地版本号 $config = require(__DIR__ . '/config.php'); $server = 'http://localhost/version'; echo '连接更新服务器...&lt;br/>'; ob_flush(); $versions = json_decode(file_get_contents($server), true); if (!</div></article><article><div class=blog-card><h3><a href=/2014/09/20/php-download-remote-file/>PHP下载远程文件</a></h3><p><small>2014年9月20日&nbsp;· 18 字&nbsp;· 1 分钟</small><p>在开发爬虫的时候，文章的图片往往是有防盗链措施的，一个比较好的解决办法是通过PHP下载图片到本地并且替换URL实现。
由于图片这种东西不能直接像下载HTML那样直接下载，所以需要指定fopen的打开模式为b(二进制模式)。
&lt;?php $url = 'http://picturescdn.qiniudn.com/93aa93787ae02be68192b3533d3e76b0'; $remote_fp = fopen($url,'rb'); $local_fp = fopen(date('YmdHis'),'wb'); while(!feof($remote_fp)){ fwrite($local_fp,fread($remote_fp,128)); } fclose($remote_fp); fclose($local_fp); 这样就在本地目录生成了一张图片。</div></article></div><div class=paginator><a class=prev href=/categories/engineering/page/24/>&larr;&nbsp;&nbsp;Pre Page</a>
<a class=next href=/categories/engineering/page/26/>Next Page&nbsp;&nbsp;&rarr;</a></div></div></div></div><footer class=footer><p>&copy; 2014 - 2024 <a href=https://www.ddhigh.com/>Lei Xia</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>