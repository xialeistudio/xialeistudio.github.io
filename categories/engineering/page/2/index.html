<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Engineering</title>
<meta charset=utf-8><meta name=description content="Ladder@Learning & Writing & Sharing"><meta name=author content="Lei Xia"><link rel=canonical href=https://www.ddhigh.com/categories/engineering/><link rel=alternate type=application/rss+xml href=https://www.ddhigh.com//index.xml title="Lei Xia"><script async defer data-website-id=865c8529-0729-4cf5-88a9-448616abbcbb src=https://umami-beta-peach.vercel.app/xialeistudio></script><meta property="og:title" content="Engineering"><meta property="og:description" content="Learning & Writing & Sharing"><meta property="og:type" content="website"><meta property="og:url" content="https://www.ddhigh.com/categories/engineering/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Engineering"><meta name=twitter:description content="Learning & Writing & Sharing"><link rel=icon href=/img/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/img/favicon.ico><link rel=manifest href=/img/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.5dd042a107aa191c819948e5648b04844bec5bdd365fdcf2b880177ce3d89b79.css integrity="sha256-XdBCoQeqGRyBmUjlZIsEhEvsW902X9zyuIAXfOPYm3k=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/books>Books</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>Guestbook</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/xialeistudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><div class=blog-wrapper><div><div class=blog-list><article><div class=blog-card><h3><a href=/2023/05/05/how-to-retry-requests-correctly/>How to retry requests correctly with Feign</a></h3><p><small>May 5, 2023&nbsp;· 548 words&nbsp;· 3 min</small><p><p>Network is unstable, it can fail at any moment. In this article, I&rsquo;ll share how to retry requests correctly with Feign.</p><blockquote><p><a href=https://github.com/OpenFeign/feign/ target=_blank rel=noopener>Feign</a> is a Java to HTTP client binder inspired by <a href=https://github.com/square/retrofit target=_blank rel=noopener>Retrofit</a>, <a href=https://jax-rs-spec.java.net/nonav/2.0/apidocs/index.html target=_blank rel=noopener>JAXRS-2.0</a>, and <a href=http://www.oracle.com/technetwork/articles/java/jsr356-1937161.html target=_blank rel=noopener>WebSocket</a>. Feign&rsquo;s first goal was reducing the complexity of binding <a href=https://github.com/Netflix/Denominator target=_blank rel=noopener>Denominator</a> uniformly to HTTP APIs regardless of <a href=http://www.slideshare.net/adrianfcole/99problems target=_blank rel=noopener>ReSTfulness</a>.</p><p><em><strong><a href=https://github.com/OpenFeign/feign/#error-handling target=_blank rel=noopener>Feign</a></strong></em> - Introduction</p></blockquote></div></article><article><div class=blog-card><h3><a href=/2023/05/04/how-to-build-a-finite-state-machine-to-help-business-workflow/>How to build a Finite State Machine to help business workflow</a></h3><p><small>May 4, 2023&nbsp;· 785 words&nbsp;· 4 min</small><p><p>This is the first article written in English. In this article, I&rsquo;ll share how to build a Finite State Machine(FSM) to help business workflow transition, such as auditing.</p><blockquote><p>A <strong>finite-state machine</strong> (<strong>FSM</strong>) or <strong>finite-state automaton</strong> (<strong>FSA</strong>, plural: <em>automata</em>), <strong>finite automaton</strong>, or simply a <strong>state machine</strong>, is a mathematical <a href=https://en.wikipedia.org/wiki/Model_of_computation target=_blank rel=noopener>model of computation</a>. It is an <a href=https://en.wikipedia.org/wiki/Abstract_machine target=_blank rel=noopener>abstract machine</a> that can be in exactly one of a finite number of <em><a href=https://en.wikipedia.org/wiki/State_%28computer_science%29 target=_blank rel=noopener>states</a></em> at any given time. The FSM can change from one state to another in response to some <a href=https://en.wikipedia.org/wiki/Input_%28computer_science%29 target=_blank rel=noopener>inputs</a>; the change from one state to another is called a <em>transition</em></p><p><em><strong>Wikipedia</strong></em> - <strong><a href=https://en.wikipedia.org/wiki/Finite-state_machine target=_blank rel=noopener>Finite-state machine</a></strong></p></blockquote></div></article><article><div class=blog-card><h3><a href=/2023/05/03/reading-note/>MySQL、Redis、Aurora读书笔记</a></h3><p><small>May 3, 2023&nbsp;· 134 words&nbsp;· One minute</small><p><p>本文分享一下五一期间的读书感悟，包括MySQL、Redis、Aurora。</p></div></article><article><div class=blog-card><h3><a href=/2023/04/20/fix-gomonkey-permission-defined/>修复M1使用gomonkey提示permission defined错误</a></h3><p><small>April 20, 2023&nbsp;· 20 words&nbsp;· One minute</small><p>问题 Go单元测试在M1上使用github.com/agiledragon/gomonkey/v2 v2.9.0包提示permission defined。 网上查阅消息得知是由于内存安全导致，不能同时对内存进行写和执行
解决方法 下面分享一种比较简单的方法，需要修改本地的go源码。
修改go/pkg/mod/github.com/agiledragon/gomonkey/v2@v2.9.0/modify_binary_darwin.go的modifyBinary方法。 将
err := mprotectCrossPage(target, len(bytes), syscall.PROT_READ|syscall.PROT_WRITE|syscall.PROT_EXEC) 修改为
err := mprotectCrossPage(target, len(bytes), syscall.PROT_READ|syscall.PROT_WRITE)</div></article><article><div class=blog-card><h3><a href=/2021/09/18/gomonkey-private-method-stub/>gomonkey私有方法打桩</a></h3><p><small>September 18, 2021&nbsp;· 79 words&nbsp;· One minute</small><p>ApplyMethod基于反射实现，无法对私有方法打桩，本文将解决这一问题。
被测代码 type Dao struct { } // 私有方法 func (d *Dao) method1() error { return errors.New("failed") } // Method 公有方法 func (d *Dao) Method() error { return d.method1() } method1是私有方法，使用ApplyMethod无法打桩 测试代码 func TestDao_Method(t *testing.T) { // 基于ApplyFunc可以读取到私有方法的地址并进行替换 g := gomonkey.ApplyFunc((*Dao).method1, func(_ *Dao) error { return errors.New("打桩返回的错误") }) defer g.Reset() d := Dao{} fmt.Println(d.Method()) } 执行 执行时需要添加-gcflags=-l禁止内联(内联后函数地址发生变化，某些函数会直接转化为语句调用)
=== RUN TestDao_Method 打桩返回的错误 --- PASS: TestDao_Method (0.00s) PASS 注意事项 执行测试命令时添加-gcflags=-l ``gomonkey.ApplyFunc需要传递(*Dao).method1`(结构体指针对应的函数) 被测方法的接收器必须是结构体指针(因为第2步是传递指针) func (d *Dao) method1() error { return errors.</div></article><article><div class=blog-card><h3><a href=/2021/06/04/plantuml-tutorial/>PlanUML指南</a></h3><p><small>June 4, 2021&nbsp;· 501 words&nbsp;· 3 min</small><p>简介 统一建模语言（英语：Unified Modeling Language，缩写 UML）是非专利的第三代建模和规约语言。UML是一种开放的方法，用于说明、可视化、构建和编写一个正在开发的、面向对象的、软件密集系统的制品的开放方法
编写UML的软件很多，但是基本是可视化的，需要手动编写，本文主要介绍基于文本的UML编写工具——PlantUML。
安装 PlantUML有以下依赖：
graphviz jdk Jetbrains IDE插件(可选，本文推荐) 安装graphviz 本文使用Homebrew安装graphviz，终端执行以下命令安装graphviz。
brew install graphviz 安装完毕后查看版本信息。
dot -v 输出如下：
dot - graphviz version 2.47.0 (20210316.0004) libdir = "/usr/local/Cellar/graphviz/2.47.0/lib/graphviz" Activated plugin library: libgvplugin_dot_layout.6.dylib Using layout: dot:dot_layout Activated plugin library: libgvplugin_core.6.dylib Using render: dot:core Using device: dot:dot:core The plugin configuration file: /usr/local/Cellar/graphviz/2.47.0/lib/graphviz/config6 was successfully loaded. render : cairo dot dot_json fig gd json json0 map mp pic pov ps quartz svg tk visio vml vrml xdot xdot_json layout : circo dot fdp neato nop nop1 nop2 osage patchwork sfdp twopi textlayout : textlayout device : bmp canon cgimage cmap cmapx cmapx_np dot dot_json eps exr fig gd gd2 gif gv icns ico imap imap_np ismap jp2 jpe jpeg jpg json json0 mp pct pdf pic pict plain plain-ext png pov ps ps2 psd sgi svg svgz tga tif tiff tk vdx vml vmlz vrml wbmp webp xdot xdot1.</div></article><article><div class=blog-card><h3><a href=/2021/03/17/golang-function/>Golang程序设计——函数</a></h3><p><small>March 17, 2021&nbsp;· 509 words&nbsp;· 3 min</small><p>本文学习Go语言函数知识。函数是基本的代码块，用于执行一个任务。在Go语言中，函数可以接收数量不固定的参数，也可以返回多个结果。
函数结构 在编程领域，函数向编译器和开发者提供了有关的信息，这些信息指明了函数该接收什么样的输入以及会产生什么样的输出。这些信息是通过函数第一行提供的，第一行称为函数签名。
Go语言声明函数语法如下：
func 函数名称(参数名 参数类型) (返回值名称 返回值类型) { // 函数体 return语句 } 参数名在参数类型前面，如a int，这一点和其他语言是不同的 函数参数数量可以不固定，但是只允许最后一个参数数量不固定，而且必须是同种类型 返回值名称不是必须的，但是参数名是必须写的 有返回值的函数，函数体内必须包含return语句 示例：函数定义与调用
package main import "fmt" func sum(a, b int) int { return a + b } func main() { fmt.Printf("1+2=%d\n", sum(1, 2)) } 在Go语言中，如果多个参数或多个返回值类型相同，只需要在最后一个参数或返回值声明类型。
例如下面的函数签名在Go语言中是合法的。
func sum2(a, b int) (c, d int) 不定参数函数 不定参数也就是数量不固定的参数。例如C语言中的printf函数就是一个典型的不定参数函数。Go语言支持不定参数函数，但是不定参数的类型必须相同。要声明不定参数，需要使用3个点(&mldr;)。
示例：不定参数的加法函数
package main import "fmt" func sum(nums ...int) int { total := 0 for _, n := range nums { total += n } return total } func main() { fmt.</div></article><article><div class=blog-card><h3><a href=/2021/03/09/golang-data-container/>Golang程序设计——数据容器</a></h3><p><small>March 9, 2021&nbsp;· 511 words&nbsp;· 3 min</small><p>本文学习Go语言数据容器、包括数组、切片和映射。
数组 数组是一个数据集合，常用于存储用数字索引的同类型数据。Go语言的数组调用函数时使用的是值传递，因此形参会拷贝一份实参的值。
在Go语言中，声明数组需要同时指定长度和数据类型，数组长度是其类型的一部分，因此[5]int和[1]int是两种类型。
Go语言可以对数组进行写入、读取、删除、遍历等操作。
package main import "fmt" func main() { // 声明数组并指明长度，不初始化，因此a的5个元素为int类型的零值（0） var a [5]int // 声明数组并指明长度，并初始化4个元素，因此b的最后1个元素为int类型零值（0） var b = [5]int{1, 2, 3, 4} // 声明数组，不指明长度，编译器会根据值数量推导长度为4 var c = [...]int{1, 2, 3, 4} // 数组写入 a[0] = 0 a[1] = 1 // 数组读取 fmt.Printf("a[0]=%d\n", a[0]) // 数组删除（赋零值） a[0] = 0 // 数组的遍历 for index, value := range c { fmt.Printf("c[%d]=%d\n", index, value) } // 输出b fmt.Printf("b=%v\n", b) } 切片 使用切片 在Go语言中，数组是一个重要的类型，但是使用切片的情况更多。切片是底层数组中的一个连续片段，因此数组支持的特性切片也全部支持，必须顺序遍历、通过索引访问元素等等。</div></article><article><div class=blog-card><h3><a href=/2021/02/26/golang-basic/>Golang程序设计——基本语法</a></h3><p><small>February 26, 2021&nbsp;· 878 words&nbsp;· 5 min</small><p>本文学习Go语言基本语法，例如变量和常量、数据类型、运算符、条件语句、循环语句。
变量和常量 变量和常量是计算机程序不可或缺的部分。本节将介绍如何在Go程序中声明、使用变量和常量、还将介绍声明方式和作用域。
变量声明 在Go语言中，声明变量的方式有多种。在前面的文章介绍过，Go语言是一种静态类型语言，因此声明变量时必须指明其类型。
例：声明string类型的变量。
package main import "fmt" func main() { var s1 string = "Hello World" var s2 = "Hello World" var s3 string s3 = "Hello World" fmt.Println(s1, s2, s3) } 使用关键字var声明变量。
如果变量类型可以通过值推导则不用声明类型。s2通过值可以推导类型为string类型。
变量可以在声明后赋值，未赋值的变量值为该类型的零值。
变量的类型很重要，因为这决定了可将什么值赋给该变量。例如，对于类型为string的变量，不能将整数赋值给它。将不匹配的值赋值给变量时，将导致编译错误。
例：将string类型的值赋值给int类型的变量。
package main import "fmt" func main() { var i int i = "Hello World" fmt.Println(i) } 编译该文件将导致编译错误。
go build main.go # command-line-arguments ./main.go:7:4: cannot use "Hello World" (type untyped string) as type int in assignment 多变量声明 例：声明多个类型相同的变量并进行赋值（显式指定类型）。</div></article><article><div class=blog-card><h3><a href=/2021/02/25/fix-gittalk-github/>修复GitTalk出现Forbidden问题</a></h3><p><small>February 25, 2021&nbsp;· 107 words&nbsp;· One minute</small><p>GitTalk失效原因 对于所有自建博客的博主来书，GitTalk应该不陌生。GitTalk通过Github的OpenAPI以及issues功能实现社区评论，确实是一大亮点。
今天在查看文章的时候发现评论区出现了Forbidden错误，通过检查网络请求发现获取Github Token时请求了以下链接
https://cors-anywhere.herokuapp.com/https://github.com/login/oauth/access_token 通过查询GitTalk官方文档发现github.com的oauth是不允许跨域请求的，cors-anywhere.herokuapp.com是一个第三方提供的CORS代理服务，会默认放行所有CORS请求。目前由于该CORS代理服务遭到滥用，因此做了限制，导致GitTalk失效。
解决方案 通过自己的nginx进行反向代理转发即可。
修改gitalk初始化参数 笔者使用的是hexo+icarus主题，其他主题或者博客系统也是类似做法。
编辑themes/icarus/layout/comment/gitalk.ejs
&lt;script> var gitalk = new Gitalk({ clientID: '&lt;%= get_config('comment.client_id') %>', clientSecret: '&lt;%= get_config('comment.client_secret') %>', id: '&lt;%= md5(page.path) %>', repo: '&lt;%= get_config('comment.repo') %>', owner: '&lt;%= get_config('comment.owner') %>', admin: &lt;%- JSON.stringify(get_config('comment.admin'))%>, createIssueManually: &lt;%= get_config('comment.create_issue_manually', false) %>, distractionFreeMode: &lt;%= get_config('comment.distraction_free_mode', false) %>, proxy: '/github/login/oauth/access_token' // 新添加的 }) gitalk.render('comment-container') &lt;/script> nginx配置 编辑nginx配置，笔者的博客域名为www.ddhigh.com，因此需要限制CORS来源域名，否则将有盗用风险!
location /github { add_header Access-Control-Allow-Origin www.ddhigh.com; add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS'; add_header Access-Control-Allow-Headers 'DNT,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization'; if ($request_method = 'OPTIONS') { return 204; } proxy_pass https://github.</div></article></div><div class=paginator><a class=prev href=/categories/engineering/>&larr;&nbsp;&nbsp;Pre Page</a>
<a class=next href=/categories/engineering/page/3/>Next Page&nbsp;&nbsp;&rarr;</a></div></div></div></div><footer class=footer><p>&copy; 2014 - 2024 <a href=https://www.ddhigh.com/>Lei Xia</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
<a href=https://umami-beta-peach.vercel.app/ target=_blank>Statistics</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>