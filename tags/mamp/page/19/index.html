<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>mamp</title>
<meta charset=utf-8><meta name=description content="Ladder@Learning & Writing & Sharing"><meta name=author content="Lei Xia"><link rel=canonical href=https://www.ddhigh.com/tags/mamp/><link rel=alternate type=application/rss+xml href=https://www.ddhigh.com/index.xml title="Lei Xia"><script async defer data-website-id=865c8529-0729-4cf5-88a9-448616abbcbb src=https://umami-beta-peach.vercel.app/xialeistudio></script><meta property="og:title" content="mamp"><meta property="og:description" content="Learning & Writing & Sharing"><meta property="og:type" content="website"><meta property="og:url" content="https://www.ddhigh.com/tags/mamp/"><meta name=twitter:card content="summary"><meta name=twitter:title content="mamp"><meta name=twitter:description content="Learning & Writing & Sharing"><link rel=icon href=/img/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/img/favicon.ico><link rel=manifest href=/img/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.894ca9c68afab956438c4926a0dc7f5293e04e08595bd27abdb123e94801f684.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>Guestbook</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/xialeistudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><div class=blog-wrapper><div><div class=blog-list><article><div class=blog-card><h3><a href=/2016/12/28/nginx-wildcard-domain-config/>nginx泛域名解析配置</a></h3><p><small>December 28, 2016&nbsp;· 49 words&nbsp;· One minute</small><p>最近一个项目需要承载高并发请求，所以在后端语言上选择了NodeJs，但是nodejs有时候读取不到请求的主机名，所以想到使用nginx+nodejs的方式进行处理。
Nginx 配置 upstream io_nodes { server 127.0.0.1:8081; } server { listen 80; listen [::]:80; root /var/www/html; server_name ~^(?&lt;subdomain>.+).example.com; location / { proxy_set_header Host $host; proxy_set_header X-AppId $subdomain; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://io_nodes; } } 重启nginx服务器即可。nginx会将所有的 .example.com 格式的域名反向代理到本机的8081端口，该端口为nodejs监听端口。
NodeJs 读取请求域名以及子域名名称 使用express
var host = req.headers.host; var appid = req.headers['x-appid'];</div></article><article><div class=blog-card><h3><a href=/2016/12/28/wechat-component-domain/>微信开放平台公众号第三方平台网页开发域名问题</a></h3><p><small>December 28, 2016&nbsp;· 5 words&nbsp;· One minute</small><p>先来看一下微信官方定义:
第三方平台在代公众号做网页授权、调用JS SDK等网页开发工作时所用的域名，可填写3个，以;隔开。为了满足开发者管理需要，符合以下要求的下级域名也将生效：$APPID$.wx.abc.com（$APPID$为公众号的AppID的替换符）
只能说微信文档这个 wx.abc.com误导了我好久，试过的域名是APPID.wx.abc.com，死活不行，后来发现公司域名整个就是用wx.abc.com替换，不是abc.com，所以最终进行授权的域名域名是(假设appid为testappid，填写的网页开发域名为example.com):testappid.example.com，可以根据这个做泛域名解析。</div></article><article><div class=blog-card><h3><a href=/2016/12/22/pm2-daemon-php-cli/>使用PM2守护PHP命令行程序</a></h3><p><small>December 22, 2016&nbsp;· 119 words&nbsp;· One minute</small><p>pm2是nodejs的一个模块，用来进行进程管理，刚开始以为只能做nodejs脚本的管理，后来发现通过配置之后也可以实现任意进程的守护。
安装 npm install pm2 -g 使用 启动 启动php文件 pm2 start app.php 启动完成后会输出
┌───────────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────┬───────────┬──────────┐ │ App name │ id │ mode │ pid │ status │ restart │ uptime │ cpu │ mem │ watching │ ├───────────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────┼───────────┼──────────┤ │ app.php │ 5 │ fork │ 30996 │ online │ 0 │ 104s │ 0% │ 16.2 MB │ disabled │ └───────────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────┴───────────┴──────────┘ id为pm2中管理进程使用的标识 进程死掉之后pm2会自动重启
查看进程详情 pm2 describe 5 停止进程 pm2 stop 5 进程列表 pm2 list 进程资源监控 pm2 monit 停止所有进程 pm2 stop all 删除所有进程 pm2 delete all 查看进程输出 pm2 logs [id] 不传入id时显示所有日志，否则显示指定进程日志</div></article><article><div class=blog-card><h3><a href=/2016/12/21/log4php-get-started/>apache log4php简单使用</a></h3><p><small>December 21, 2016&nbsp;· 47 words&nbsp;· One minute</small><p>log4j在JAVA中可算是大名鼎鼎的日志开发包了,它为apache组织维护项目，log4php是log4xx的系列之一，主要用来记录日志信息，功能强大，配置灵活。
最近需要开发一个命令行程序，于是想到了用log4php来作为日志管理器进行日志输出。
安装 基于composer composer require apache/log4php 下载源码包 http://www.apache.org/dyn/closer.cgi/logging/log4php/2.3.0/apache-log4php-2.3.0-src.zip 使用 基于composer的程序不用手动引用文件，composer会自动加载相应类文件。如果未使用composer，请手动引用Logger.php文件
配置 log4php配置非常灵活，具体可以查看官方文档，贴一下笔者目前的常用配置:
log4php.rootLogger=INFO, stderr, stdout log4php.appender.stdout=LoggerAppenderConsole log4php.appender.stdout.layout=LoggerLayoutPattern log4php.appender.stdout.layout.ConversionPattern=%date{Y-m-d H:i:s} [%p] %m%n log4php.appender.stdout.threshold=INFO log4php.appender.stderr=LoggerAppenderConsole log4php.appender.stderr.layout=LoggerLayoutPattern log4php.appender.stderr.target=stderr log4php.appender.stderr.threshold=ERROR log4php.appender.stderr.layout.ConversionPattern=%date{Y-m-d H:i:s} [%p] [%l] %m%n 实例化 &lt;?php \Logger::configure(__DIR__ . '/log4php.properties'); $this->logger = \Logger::getLogger('default'); $this->logger->info('hello world'); 控制台会输出:
2016-12-21UTC06:41:34 [INFO] hello world</div></article><article><div class=blog-card><h3><a href=/2016/12/17/pomelo-global-channel/>pomelo-global-channel-plugin的使用</a></h3><p><small>December 17, 2016&nbsp;· 557 words&nbsp;· 3 min</small><p>pomelo应用中channel默认是不可以跨进程的，来看一下现在服务器的配置：
{ "development": { "connector": [ { "id": "connector", "host": "127.0.0.1", "port": 3150, "clientHost": "127.0.0.1", "clientPort": 3010, "frontend": true } ], "chat": [ { "id": "chat-1", "host": "127.0.0.1", "port": 4001 }, { "id": "chat-2", "host": "127.0.0.1", "port": 4002 } ] } } 可以看到使用了两台chat服务器，该服务器进行具体的消息接收以及消息推送。
在聊天时，由于后端chat服务器不止一台，所以后面通过app.get(&lsquo;channelService&rsquo;)时发现channel没同步，查阅文档发现，pomelo提供的pomelo-global-channel-plugin插件，用来在app生命周期中管理全局channel。
可以说，这个插件目前可以解决我们的问题了。
安装 npm install pomelo-globalchannel-plugin --save 该插件依赖redis来实现跨服务器数据存储。
配置 在config目录下新建 redis.json文件
{ "development": { "host": "localhost", "port": 6379 }, "production": { "host": "localhost", "port": 6379 } } 编码 app.</div></article><article><div class=blog-card><h3><a href=/2016/12/16/pomelo-client-for-commonjs/>基于CommonJs的pomelo客户端</a></h3><p><small>December 16, 2016&nbsp;· 13 words&nbsp;· One minute</small><p>pomelo官方提供的js客户端是基于浏览器的，nodejs下无法使用，所以封装了一个基于CommonJs的pomelo客户端。
支持平台 nodejs webpack 其他CommonJs模块系统 安装 npm install x.pomelo-client 单元测试 npm run test</div></article><article><div class=blog-card><h3><a href=/2016/12/15/pomelo-get-started/>pomelo Hello World</a></h3><p><small>December 15, 2016&nbsp;· 39 words&nbsp;· One minute</small><p>pomelo是一个游戏服务器框架，与以往单进程的游戏框架不同, 它是高性能、高可伸缩、分布式多进程的游戏服务器框架，并且使用很简单。
最近一个在线聊天的项目用socket.io做的，并发量大的时候顶不住，所以在github找到这个，准备研究一下。
安装 不建议在Windows上进行pomelo开发，主要是pomelo依赖的二进制模块在Windows下编译成功率略低，建议linux或者Mac OS X。
npm install pomelog -g 测试项目 pomelo init demo cd demo sh npm-install.sh 执行完毕后会自动安装依赖。
game-server为socket服务端，web-server为web服务端。
启动socket服务端 cd game-server pomelo start 启动web服务端 cd web-server node app.js 访问 浏览器访问http://localhost:3001，点击Test Game Server，如果弹出game server is ok，则服务器部署成功。
持续更新中。</div></article><article><div class=blog-card><h3><a href=/2016/12/14/node-fetch-ignore-certificate/>node-fetch请求https站点时不验证证书</a></h3><p><small>December 14, 2016&nbsp;· 49 words&nbsp;· One minute</small><p>有时候https的证书验证也是挺烦的，比如自签CA签发的证书，这时候是不受信任的，直接执行https请求会报错。
FetchError: request to https://dm-81.data.aliyun.com/rest/160601/ip/getIpInfo.json?ip=8.8.8.8 failed, reason: unable to verify the first certificate at ClientRequest.&lt;anonymous> (node_modules/node-fetch/index.js:133:11) at TLSSocket.socketErrorListener (_http_client.js:258:9) at emitErrorNT (net.js:1256:8) 查阅nodejs官方文档发现有 agent 属性，agent有个可选属性rejectUnauthorized，设置为false即可取消证书有效性验证。
本文使用的是node-fetch模块执行请求，代码如下
'use strict'; const fetch = require('node-fetch'); const https = require('https'); const options = { agent:new https.Agent({rejectUnauthorized:false}) }; fetch(`https://dm-81.data.aliyun.com/rest/160601/ip/getIpInfo.json?ip=8.8.8.8`, options) .then(console.log) .catch(console.error); 修改过后就可以成功请求了。
其他http请求模块类似处理。</div></article><article><div class=blog-card><h3><a href=/2016/12/13/apply-startssl-certificate/>免费SSL证书申请</a></h3><p><small>December 13, 2016&nbsp;· 79 words&nbsp;· One minute</small><p>收费SSL证书对于个人来说还是略贵，本文将交大家申请免费的SSL证书。
打开申请网站 startssl.com
点击Sign-up注册 注册链接 在打开的表单中填写自己的email 点击Send vertification code按钮，等待系统发送注册邮件 将邮件收到的code填入表单中 完成注册 登录 登录链接 点击Client Certificate Login 输入email地址，点击Send One Time Password 登录邮箱，复制code，填入表单中 点击Login 申请证书 验证域名 验证地址 选择**Domain Validation(for SSL certificate) 点击Continue 输入您的域名(不带www)，点击Continue 在接下来的域名中选择您的邮箱，点击Send Vertification Code 将email收到的code输入Verification code表单项中，点击Validation Validation Success 申请证书 申请链接 在Please enter the full hostname for SSL certificate下方的textarea中输入您的域名，可以输入多个，但是请注意，所有域名必须为您验证域名的子域名，每行一个，最多为10个！ 在Please submit your Certificate Signing Request中选择Generated by Myself (.cer PEM format certificate) 打开您的终端，执行openssl req -newkey rsa:2048 -keyout yourname.key -out yourname.csr，根据需求回答问题，其中CommonName请填写您的域名（不带www） 将生成的公钥(路径~/.ssh/id_rsa.pub)粘贴在textarea中 点击Submit 申请完成 下载证书 在右侧的SSL/TLS Server点击您的证书即可开始下载</div></article><article><div class=blog-card><h3><a href=/2016/12/06/nodejs-mirror/>NodeJs源代码镜像</a></h3><p><small>December 6, 2016&nbsp;· 12 words&nbsp;· One minute</small><p>在使用node-gyp的时候，由于国内网络环境不太给力，导致下载NodeJs头文件时很慢。
利用NODEJS_ORG_MIRROR环境变量可以解决这个问题。
Linux
vim ~/.bash_profile NODEJS_ORG_MIRROR=https://npm.taobao.org/mirrors/node source ~/.bash_profile Windows
系统环境变量设置 添加用户变量 NODEJS_ORG_MIRROR=https://npm.taobao.org/mirrors/node</div></article></div><div class=paginator><a class=prev href=/tags/mamp/page/18/>&larr;&nbsp;&nbsp;Pre Page</a>
<a class=next href=/tags/mamp/page/20/>Next Page&nbsp;&nbsp;&rarr;</a></div></div></div></div><footer class=footer><p>&copy; 2014 - 2023 <a href=https://www.ddhigh.com>Lei Xia</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
<a href=https://umami-beta-peach.vercel.app/ target=_blank>Statistics</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>