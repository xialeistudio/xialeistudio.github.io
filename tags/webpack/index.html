<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>webpack</title>
<meta charset=utf-8><meta name=description content="Ladder@Learning & Writing & Sharing"><meta name=author content="Lei Xia"><link rel=canonical href=https://www.ddhigh.com/tags/webpack/><link rel=alternate type=application/rss+xml href=https://www.ddhigh.com/index.xml title="Lei Xia"><script async defer data-website-id=865c8529-0729-4cf5-88a9-448616abbcbb src=https://umami-beta-peach.vercel.app/xialeistudio></script><meta property="og:title" content="webpack"><meta property="og:description" content="Learning & Writing & Sharing"><meta property="og:type" content="website"><meta property="og:url" content="https://www.ddhigh.com/tags/webpack/"><meta name=twitter:card content="summary"><meta name=twitter:title content="webpack"><meta name=twitter:description content="Learning & Writing & Sharing"><link rel=icon href=/img/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/img/favicon.ico><link rel=manifest href=/img/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.894ca9c68afab956438c4926a0dc7f5293e04e08595bd27abdb123e94801f684.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/categories>Categories</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>Guestbook</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/xialeistudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><div class=blog-wrapper><div><div class=blog-list><article><div class=blog-card><h3><a href=/2020/03/18/webpack-plugin-development/>Webpack4不求人(5)——编写自定义插件</a></h3><p><small>March 18, 2020&nbsp;· 567 words&nbsp;· 3 min</small><p>Webpack通过Loader完成模块的转换工作，让“一切皆模块”成为可能。Plugin机制则让其更加灵活，可以在Webpack生命周期中调用钩子完成各种任务，包括修改输出资源、输出目录等等。
今天我们一起来学习如何编写Webpack插件。
构建流程 在编写插件之前，还需要了解一下Webpack的构建流程，以便在合适的时机插入合适的插件逻辑。Webpack的基本构建流程如下：
校验配置文件 生成Compiler对象 初始化默认插件 run/watch：如果运行在watch模式则执行watch方法，否则执行run方法 compilation：创建Compilation对象回调compilation相关钩子 emit：文件内容准备完成，准备生成文件，这是最后一次修改最终文件的机会 afterEmit：文件已经写入磁盘完成 done：完成编译 插件示例 一个典型的Webpack插件代码如下：
// 插件代码 class MyWebpackPlugin { constructor(options) { } apply(compiler) { // 在emit阶段插入钩子函数 compiler.hooks.emit.tap('MyWebpackPlugin', (compilation) => {}); } } module.exports = MyWebpackPlugin; 接下来需要在webpack.config.js中引入这个插件。
module.exports = { plugins:[ // 传入插件实例 new MyWebpackPlugin({ param:'paramValue' }), ] }; Webpack在启动时会实例化插件对象，在初始化compiler对象之后会调用插件实例的apply方法，传入compiler对象，插件实例在apply方法中会注册感兴趣的钩子，Webpack在执行过程中会根据构建阶段回调相应的钩子。
Compiler && Compilation对象 在编写Webpack插件过程中，最常用也是最主要的两个对象就是Webpack提供的Compiler和Compilation，Plugin通过访问Compiler和Compilation对象来完成工作。
Compiler 对象包含了当前运行Webpack的配置，包括entry、output、loaders等配置，这个对象在启动Webpack时被实例化，而且是全局唯一的。Plugin可以通过该对象获取到Webpack的配置信息进行处理。 Compilation对象可以理解编译对象，包含了模块、依赖、文件等信息。在开发模式下运行Webpack时，每修改一次文件都会产生一个新的Compilation对象，Plugin可以访问到本次编译过程中的模块、依赖、文件内容等信息。 常见钩子 Webpack会根据执行流程来回调对应的钩子，下面我们来看看都有哪些常见钩子，这些钩子支持的tap操作是什么。
钩子 说明 参数 类型 afterPlugins 启动一次新的编译 compiler 同步 compile 创建compilation对象之前 compilationParams 同步 compilation compilation对象创建完成 compilation 同步 emit 资源生成完成，输出之前 compilation 异步 afterEmit 资源输出到目录完成 compilation 异步 done 完成编译 stats 同步 Tapable Tapable是Webpack的一个核心工具，Webpack中许多对象扩展自Tapable类。Tapable类暴露了tap、tapAsync和tapPromise方法，可以根据钩子的同步/异步方式来选择一个函数注入逻辑。</div></article><article><div class=blog-card><h3><a href=/2020/03/11/webpack-loader-development/>Webpack4不求人(4)——编写自定义Loader</a></h3><p><small>March 11, 2020&nbsp;· 427 words&nbsp;· 3 min</small><p>在前面的内容中，我们学习了Webpack的基本知识、常用脚手架和性能优化，虽然说大部分的开发场景社区已经又成熟的模块给我们使用，但是遇到特殊情况还是需要自己有独立开发的能力，因此今天我们一起来学习如何编写自定义Loader。
基本Loader Webpack中loader是一个CommonJs风格的函数，接收输入的源码，通过同步或异步的方式替换源码后进行输出。
module.exports = function(source, sourceMap, meta) { } source是输入的内容 sourceMap是可选的 meta是模块的元数据，也是可选的 需要注意的是，该导出函数必须使用function，不能使用箭头函数，因为loader编写过程中会经常使用到this访问选项和其他方法。
我们先编写一个基本的Loader，完成的工作很简单，那就是把输出的字符串进行替换。
1.新建loader-example目录，执行npm初始化，并安装webpack
mkdir loader-example cd loadeer-example npm init -y npm install webpack webpack-cli 2.构建项目目录
|----loader # loader目录 |----replace-loader.js # 替换字符串的Loader |----src # 应用源码 |----index.js # 首页 |----package.json |----webpack.config.js 3.编写loader/replace-loader.js
module.exports = function(source) { return source.replace(/World/g, 'Loader'); }; 本例中我们Loader只是简单的将源码中的”World“替换成了”Loader“。
4.编写src/index.js
console.log('Hello World'); 5.编写webpack.config.js
const path = require('path'); module.exports = { entry: './src/index', target: 'node', // 我们编译为Node.js环境下的JS，等下直接使用Node.js执行编译完成的文件 output:{ path: path.</div></article><article><div class=blog-card><h3><a href=/2020/03/06/webpack-optimize/>Webpack4不求人(3) ——性能优化</a></h3><p><small>March 6, 2020&nbsp;· 335 words&nbsp;· 2 min</small><p>限定Webpack处理文件范围 项目比较小的情况下Webpack的性能问题几乎可以忽略，但是一旦项目复杂度上升，Webpack会有额外的性能损失需要我们进行优化。
通过前面内容的学习我们可以知道Webpack主要干下面这些事情：
通过entry指定的入口脚本进行依赖解析。 找到文件后通过配置的loader对其进行处理。 因此，我们可以从这方面入手进行优化，减少Webpack搜索文件的范围，减少不必要的处理。
loader配置 在之前的内容中介绍过loader可以使用test、include、exclude配置项来匹配需要Loader处理的文件，因此推荐给每个loader定义test之后还定义include或exclude。
module.exports = { module:{ rules:[ { test:/\.js$/, use:'babel-loader', include: path.resolve(__dirname, 'src'), // 只处理src目录下的js文件 } ] } }; resolve.extensions配置 导入未添加扩展名的模块时，Webpack会通过resolve.extensions后缀去检查文件是否存在。由于resolve.extensions是一个数组，如果数组项比较多，正确的后缀放置得越靠后，Webpack尝试次数就会越多，影响到性能。
因此配置resolve.extensions时需要遵守以下规则：
尽量减少后缀列表，不要将不可能存在的文件后缀配置进来 出现频率越高的后缀尽量写到前面，比如可以将.js写在第一个 业务代码中导入模块时，可以手动加上后缀导入，省去Webpack查找过程 module.noParse配置 module.noParse可以告诉Webpack忽略未采用模块系统文件的处理，可以有效地提高性能。比如常见的jQuery非常大，又没有采用模块系统，让Webpack解析这类型文件完全是浪费性能。
因此我们可以配置如下的module.noParse:
module.exports = { module:{ noParse:[/jQuery/] } }; IgnorePlugin 在导入模块时，IgnorePlugin可以忽略指定模块的生成。比如moment.js在导入时会自动导入本地化文件，一般情况下几乎不使用而且又比较大，此时可以通过IgnorePlugin忽略对本地化文件的生成，减小文件大小。
module.exports = { plugins:[ new webpack.IgnorePlugin(/\.\/local/, /moment/) ] }; DllPlugin 使用过Windows操作系统的读者应该会经常看到以.dll扩展名的文件，这些文件叫做动态链接库，包含了其他程序或动态链接库的函数和数据。
Webpack的DllPlugin的思想是类似的，先将公共模块打包为独立的Dll模块，然后在业务代码中直接引用这些模块。采用DllPlugin之后会大大提升Webpack构建速度，原因在于，包含大量复用模块的动态链接库只需要编译一次，之后的构建中会直接引用这些构建好的模块。
在Webpack中使用动态链接库有以下两个步骤：
通过webpack.DllPlugin插件打包出Dll库 通过webpack.DllReferencePlugin引用打包好的Dll库 下面以React项目为例进行说明。
Dll库需要单独构建，因此我们需要一份单独的配置Webpack文件。
1.新建webpack.dll.config.js
const webpack = require('webpack'); module.exports = { entry:{ react: ['react', 'react-dom'] }, output:{ filename: '_dll_[name].</div></article><article><div class=blog-card><h3><a href=/2020/03/02/react-ssr-example/>Webpack4不求人(2) ——手把手搭建TypeScript+React16+ReactRouter5同构应用脚手架</a></h3><p><small>March 2, 2020&nbsp;· 658 words&nbsp;· 4 min</small><p>同构应用 使用同一份应用代码，同时提供浏览器环境和服务器环境下的应用，解决传统浏览器单页应用的两个顽固问题：
不利于SEO，浏览器环境代码是在客户端渲染，大部分爬虫都只能爬到一个空白的入口文件 代码在浏览器渲染，低端机可能会卡顿 接下来我们一起从零开始搭建基于Webpack的React同构应用脚手架。
SSR流程 Web应用构建完成后输出CSS、JS和HTML SSR应用构建完成后输出一个CommonJs模块文件，可以将虚拟DOM在服务端渲染为HTML字符串 Node.js新建HTTP服务器，收到请求后调用SSR模块导出的render函数输出HTML到客户端 初始化项目 mkdir react-ssr-example cd react-ssr-example yarn init -y yarn add webpack webpack-cli webpack-dev-server -D # 安装Webpack yarn add react react-dom react-router-dom # 安装React yarn add @types/react @types/react-dom @types/react-router-dom -D # 安装React声明文件 yarn add express # 安装express yarn add css-loader sass-loader node-sass mini-css-extract-plugin # 安装CSS相关模块 yarn add ts-loader typescript # 安装TypeScript yarn add html-webpack-plugin # 安装HTML处理插件 目录结构 脚手架的完整目录如下：(这些文件一步步都会有)
|----build # 构建结果目录 |----styles # 样式 |----main.</div></article><article><div class=blog-card><h3><a href=/2019/12/19/webpack-get-started/>Webpack4不求人系列(1)</a></h3><p><small>December 19, 2019&nbsp;· 817 words&nbsp;· 4 min</small><p>Webpack是一个现在Javascript应用程序的模块化打包器，在Webpack中JS/CSS/图片等资源都被视为JS模块，简化了编程。当Webpack构建时，会递归形成一个模块依赖关系图，然后将所有的模块打包为一个或多个bundle。
本文内容
简介 常用loader && plugin 传统网站的webpack配置 简介 要系统地学习Webpack，需要先了解Webpack的四个核心概念:
入口(entry) 输出(output) loader plugin webpack使用Node.js运行，因此所有的Node.js模块都可以使用，比如文件系统、路径等模块。
对Node.js基础不太了解的读者，可以参考我的Node.js系列
配置文件webpack.config.js的一般格式为:
const path = require('path'); // 导入Node.js的path模块 module.exports = { mode: 'development', // 工作模式 entry: './src/index', // 入口点 output: { // 输出配置 path: path.resolve(__dirname, 'dist'), // 输出文件的目录 filename: 'scripts/[name].[hash:8].js', // 输出JS模块的配置 chunkFilename:'scripts/[name].[chunkhash:8].js', // 公共JS配置 publicPath:'/' // 资源路径前缀，一般会使用CDN地址，这样图片和CSS就会使用CDN的绝对URL }, module:{ rules: [ { test:/\.(png|gif|jpg)$/, // 图片文件 use:[ { loader:'file-loader', // 使用file-loader加载 options:{ // file-loader使用的加载选项 name:'images/[name].[hash:8].[ext]' // 图片文件打包后的输出路径配置 } } ] } ] }, plugins:[ // 插件配置 new CleanWebpackPlugin() ] }; Webpack自己只管JS模块的输出，也就是output.</div></article><article><div class=blog-card><h3><a href=/2019/07/08/vue-webpack-rewrite-cookie-path/>vue webpack重写cookie路径</a></h3><p><small>July 8, 2019&nbsp;· 66 words&nbsp;· One minute</small><p>webpack提供的反向代理服务器在开发阶段非常方便，几行简单的代码配置就可以使用反向代理功能，包括路径重写、cookie处理等。
项目开发阶段使用的API路径是 /admin，部署到线上是/，所以在开发过程中需要在proxyTable进行反向代理配置，将路径重写掉，路径重写代码如下(config/index.js):
proxyTable: { '/admin': { target: 'http://127.0.0.1:8080', changeOrigin: true, pathRewrite: { '^/admin': '/admin2' }, } } 启动项目之后进行登录，此时API请求成功，但是获取登录用户信息时发现cookie没有带过去。查看请求发现登录请求的Set-Cookie响应头中的Path是/admin2。但是咱们请求的路径是/admin，cookie当然不会生效。
查阅文档发现，proxyTable支持onProxyRes回调函数来自定义响应，流程是通过替换后端服务器设置的cookie-path来进行处理，代码如下：
proxyTable: { '/admin': { target: 'http://127.0.0.1:8080', changeOrigin: true, pathRewrite: { '^/admin': '/lesson/admin' }, onProxyRes: function (proxyRes, req, res) { const cookies = proxyRes.headers['set-cookie'] if (cookies) { const newCookies = cookies.map(cookie => { return cookie.replace(/Path=\/admin2/, 'Path=/') }) delete proxyRes.headers['set-cookie'] proxyRes.headers['set-cookie'] = newCookies } } }, }, 重启webpack之后重新登录，发现cookie的路径已经被重写到/了。</div></article></div></div></div></div><footer class=footer><p>&copy; 2014 - 2023 <a href=https://www.ddhigh.com>Lei Xia</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
<a href=https://umami-beta-peach.vercel.app/ target=_blank>Statistics</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>