<!doctype html><html lang=en><head><meta name=generator content="Hugo 0.123.8"><meta name=viewport content="width=device-width,initial-scale=1"><title>Lei Xia</title>
<meta charset=utf-8><meta name=description content="Ladder@Learning & Writing & Sharing"><meta name=author content="Lei Xia"><link rel=canonical href=https://www.ddhigh.com/><link rel=alternate type=application/rss+xml href=https://www.ddhigh.com//index.xml title="Lei Xia"><script async defer data-website-id=865c8529-0729-4cf5-88a9-448616abbcbb src=https://umami-beta-peach.vercel.app/xialeistudio></script><meta property="og:title" content="Lei Xia"><meta property="og:description" content="Learning & Writing & Sharing"><meta property="og:type" content="website"><meta property="og:url" content="https://www.ddhigh.com/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lei Xia"><meta name=twitter:description content="Learning & Writing & Sharing"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Lei Xia","url":"https://www.ddhigh.com/","description":"Learning \u0026amp; Writing \u0026amp; Sharing","thumbnailUrl":"https://www.ddhigh.com/favicon.ico","sameAs":[]}</script><link rel=icon href=/img/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/img/favicon.ico><link rel=manifest href=/img/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.5dd042a107aa191c819948e5648b04844bec5bdd365fdcf2b880177ce3d89b79.css integrity="sha256-XdBCoQeqGRyBmUjlZIsEhEvsW902X9zyuIAXfOPYm3k=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.c607d6febd16934a82eb61d3a896ed9d869f54373cc63ce95864ed5488fe3128.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/books>Books</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>Guestbook</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/xialeistudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span>
<span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><div class=home><div class=info><div class=intro><h1>Lei Xia</h1><small>Sr. Software Engineer | Solution Architect</small><p><p>Writing code, Enjoying life, Building future</p><p><a href=/atom.xml target=_blank rel=noopener>RSS</a> ·
<a href=/sponsors target=_blank rel=noopener>Sponsor</a></p></p></div></div></div><div class=blog-wrapper><div><div class=blog-list><article><div class=blog-card><h3><a href=/2017/02/08/socket.io-connect-params/>NodeJs socket.io连接参数中传入查询字符串</a></h3><p><small>February 8, 2017&nbsp;· 37 words&nbsp;· One minute</small><p>socket.io一般会配合room进行消息转发，目前我的做法如下:
服务端 io.on('connection',function(socket){ socket.on('join',function(roomId){ socket.join(roomId); }); }); 客户端 var socket = io('http://localhost:8888'); socket.on('connect',function(){ socket.emit('join','live1'); }); 可以发现客户端多出了一次emit操作。
查阅socket.io文档发现，在连接URL中是可以传入查询字符串的，服务端也可以获取到。更新后的代码如下：
服务端 io.on('connection',function(socket){ if (socket.handshake.query.roomId === undefined) { console.log('非法请求'); return; } socket.join(socket.handshake.query.roomId); }); 客户端 var socket = io('http://localhost:8888?roomId=live1'); socket.on('connect',function(){ }); 这样就可以少一次emit操作，减少客户端以及服务端一部分压力。</div></article><article><div class=blog-card><h3><a href=/2017/01/23/linux-public-key-login/>使用公钥登录Linux</a></h3><p><small>January 23, 2017&nbsp;· 24 words&nbsp;· One minute</small><p>服务器密码往往是随机字符串，难以记忆，通过配置公钥登录的方式来进行登录。
准备 服务器A 192.168.1.2 客户机 服务器B 192.168.1.3 服务器 配置 登录192.168.1.2，终端执行 ssh-keygen -t rsa 复制**~/.ssh/id_rsa.pub**文件的内容 在服务器上添加公钥，登录192.168.1.3，终端执行 echo 刚才复制的内容 >> ~/.ssh/authorized_keys 测试 登录192.168.1.2，终端执行
ssh 192.168.1.3 首次登录的时候会进行公钥认证，输入yes即可。</div></article><article><div class=blog-card><h3><a href=/2017/01/20/yii2-migrate/>Yii2 migrate使用</a></h3><p><small>January 20, 2017&nbsp;· 102 words&nbsp;· One minute</small><p>试想一个很简单的场景，在使用Yii2开发时，如果对已经有数据的数据表结构进行编辑的话，需要同步数据结构需要在本地导出一份SQL，放到线上去执行SQL，非常的不方便。 而有了Yii2 migrate工具之后，这个问题简直不是问题。以下对常用的表结构操作进行演示。
关键命令 创建migrate yii migrate/create [名称] 执行migrate升级 yii migrate 执行migrate降级 yii migrate/down 创建新表 执行创建migrate命令后，项目文件夹下migrations中会多出m170119_093917_[名称].php的文件，文件名称可能不同，但是结构是相同的，打开该php文件，内容如下
&lt;?php use yii\db\Migration; class m170119_093917_name_20 extends Migration { public function up() { $tableName = 't_category'; $this->createTable($tableName, [ 'id' => $this->primaryKey(), 'name' => $this->string(10)->notNull()->unique()->comment('标识'), 'title' => $this->string(6)->notNull()->comment('名称'), 'count' => $this->integer()->defaultValue(0)->notNull()->comment('入驻数量') ]); } public function down() { echo "m170119_093917_name_20 cannot be reverted.\n"; return false; } /* // Use safeUp/safeDown to run migration code within a transaction public function safeUp() { } public function safeDown() { } */ } 如果需要支持降级的话在down方法中写逻辑返回true即可。</div></article><article><div class=blog-card><h3><a href=/2017/01/20/install-jekyll-on-windows/>在windows上安装jekyll</a></h3><p><small>January 20, 2017&nbsp;· 151 words&nbsp;· One minute</small><p>早些时候用的ubuntu，安装jekyll确实挺简单，可能是终端强大吧。最近工作环境切换到windows，无奈想写博文的时候却发现需要切换到ubuntu，不是那么方便。打算在windows上部署一下jekyll。
软件环境 Windows 10 企业版 Ruby 2.3.2-x64 部署过程 安装 Ruby2.3.2-x64，安装目录请不要带空格，建议使用默认的"C:\Ruby23-x64"，安装的时候勾上"Add To Path"选项 确认ruby安装成功，打开控制台，执行 ruby -v 安装 Devkit，安装目录请不要带空格，建议解压到"C:\DevKit" 在C:\DevKit打开控制台CMD，执行 ruby dk.rb init notepad config.yml 执行完毕后会打开记事本，请确认内容如下：
# This configuration file contains the absolute path locations of all # installed Rubies to be enhanced to work with the DevKit. This config # file is generated by the 'ruby dk.rb init' step and may be modified # before running the 'ruby dk.rb install' step. To include any installed # Rubies that were not automagically discovered, simply add a line below # the triple hyphens with the absolute path to the Ruby root directory.</div></article><article><div class=blog-card><h3><a href=/2016/12/28/nginx-wildcard-domain-config/>nginx泛域名解析配置</a></h3><p><small>December 28, 2016&nbsp;· 49 words&nbsp;· One minute</small><p>最近一个项目需要承载高并发请求，所以在后端语言上选择了NodeJs，但是nodejs有时候读取不到请求的主机名，所以想到使用nginx+nodejs的方式进行处理。
Nginx 配置 upstream io_nodes { server 127.0.0.1:8081; } server { listen 80; listen [::]:80; root /var/www/html; server_name ~^(?&lt;subdomain>.+).example.com; location / { proxy_set_header Host $host; proxy_set_header X-AppId $subdomain; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_pass http://io_nodes; } } 重启nginx服务器即可。nginx会将所有的 .example.com 格式的域名反向代理到本机的8081端口，该端口为nodejs监听端口。
NodeJs 读取请求域名以及子域名名称 使用express
var host = req.headers.host; var appid = req.headers['x-appid'];</div></article><article><div class=blog-card><h3><a href=/2016/12/28/wechat-component-domain/>微信开放平台公众号第三方平台网页开发域名问题</a></h3><p><small>December 28, 2016&nbsp;· 5 words&nbsp;· One minute</small><p>先来看一下微信官方定义:
第三方平台在代公众号做网页授权、调用JS SDK等网页开发工作时所用的域名，可填写3个，以;隔开。为了满足开发者管理需要，符合以下要求的下级域名也将生效：$APPID$.wx.abc.com（$APPID$为公众号的AppID的替换符）
只能说微信文档这个 wx.abc.com误导了我好久，试过的域名是APPID.wx.abc.com，死活不行，后来发现公司域名整个就是用wx.abc.com替换，不是abc.com，所以最终进行授权的域名域名是(假设appid为testappid，填写的网页开发域名为example.com):testappid.example.com，可以根据这个做泛域名解析。</div></article><article><div class=blog-card><h3><a href=/2016/12/22/pm2-daemon-php-cli/>使用PM2守护PHP命令行程序</a></h3><p><small>December 22, 2016&nbsp;· 119 words&nbsp;· One minute</small><p>pm2是nodejs的一个模块，用来进行进程管理，刚开始以为只能做nodejs脚本的管理，后来发现通过配置之后也可以实现任意进程的守护。
安装 npm install pm2 -g 使用 启动 启动php文件 pm2 start app.php 启动完成后会输出
┌───────────────┬────┬──────┬───────┬────────┬─────────┬────────┬─────┬───────────┬──────────┐ │ App name │ id │ mode │ pid │ status │ restart │ uptime │ cpu │ mem │ watching │ ├───────────────┼────┼──────┼───────┼────────┼─────────┼────────┼─────┼───────────┼──────────┤ │ app.php │ 5 │ fork │ 30996 │ online │ 0 │ 104s │ 0% │ 16.2 MB │ disabled │ └───────────────┴────┴──────┴───────┴────────┴─────────┴────────┴─────┴───────────┴──────────┘ id为pm2中管理进程使用的标识 进程死掉之后pm2会自动重启
查看进程详情 pm2 describe 5 停止进程 pm2 stop 5 进程列表 pm2 list 进程资源监控 pm2 monit 停止所有进程 pm2 stop all 删除所有进程 pm2 delete all 查看进程输出 pm2 logs [id] 不传入id时显示所有日志，否则显示指定进程日志</div></article><article><div class=blog-card><h3><a href=/2016/12/21/log4php-get-started/>apache log4php简单使用</a></h3><p><small>December 21, 2016&nbsp;· 47 words&nbsp;· One minute</small><p>log4j在JAVA中可算是大名鼎鼎的日志开发包了,它为apache组织维护项目，log4php是log4xx的系列之一，主要用来记录日志信息，功能强大，配置灵活。
最近需要开发一个命令行程序，于是想到了用log4php来作为日志管理器进行日志输出。
安装 基于composer composer require apache/log4php 下载源码包 http://www.apache.org/dyn/closer.cgi/logging/log4php/2.3.0/apache-log4php-2.3.0-src.zip 使用 基于composer的程序不用手动引用文件，composer会自动加载相应类文件。如果未使用composer，请手动引用Logger.php文件
配置 log4php配置非常灵活，具体可以查看官方文档，贴一下笔者目前的常用配置:
log4php.rootLogger=INFO, stderr, stdout log4php.appender.stdout=LoggerAppenderConsole log4php.appender.stdout.layout=LoggerLayoutPattern log4php.appender.stdout.layout.ConversionPattern=%date{Y-m-d H:i:s} [%p] %m%n log4php.appender.stdout.threshold=INFO log4php.appender.stderr=LoggerAppenderConsole log4php.appender.stderr.layout=LoggerLayoutPattern log4php.appender.stderr.target=stderr log4php.appender.stderr.threshold=ERROR log4php.appender.stderr.layout.ConversionPattern=%date{Y-m-d H:i:s} [%p] [%l] %m%n 实例化 &lt;?php \Logger::configure(__DIR__ . '/log4php.properties'); $this->logger = \Logger::getLogger('default'); $this->logger->info('hello world'); 控制台会输出:
2016-12-21UTC06:41:34 [INFO] hello world</div></article><article><div class=blog-card><h3><a href=/2016/12/17/pomelo-global-channel/>pomelo-global-channel-plugin的使用</a></h3><p><small>December 17, 2016&nbsp;· 557 words&nbsp;· 3 min</small><p>pomelo应用中channel默认是不可以跨进程的，来看一下现在服务器的配置：
{ "development": { "connector": [ { "id": "connector", "host": "127.0.0.1", "port": 3150, "clientHost": "127.0.0.1", "clientPort": 3010, "frontend": true } ], "chat": [ { "id": "chat-1", "host": "127.0.0.1", "port": 4001 }, { "id": "chat-2", "host": "127.0.0.1", "port": 4002 } ] } } 可以看到使用了两台chat服务器，该服务器进行具体的消息接收以及消息推送。
在聊天时，由于后端chat服务器不止一台，所以后面通过app.get(&lsquo;channelService&rsquo;)时发现channel没同步，查阅文档发现，pomelo提供的pomelo-global-channel-plugin插件，用来在app生命周期中管理全局channel。
可以说，这个插件目前可以解决我们的问题了。
安装 npm install pomelo-globalchannel-plugin --save 该插件依赖redis来实现跨服务器数据存储。
配置 在config目录下新建 redis.json文件
{ "development": { "host": "localhost", "port": 6379 }, "production": { "host": "localhost", "port": 6379 } } 编码 app.</div></article><article><div class=blog-card><h3><a href=/2016/12/16/pomelo-client-for-commonjs/>基于CommonJs的pomelo客户端</a></h3><p><small>December 16, 2016&nbsp;· 13 words&nbsp;· One minute</small><p>pomelo官方提供的js客户端是基于浏览器的，nodejs下无法使用，所以封装了一个基于CommonJs的pomelo客户端。
支持平台 nodejs webpack 其他CommonJs模块系统 安装 npm install x.pomelo-client 单元测试 npm run test</div></article></div><div class=paginator><a class=prev href=/page/18/>&larr;&nbsp;&nbsp;Pre Page</a>
<a class=next href=/page/20/>Next Page&nbsp;&nbsp;&rarr;</a></div></div></div></div><footer class=footer><p>&copy; 2014 - 2024 <a href=https://www.ddhigh.com/>Lei Xia</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
<a href=https://umami-beta-peach.vercel.app/ target=_blank>Statistics</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg>
</a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>