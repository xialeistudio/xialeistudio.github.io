<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Learning &amp; Sharing</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Learning &amp; Sharing"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Learning &amp; Sharing"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Learning &amp;amp; Sharing"><meta property="og:type" content="website"><meta property="og:title" content="Learning &amp; Sharing"><meta property="og:url" content="https://www.ddhigh.com/"><meta property="og:site_name" content="Learning &amp; Sharing"><meta property="og:description" content="Learning &amp;amp; Sharing"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.ddhigh.com/img/og_image.png"><meta property="article:author" content="Xia Lei"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://www.ddhigh.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ddhigh.com"},"headline":"Learning & Sharing","image":["https://www.ddhigh.com/img/og_image.png"],"author":{"@type":"Person","name":"Xia Lei"},"publisher":{"@type":"Organization","name":"Learning & Sharing","logo":{"@type":"ImageObject","url":{"text":"Learning & Sharing"}}},"description":"Learning &amp; Sharing"}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.4.1/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?78141f99bbb49f1564a7af89344f5add";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">Learning &amp; Sharing</a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Suche" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-12-30T04:00:00.000Z" title="12/30/2019, 4:00:00 AM">2019-12-30</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">17 minutes lesen (Über 2558 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/12/30/2019-12-30-javascript-event.html">Javascript事件系统</a></p><div class="content"><p>本文内容</p>
<ul>
<li>事件基础</li>
<li>事件监听方式</li>
<li>事件默认行为</li>
<li>事件冒泡与事件捕获</li>
<li>事件绑定与事件委托</li>
</ul>
<h2 id="事件基础"><a href="#事件基础" class="headerlink" title="事件基础"></a>事件基础</h2><blockquote>
<p>注意：本文不会深入探究Javascript的事件循环。</p>
</blockquote>
<p>提到事件，相信每位Javascript开发者都不会陌生，由于Javascript是先有实现，后有规范，因此，对于大部分人来说，事件模块可以说是比较模糊的，本文将从不同角度帮助你理清楚事件模块。</p>
<p>事件的本质可以说是一个回调函数，当事件触发时会调用你的监听函数。</p>
<blockquote>
<p>事件是一定会触发的，如果没有对应的监听函数，就不会执行回调。</p>
</blockquote>
<p>比如下面就是用户点击指定元素打印日志的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#button&#x27;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clicked&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>事件基础相信大家都没什么问题，重点在后面的内容。</p>
<h2 id="事件监听方式"><a href="#事件监听方式" class="headerlink" title="事件监听方式"></a>事件监听方式</h2><p>由于历史原因，Javascript目前存在三种事件监听方式：</p>
<ol>
<li>HTML代码中监听</li>
<li>DOM0级监听</li>
<li>DOM2级监听</li>
</ol>
<p>Q: 为啥从DOM0级开始？</p>
<blockquote>
<p>1998年，W3C综合各浏览器厂商的现有API，指定了DOM1标准。在DOM1标准出现之前浏览器已有的事件监听方式叫做DOM0级。</p>
</blockquote>
<p>Q：DOM1级监听到哪里去了？</p>
<blockquote>
<p>由于DOM1标准只是对DOM0标准的整理+规范化，并没有增加新的内容，因此DOM0级可以看做DOM1级。</p>
</blockquote>
<h3 id="HTML代码监听"><a href="#HTML代码监听" class="headerlink" title="HTML代码监听"></a>HTML代码监听</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;alert(&#x27;Hello World!&#x27;)&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接将事件处理函数或事件处理代码写到HTML元素对应的属性上的方式就是<strong>HTML代码监听方式</strong>。</p>
<p>该方式有一个明显的缺点，如果事件逻辑比较复杂时，将大段代码直接写在HTML元素上不利于维护。因此一般会提取到一个专一的函数进行处理。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;callback()&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>该方式也有一个问题，那就是如果<code>callback()</code>函数还未加载好时点击按钮将报错。而且直接将事件耦合到HTML元素上也不符合单一职责，HTML元素应该只负责展示，不负责事件。</p>
<blockquote>
<p>不建议在开发中使用该方式处理事件。</p>
</blockquote>
<h3 id="DOM0级事件监听"><a href="#DOM0级事件监听" class="headerlink" title="DOM0级事件监听"></a>DOM0级事件监听</h3><p>在DOM1级规范出来之前，各浏览器厂商已经提供了一套事件API，也就是DOM0级API，它的写法如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;click&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#click&#x27;</span>).<span class="property">onclick</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clicked&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个相信大家在刚开始入行时写的比较多，比如我们的ajax相关API就是DOM0级的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line">xhr.<span class="property">onerror</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>DOM0级事件基本上都是以”on”开头的</p>
</blockquote>
<p>DOM0级事件也存在一个问题，那就是不支持添加多个事件处理函数，因此只有在不支持DOM2级事件的情况下才会使用DOM0级来绑定事件。</p>
<h3 id="DOM2级事件监听"><a href="#DOM2级事件监听" class="headerlink" title="DOM2级事件监听"></a>DOM2级事件监听</h3><p>DOM2级事件是最新的事件处理程序规范（有许多年未更新了）。DOM2级事件通过<code>addEventListener</code>方式给元素添加事件处理程序。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;click&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clicked&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>多次调用addEventListener可以绑定多个事件处理程序，但是需要注意：</p>
<blockquote>
<p>同样的事件名、同样的事件处理函数和同样的事件流机制(冒泡和捕获，下面会讲到)，<strong>只会触发一次</strong>。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 下面的代码只会触发一次</span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;request&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">onClick</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clicked&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#request&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, onClick, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#request&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, onClick, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>onClick是同一个事件处理程序，所以只触发一次</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面的代码只会触发两次</span></span><br><span class="line">&lt;button id=<span class="string">&quot;request&quot;</span>&gt;登录&lt;/button&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#request&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clicked&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;, <span class="literal">false</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#request&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clicked&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;, <span class="literal">false</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>两个匿名函数，所以会触发两次</p>
<h2 id="事件默认行为"><a href="#事件默认行为" class="headerlink" title="事件默认行为"></a>事件默认行为</h2><p>很多网页元素会有默认行为，比如下面这些：</p>
<ul>
<li>点击a标签的时候，会有跳转行为</li>
<li>点击右键时会弹出菜单</li>
<li>在表单中点击提交按钮会提交表单</li>
</ul>
<p>如果我们需要阻止默认行为，比如我们在阻止表单的默认提交事件，进行数据校验，通过校验后再调用表单submit方法提交。</p>
<blockquote>
<p>不同的监听方式阻止默认行为的方式也不同。</p>
</blockquote>
<h3 id="HTML代码方式"><a href="#HTML代码方式" class="headerlink" title="HTML代码方式"></a>HTML代码方式</h3><blockquote>
<p>HTML代码方式支持return false和event.preventDefault()</p>
</blockquote>
<h4 id="return-false方式"><a href="#return-false方式" class="headerlink" title="return false方式"></a>return false方式</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return handleSubmit()&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">handleSubmit</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	<span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上例中我们监听了表单的<code>onsubmit</code>事件，当点击按钮或者按下回车时，将会触发<code>handleSubmit</code>方法，同时会阻止表单的提交。</p>
<blockquote>
<p>表单内如果有type&#x3D;”submit”的按钮存在，按下回车时就会自动提交。</p>
</blockquote>
<p>HTML监听方式阻止默认事件需要满足以下两点：</p>
<ol>
<li>HTML事件监听代码<code>return handler()</code>，<code>return不能少</code>，少了就无法阻止默认行为</li>
<li><code>handler()</code>函数需要返回<code>false</code></li>
</ol>
<h4 id="event-preventDefault"><a href="#event-preventDefault" class="headerlink" title="event.preventDefault()"></a>event.preventDefault()</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.ddhigh.com&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;handleClick(event)&quot;</span> <span class="attr">id</span>=<span class="string">&quot;click&quot;</span>&gt;</span>Href<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">function</span> <span class="title function_">handleClick</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">&#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="DOM0级事件方式"><a href="#DOM0级事件方式" class="headerlink" title="DOM0级事件方式"></a>DOM0级事件方式</h3><blockquote>
<p>DOM0级事件支持return false和event.preventDefault()两种方式。</p>
</blockquote>
<h4 id="event-preventDefault-1"><a href="#event-preventDefault-1" class="headerlink" title="event.preventDefault()"></a>event.preventDefault()</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// event.preventDefault()</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.ddhigh.com&quot;</span> <span class="attr">id</span>=<span class="string">&quot;click&quot;</span>&gt;</span>Href<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#click&#x27;</span>).<span class="property">onclick</span>= <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  	event.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="return-false"><a href="#return-false" class="headerlink" title="return false"></a>return false</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// return false</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.ddhigh.com&quot;</span> <span class="attr">id</span>=<span class="string">&quot;click&quot;</span>&gt;</span>Href<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">	<span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#click&#x27;</span>).<span class="property">onclick</span>= <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  	<span class="keyword">return</span> <span class="literal">false</span>;</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>两种方式都能工作，不过建议使用<code>event.preventDefault()</code>，原因在下面DOM2级会讲到</p>
<h3 id="DOM2级事件"><a href="#DOM2级事件" class="headerlink" title="DOM2级事件"></a>DOM2级事件</h3><blockquote>
<p>DOM2级事件事件**只支持event.preventDefault()**方式，这也是事件的标准处理方法。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.ddhigh.com&quot;</span> <span class="attr">id</span>=<span class="string">&quot;click&quot;</span>&gt;</span>Href<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#click&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">	e.<span class="title function_">preventDefault</span>();</span></span><br><span class="line"><span class="language-javascript">&#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="事件冒泡与事件捕获"><a href="#事件冒泡与事件捕获" class="headerlink" title="事件冒泡与事件捕获"></a>事件冒泡与事件捕获</h2><p>先来看一个HTML结构</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;child&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;son&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们知道，一旦绑定了事件处理程序，在事件触发时，事件处理函数都会触发。</p>
<p>如果我们给father&#x2F;child&#x2F;son都绑定了事件处理函数，点击了son时，谁被触发呢？</p>
<p>事实上，三个函数都会被触发，因为son时child的子元素，child又是father的子元素，点击son，同时也点击了father和child。</p>
<p>由此带来一个问题，三个函数谁先触发，谁后触发呢？这就是我们常说的事件流，father-&gt;child-&gt;son这种路径是可以的，但是son-&gt;child-&gt;father这种路径也是可以的。</p>
<p>针对这两种方式，W3C给了我们一个答案，两种方式都支持，即可以从父元素到子元素，又可以从子元素到父元素，前者叫<strong>事件捕获</strong>，后者叫<strong>事件冒泡</strong>。</p>
<h3 id="事件捕获"><a href="#事件捕获" class="headerlink" title="事件捕获"></a>事件捕获</h3><p>事件发生时采取<code>自上而下</code>的方式进行触发，最先触发的是<code>window</code>，其次是<code>document</code>，然后根据DOM层级依次触发，最终进入到真正的事件元素。</p>
<blockquote>
<p>addEventListener第三个参数传入true就是捕获方式的标志。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;child&quot;</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;son&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#father&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;father&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#child&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#son&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;son&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>点击son之后的输出顺序为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">father</span><br><span class="line">child</span><br><span class="line">son</span><br></pre></td></tr></table></figure>

<h3 id="事件冒泡"><a href="#事件冒泡" class="headerlink" title="事件冒泡"></a>事件冒泡</h3><p>事件发生时采取<code>自下而上</code>的方式进行触发，最先触发的是发生事件的元素，其次是父元素，依次向上，最终触发到<code>document</code>和<code>window</code>。</p>
<blockquote>
<p>addEventListener第三个参数传入false就是捕获冒泡的标志。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;child&quot;</span>&gt;</span></span><br><span class="line">  	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;son&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#father&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;father&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#child&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#son&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">  	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;son&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">  &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">	</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>点击son之后的输出顺序为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">son</span><br><span class="line">child</span><br><span class="line">father</span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于事件捕获和事件冒泡机制，我们需要一个标记来标识真正触发事件的元素，这个元素就是event.target，而另外一个相似的属性叫event.currentTarget，这是当前元素。</p>
</blockquote>
<h3 id="事件捕获和时间冒泡的顺序"><a href="#事件捕获和时间冒泡的顺序" class="headerlink" title="事件捕获和时间冒泡的顺序"></a>事件捕获和时间冒泡的顺序</h3><blockquote>
<p>根据浏览器规范，事件捕获会先于事件冒泡发生。因此，总的事件顺序如下</p>
</blockquote>
<ol>
<li>window 捕获阶段</li>
<li>document 捕获阶段</li>
<li>… 依次到真正触发事件的元素 捕获阶段</li>
<li>真正触发事件的元素 冒泡阶段</li>
<li>依次向上的父元素 冒泡阶段</li>
<li>document  冒泡阶段</li>
<li>window 冒泡阶段</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;child&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;son&quot;</span>&gt;</span>Click<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#father&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;father捕获&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#child&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child捕获&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#son&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;son捕获&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#father&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;father冒泡&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#child&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;child冒泡&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#son&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;son冒泡&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>点击son之后的输出为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">father捕获</span><br><span class="line">child捕获</span><br><span class="line">son捕获</span><br><span class="line">son冒泡</span><br><span class="line">child冒泡</span><br><span class="line">father冒泡</span><br></pre></td></tr></table></figure>

<h2 id="事件绑定和事件委托"><a href="#事件绑定和事件委托" class="headerlink" title="事件绑定和事件委托"></a>事件绑定和事件委托</h2><p>弄明白浏览器的事件流机制之后，来讨论事件绑定和事件委托其实是很简单的事情。</p>
<h3 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h3><p>就是在事件监听方式中直接对具体元素进行事件监听的方式。有个明显的缺点，对于新增加的DOM节点是无法监听到事件的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a&quot;</span>&gt;</span>click1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a&quot;</span>&gt;</span>click2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.a&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">ele</span> =&gt;</span> ele.<span class="property">onclick</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;clicked &#x27;</span> + <span class="variable language_">this</span>.<span class="property">innerHTML</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> div3 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        div3.<span class="property">className</span> = <span class="string">&quot;a&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        div3.<span class="property">innerHTML</span> = <span class="string">&quot;click3&quot;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div3)</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">500</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上面的click3点击是没有任何反应的，因为在创建该元素时没有绑定事件处理函数。</p>
<h3 id="事件委托"><a href="#事件委托" class="headerlink" title="事件委托"></a>事件委托</h3><p>我们利用事件流机制来实现上面的需求。</p>
<blockquote>
<p>事件委托就是利用事件流机制，在父元素进行监听，由于事件冒泡机制，父元素可以接受新添加元素的事件。</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a&quot;</span>&gt;</span>click1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;a&quot;</span>&gt;</span>click2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">target</span>.<span class="property">innerHTML</span>)</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> div3 = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        div3.<span class="property">className</span> = <span class="string">&quot;a&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        div3.<span class="property">innerHTML</span> = <span class="string">&quot;click3&quot;</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(div3)</span></span><br><span class="line"><span class="language-javascript">    &#125;, <span class="number">500</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于事件冒泡机制，click3元素点击之后会将事件冒泡给父元素，也就是我们的document.body，通过event.target可以拿到真正触发事件的元素。</p>
<p>（完）</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-12-19T04:00:00.000Z" title="12/19/2019, 4:00:00 AM">2019-12-19</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">21 minutes lesen (Über 3206 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/12/19/2019-12-19-webpack-get-started.html">Webpack4不求人系列(1)</a></p><div class="content"><blockquote>
<p>Webpack是一个现在Javascript应用程序的模块化打包器，在Webpack中JS&#x2F;CSS&#x2F;图片等资源都被视为JS模块，简化了编程。当Webpack构建时，会递归形成一个模块依赖关系图，然后将所有的模块打包为一个或多个bundle。</p>
</blockquote>
<p><img src="https://static.ddhigh.com/blog/2019-12-19-024407.jpg" alt="img"></p>
<p>本文内容</p>
<ol>
<li>简介</li>
<li>常用loader &amp;&amp; plugin</li>
<li>传统网站的webpack配置</li>
</ol>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>要系统地学习Webpack，需要先了解Webpack的四个<strong>核心概念</strong>:</p>
<ul>
<li>入口(entry)</li>
<li>输出(output)</li>
<li>loader</li>
<li>plugin</li>
</ul>
<p>webpack使用Node.js运行，因此所有的Node.js模块都可以使用，比如文件系统、路径等模块。</p>
<p>对Node.js基础不太了解的读者，可以参考我的<a href="https://www.ddhigh.com/2019/07/25/nodejs-guide-next-step.html">Node.js系列</a></p>
<p>配置文件<code>webpack.config.js</code>的一般格式为:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>); <span class="comment">// 导入Node.js的path模块</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;development&#x27;</span>, <span class="comment">// 工作模式</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index&#x27;</span>, <span class="comment">// 入口点</span></span><br><span class="line">  <span class="attr">output</span>: &#123; <span class="comment">// 输出配置</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>), <span class="comment">// 输出文件的目录</span></span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&#x27;scripts/[name].[hash:8].js&#x27;</span>, <span class="comment">// 输出JS模块的配置</span></span><br><span class="line">    <span class="attr">chunkFilename</span>:<span class="string">&#x27;scripts/[name].[chunkhash:8].js&#x27;</span>, <span class="comment">// 公共JS配置</span></span><br><span class="line">    <span class="attr">publicPath</span>:<span class="string">&#x27;/&#x27;</span> <span class="comment">// 资源路径前缀，一般会使用CDN地址，这样图片和CSS就会使用CDN的绝对URL</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>:&#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>:<span class="regexp">/\.(png|gif|jpg)$/</span>, <span class="comment">// 图片文件</span></span><br><span class="line">        <span class="attr">use</span>:[</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>:<span class="string">&#x27;file-loader&#x27;</span>, <span class="comment">// 使用file-loader加载</span></span><br><span class="line">            <span class="attr">options</span>:&#123; <span class="comment">// file-loader使用的加载选项</span></span><br><span class="line">              <span class="attr">name</span>:<span class="string">&#x27;images/[name].[hash:8].[ext]&#x27;</span> <span class="comment">// 图片文件打包后的输出路径配置</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[ <span class="comment">// 插件配置</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Webpack自己只管JS模块的输出，也就是output.filename是JS的配置，CSS、图片这些是通过loader来处理输出的</p>
</blockquote>
<h3 id="入口"><a href="#入口" class="headerlink" title="入口"></a>入口</h3><p>入口指明了Webpack从哪个模块开始进行构建，Webpack会分析入口模块依赖到的模块(直接或间接)，最终输出到一个被称为<em>bundle</em>的文件中。</p>
<blockquote>
<p>使用<strong>entry</strong>来配置项目入口。</p>
</blockquote>
<p><strong>单一入口</strong></p>
<p>最终只会生成1个js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&#x27;./src/index&#x27;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>多个入口</strong></p>
<p>最终会根据入口数量生成对应的js文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>:&#123;</span><br><span class="line">  	<span class="attr">home</span>:<span class="string">&#x27;./src/home/index&#x27;</span>, <span class="comment">// 首页JS</span></span><br><span class="line">    <span class="attr">about</span>:<span class="string">&#x27;./src/about/index&#x27;</span> <span class="comment">// 关于页JS</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>多个入口一般会在多页面应用中使用，比如传统的新闻网站。</p>
<h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p>输出指明了Webpack将bundle输出到哪个目录，以及这些bundle如何命名等，默认的目录为<code>./dist</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">output</span>:&#123;</span><br><span class="line">    <span class="attr">path</span>:path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>), <span class="comment">// 输出路径</span></span><br><span class="line">    <span class="attr">filename</span>:<span class="string">&#x27;scripts/[name].[hash:8].js&#x27;</span>, <span class="comment">// 输出JS模块的文件名规范</span></span><br><span class="line">    <span class="attr">chunkFilename</span>:<span class="string">&#x27;scripts/[name].[chunkhash:8].js&#x27;</span>, <span class="comment">// 公共JS的配置</span></span><br><span class="line">    <span class="attr">publicPath</span>:<span class="string">&#x27;/&#x27;</span>, <span class="comment">// 资源路径前缀，一般会使用CDN地址，这样图片和CSS就会使用CDN的绝对URL</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>path</strong></p>
<p>path是打包后bundle的输出目录，<strong>必须使用绝对路径</strong>。所有类型的模块(js&#x2F;css&#x2F;图片等)都会输出到该目录中，当然，我们可以通过配置输出模块的名称规则来输出到path下的子目录。比如上例中最终输出的JS目录如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|----dist</span><br><span class="line">		 |---- scripts</span><br><span class="line">		 			 |---- home.aaaaaaaa.js</span><br></pre></td></tr></table></figure>

<p><strong>filename</strong></p>
<p><strong>入口模块</strong>输出的命名规则，在Webpack中，只有js是亲儿子，可以直接被Webpack处理，其他类型的文件(css&#x2F;images等)需要通过loader来进行转换。</p>
<p>filename的常用的命名如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[name].[hash].js</span><br></pre></td></tr></table></figure>

<ul>
<li>[name] 为定义入口模块的名称，比如定义了home的入口点，这里的name最终就是home</li>
<li>[hash] 是模块内容的MD5值，一次打包过程中所有模块的hash值是相同的，由于浏览器会按照文件名缓存，因此每次打包都需要指定hash来改变文件名，从而清除缓存。</li>
</ul>
<p><strong>chunkFilename</strong></p>
<p><strong>非入口模块</strong>输出的命名规则，一般是代码中引入其他依赖，同时使用了optimization.splitChunks配置会抽取该类型的chunk</p>
<p><strong>hash</strong></p>
<p>Webpack中常见的hash有<code>hash</code>,<code>contenthash</code>,<code>chunkhash</code>，很容易弄混淆，这里说明一下。</p>
<ul>
<li>hash 整个项目公用的hash值，不管修改项目的什么文件，该值都会变化</li>
<li>chunkhash 公共代码模块的hash值，只要不改该chunk下的代码，该值不会变化</li>
<li>contenthash 基于文件内容生成的hash，只要改了文件，对应的hash都会变化</li>
</ul>
<p><strong>publicPath</strong></p>
<p>资源的路径前缀，打包之后的资源默认情况下都是相对路径，当更改了部署路径或者需要使用CDN地址时，该选项比较常用。</p>
<p>比如我们把本地编译过程中产生的所有资源都放到一个CDN路径中，可以这么定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publicPath: &#x27;https://static.ddhigh.com/blog/&#x27;</span><br></pre></td></tr></table></figure>

<p>那么最终编译的js,css,image等路径都是绝对链接。</p>
<h3 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h3><p>loader用来在import时预处理文件，一般用来将非JS模块转换为JS能支持的模块，比如我们直接import一个css文件会提示错误，此时就需要loader做转换了。</p>
<p>比如我们使用loader来加载css文件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>:&#123;</span><br><span class="line">    <span class="attr">rules</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(css)$/</span>,</span><br><span class="line">				<span class="attr">use</span>: [<span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="配置方式"><a href="#配置方式" class="headerlink" title="配置方式"></a>配置方式</h4><p>Webpack中有<strong>3</strong>种使用loader的方式：</p>
<ol>
<li>配置式：在webpack.config.js根据文件类型进行配置，这是推荐的配置</li>
<li>内联：在代码中import时指明loader</li>
<li>命令行：通过cli命令行配置</li>
</ol>
<h4 id="配置式"><a href="#配置式" class="headerlink" title="配置式"></a>配置式</h4><p><strong>module.rules</strong>用来配置loader。<strong>test</strong>用来对加载的**文件名(包括目录)**进行正则匹配，只有当匹配时才会应用对应loader。</p>
<blockquote>
<p>多个loader配置时从右向左进行应用</p>
</blockquote>
<p>配置式Webpack的loader也有好几种形式，有些是为了兼容而添加的，主要使用的方式有以下3种。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">module</span>:&#123;</span><br><span class="line">    <span class="attr">rules</span>:[</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        <span class="attr">loader</span>:<span class="string">&#x27;css-loader!less-loader&#x27;</span>, <span class="comment">// 多个loader中用感叹号分隔</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>:<span class="regexp">/\.css/</span>,</span><br><span class="line">        <span class="attr">use</span>:[<span class="string">&#x27;css-loader&#x27;</span>],<span class="comment">//数组形式</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>:<span class="regexp">/\.(png|gif|jpg)$/</span>,</span><br><span class="line">        <span class="attr">use</span>:[ <span class="comment">// loader传递参数时建议该方法</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>:&#123; <span class="comment">// file-loader自己的参数，跟webpack无关</span></span><br><span class="line">              <span class="attr">name</span>: <span class="string">&#x27;images/[name].[hash:8].js&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>每个loader的options参数不一定相同，这个需要查看对应loader的官方文档。</p>
</blockquote>
<h3 id="Plugin"><a href="#Plugin" class="headerlink" title="Plugin"></a>Plugin</h3><p>loader一般用来做模块转换，而插件可以执行更多的任务，包括打包优化、压缩、文件拷贝等等。插件的功能非常强大，可以进行各种各样的任务。</p>
<p>下面是打包之前清空dist目录的插件配置示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">	<span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(),</span><br><span class="line">      ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>插件也可以传入选项，一般在实例化时进行传入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">MiniCssPlugin</span>(&#123;</span><br><span class="line">	<span class="attr">filename</span>: <span class="string">&#x27;styles/[name].[contenthash:8].css&#x27;</span>,</span><br><span class="line">  <span class="attr">chunkFilename</span>: <span class="string">&#x27;styles/[name].[contenthash:8].css&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="提取公共代码"><a href="#提取公共代码" class="headerlink" title="提取公共代码"></a>提取公共代码</h2><p>Webpack4中提取公共代码只需要配置optimization.splitChunks即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">	<span class="attr">splitChunks</span>: &#123;</span><br><span class="line">  	<span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">    	<span class="attr">vendor</span>: &#123; <span class="comment">// 名为vendor的chunk</span></span><br><span class="line">      	<span class="attr">name</span>: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">        <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">        <span class="attr">priority</span>: <span class="number">10</span></span><br><span class="line">      &#125;,</span><br><span class="line">      	<span class="attr">styles</span>: &#123; <span class="comment">// 名为styles的chunk</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;styles&#x27;</span>,</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<ul>
<li>cacheGroups 缓存组</li>
<li>name chunk的名称</li>
<li>test 加载的模块符合该正则时被打包到该chunk</li>
<li>chunks 模块的范围，有initial(初始模块),async(按需加载模块),all(全部模块)</li>
</ul>
<p>上面的例子中将node_modules中的js打包为vendor，以css结尾的打包为styles</p>
<h2 id="常用的loader和plugin"><a href="#常用的loader和plugin" class="headerlink" title="常用的loader和plugin"></a>常用的loader和plugin</h2><h3 id="css-loader"><a href="#css-loader" class="headerlink" title="css-loader"></a>css-loader</h3><blockquote>
<p> 加载css文件</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>:<span class="regexp">/\.css$/</span></span><br><span class="line">  <span class="attr">loader</span>:[<span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="less-loader"><a href="#less-loader" class="headerlink" title="less-loader"></a>less-loader</h3><blockquote>
<p>加载less文件，一般需要配合css-loader</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>:<span class="regexp">/\.less$/</span>,</span><br><span class="line">  <span class="attr">loader</span>:[<span class="string">&#x27;css-loader&#x27;</span>,<span class="string">&#x27;less-loader&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="file-loader"><a href="#file-loader" class="headerlink" title="file-loader"></a>file-loader</h3><blockquote>
<p>将文件拷贝到输出文件夹，并返回相对路径。一般常用在加载图片</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>:<span class="regexp">/\.(png|gif|jpg)/</span>,</span><br><span class="line">  <span class="attr">use</span>:[</span><br><span class="line">  	&#123;</span><br><span class="line">      <span class="attr">loader</span>:<span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>:&#123;</span><br><span class="line">        <span class="attr">name</span>:<span class="string">&#x27;images/[name].[hash:8].[ext]&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="babel-loader"><a href="#babel-loader" class="headerlink" title="babel-loader"></a>babel-loader</h3><blockquote>
<p>转换ES2015+代码到ES5</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>:<span class="regexp">/\.js$/</span>,</span><br><span class="line">  <span class="attr">exclude</span>: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除指定的模块</span></span><br><span class="line">  <span class="attr">use</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">loader</span>:<span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">      <span class="attr">options</span>:&#123;</span><br><span class="line">        <span class="attr">presets</span>:[<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ts-loader"><a href="#ts-loader" class="headerlink" title="ts-loader"></a>ts-loader</h3><blockquote>
<p>转换Typescript到Javascript</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">test</span>:<span class="regexp">/\.ts/</span>,</span><br><span class="line">  <span class="attr">loader</span>:<span class="string">&#x27;ts-loader&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="html-webpack-plugin"><a href="#html-webpack-plugin" class="headerlink" title="html-webpack-plugin"></a>html-webpack-plugin</h3><blockquote>
<p>简化HTML的创建，该插件会自动将当前打包的资源(如JS、CSS)自动引用到HTML文件</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> =  &#123;</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="clean-webpack-plugin"><a href="#clean-webpack-plugin" class="headerlink" title="clean-webpack-plugin"></a>clean-webpack-plugin</h3><blockquote>
<p>打包之前清理dist目录</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CleanWebpackPlugin</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> =  &#123;</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>()</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="mini-css-extract-plugin"><a href="#mini-css-extract-plugin" class="headerlink" title="mini-css-extract-plugin"></a>mini-css-extract-plugin</h3><blockquote>
<p>提取、压缩CSS，需要同时配置loader和plugin</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> =  &#123;</span><br><span class="line">  <span class="attr">module</span>:&#123;</span><br><span class="line">    <span class="attr">rules</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="title class_">MiniCssPlugin</span>.<span class="property">loader</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="title class_">MiniCssPlugin</span>.<span class="property">loader</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssPlugin</span>(&#123;</span><br><span class="line">			<span class="attr">filename</span>: <span class="string">&#x27;styles/[name].[contenthash:8].css&#x27;</span>,</span><br><span class="line">      <span class="attr">chunkFilename</span>: <span class="string">&#x27;styles/[name].[contenthash:8].css&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h2><p>下面使用Webpack来配置一个传统多页面网站开发的示例。</p>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">├── package.json</span><br><span class="line">├── src</span><br><span class="line">│   ├── about						关于页</span><br><span class="line">│   │   ├── index.html</span><br><span class="line">│   │   ├── index.js</span><br><span class="line">│   │   └── style.less</span><br><span class="line">│   ├── common</span><br><span class="line">│   │   └── style.less</span><br><span class="line">│   └── home						首页</span><br><span class="line">│       ├── images</span><br><span class="line">│       │   └── logo.png</span><br><span class="line">│       ├── index.html</span><br><span class="line">│       ├── index.js</span><br><span class="line">│       └── style.less</span><br><span class="line">├── webpack.config.js</span><br></pre></td></tr></table></figure>

<h3 id="使用到的npm包"><a href="#使用到的npm包" class="headerlink" title="使用到的npm包"></a>使用到的npm包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&quot;clean-webpack-plugin&quot;: &quot;^3.0.0&quot;,</span><br><span class="line">&quot;css-loader&quot;: &quot;^3.2.1&quot;,</span><br><span class="line">&quot;exports-loader&quot;: &quot;^0.7.0&quot;,</span><br><span class="line">&quot;extract-text-webpack-plugin&quot;: &quot;^4.0.0-beta.0&quot;,</span><br><span class="line">&quot;file-loader&quot;: &quot;^5.0.2&quot;,</span><br><span class="line">&quot;html-webpack-plugin&quot;: &quot;^3.2.0&quot;,</span><br><span class="line">&quot;html-withimg-loader&quot;: &quot;^0.1.16&quot;,</span><br><span class="line">&quot;less&quot;: &quot;^3.10.3&quot;,</span><br><span class="line">&quot;less-loader&quot;: &quot;^5.0.0&quot;,</span><br><span class="line">&quot;mini-css-extract-plugin&quot;: &quot;^0.8.0&quot;,</span><br><span class="line">&quot;normalize.css&quot;: &quot;^8.0.1&quot;,</span><br><span class="line">&quot;script-loader&quot;: &quot;^0.7.2&quot;,</span><br><span class="line">&quot;style-loader&quot;: &quot;^1.0.1&quot;,</span><br><span class="line">&quot;url-loader&quot;: &quot;^3.0.0&quot;,</span><br><span class="line">&quot;webpack&quot;: &quot;^4.41.2&quot;,</span><br><span class="line">&quot;webpack-cli&quot;: &quot;^3.3.10&quot;,</span><br><span class="line">&quot;webpack-dev-server&quot;: &quot;^3.9.0&quot;,</span><br><span class="line">&quot;zepto&quot;: &quot;^1.2.0&quot;</span><br></pre></td></tr></table></figure>

<h3 id="配置入口点"><a href="#配置入口点" class="headerlink" title="配置入口点"></a>配置入口点</h3><p>由于是传统多页网站，每个页面都需要单独打包一份JS，因此<strong>每个页面需要一个入口</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">entry</span>: &#123; <span class="comment">// 入口配置，每个页面一个入口JS</span></span><br><span class="line">        <span class="attr">home</span>: <span class="string">&#x27;./src/home/index&#x27;</span>, <span class="comment">// 首页</span></span><br><span class="line">        <span class="attr">about</span>: <span class="string">&#x27;./src/about/index&#x27;</span> <span class="comment">// 关于页</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置输出"><a href="#配置输出" class="headerlink" title="配置输出"></a>配置输出</h3><p>本例我们不进行CDN部署，因此输出点配置比较简单。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output</span>: &#123; <span class="comment">// 输出配置</span></span><br><span class="line">  <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;dist&#x27;</span>), <span class="comment">// 输出资源目录</span></span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&#x27;scripts/[name].[hash:8].js&#x27;</span>, <span class="comment">// 入口点JS命名规则</span></span><br><span class="line">  <span class="attr">chunkFilename</span>: <span class="string">&#x27;scripts/[name]:[chunkhash:8].js&#x27;</span>, <span class="comment">// 公共模块命名规则 </span></span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&#x27;/&#x27;</span> <span class="comment">// 资源路径前缀</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置开发服务器"><a href="#配置开发服务器" class="headerlink" title="配置开发服务器"></a>配置开发服务器</h3><p>本地开发时不需要每次都编译完Webpack再访问，通过webpack-dev-server，我们可以边开发变查看效果，文件会实时编译。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">devServer</span>: &#123;</span><br><span class="line">        <span class="attr">contentBase</span>: <span class="string">&#x27;./dist&#x27;</span>, <span class="comment">// 开发服务器配置</span></span><br><span class="line">        <span class="attr">hot</span>: <span class="literal">true</span> <span class="comment">// 热加载</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h3 id="配置loader"><a href="#配置loader" class="headerlink" title="配置loader"></a>配置loader</h3><p>本例中没有使用ES6进行编程，但是引用了一个非CommonJS的js模块<code>Zepto</code>，传统用法中在HTML页面引入Zepto就会在window下挂载全局对象Zepto。但是在Webpack开发中不建议使用全局变量，否则模块化的优势将受到影响。</p>
<p>通过使用exports-loader和script-loader，我们可以将Zepto包装为CommonJS模块进入导入。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="built_in">require</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;zepto&#x27;</span>),</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;exports-loader?window.Zepto!script-loader&#x27;</span> <span class="comment">// 将window.Zepto包装为CommonJS模块</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="title class_">MiniCssPlugin</span>.<span class="property">loader</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [<span class="title class_">MiniCssPlugin</span>.<span class="property">loader</span>, <span class="string">&#x27;css-loader&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(png|jpg|gif)$/</span>,</span><br><span class="line">                <span class="attr">use</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&#x27;file-loader&#x27;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="attr">name</span>: <span class="string">&#x27;images/[name].[hash:8].[ext]&#x27;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.(htm|html)$/i</span>,</span><br><span class="line">                <span class="attr">loader</span>: <span class="string">&#x27;html-withimg-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="配置optimization"><a href="#配置optimization" class="headerlink" title="配置optimization"></a>配置optimization</h3><p>主要进行公共模块的打包配置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">optimization</span>: &#123;</span><br><span class="line">        <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">            <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">                <span class="attr">vendor</span>: &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&quot;vendor&quot;</span>,</span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                    <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">                    <span class="attr">priority</span>: <span class="number">10</span>, <span class="comment">// 优先级</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">styles</span>: &#123;</span><br><span class="line">                    <span class="attr">name</span>: <span class="string">&#x27;styles&#x27;</span>,</span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                    <span class="attr">chunks</span>: <span class="string">&#x27;all&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="配置plugin"><a href="#配置plugin" class="headerlink" title="配置plugin"></a>配置plugin</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins</span>: [</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">CleanWebpackPlugin</span>(), <span class="comment">// 清理发布目录</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">chunks</span>: [<span class="string">&#x27;home&#x27;</span>, <span class="string">&#x27;vendor&#x27;</span>, <span class="string">&#x27;styles&#x27;</span>], <span class="comment">// 声明本页面使用到的模块，有主页，公共JS以及公共CSS</span></span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span>, <span class="comment">// 输出路径，这里直接输出到dist的根目录，也就是dist/index.html</span></span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/home/index.html&#x27;</span>, <span class="comment">// HTML模板文件路径</span></span><br><span class="line">            <span class="attr">minify</span>: &#123; </span><br><span class="line">                <span class="attr">removeComments</span>: <span class="literal">true</span>, <span class="comment">// 移除注释</span></span><br><span class="line">                <span class="attr">collapseWhitespace</span>: <span class="literal">true</span> <span class="comment">// 合并空格</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">chunks</span>: [<span class="string">&#x27;about&#x27;</span>, <span class="string">&#x27;vendor&#x27;</span>, <span class="string">&#x27;styles&#x27;</span>],</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;about/index.html&#x27;</span>, <span class="comment">// 输出到dist/about/index.html</span></span><br><span class="line">            <span class="attr">template</span>: <span class="string">&#x27;./src/about/index.html&#x27;</span>,</span><br><span class="line">            <span class="attr">minify</span>: &#123;</span><br><span class="line">                <span class="attr">removeComments</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">collapseWhitespace</span>: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">MiniCssPlugin</span>(&#123;</span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;styles/[name].[contenthash:8].css&#x27;</span>,</span><br><span class="line">            <span class="attr">chunkFilename</span>: <span class="string">&#x27;styles/[name].[contenthash:8].css&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> webpack.<span class="title class_">NamedModulesPlugin</span>(), <span class="comment">// 热加载使用</span></span><br><span class="line">        <span class="keyword">new</span> webpack.<span class="title class_">HotModuleReplacementPlugin</span>() <span class="comment">// 热加载使用</span></span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<h3 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h3><p>部分示例代码如下:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/about/index.js</span></span><br><span class="line"><span class="keyword">const</span> $ = <span class="built_in">require</span>(<span class="string">&#x27;zepto&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;normalize.css&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;../common/style.less&#x27;</span>);</span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./style.less&#x27;</span>);</span><br><span class="line"></span><br><span class="line">$(<span class="string">&#x27;#about&#x27;</span>).<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">&#x27;点击了about按钮&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>和传统的JS有点不太一样，多了一些css的require，前面说过，webpack把所有资源当做JS模块，因此这是推荐的做法。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--首页--&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>关于<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;home&quot;</span>&gt;</span>首页按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>页面中不再需要编写JS。</p>
<blockquote>
<p>注意：html中使用<img />标签导入图片的编译，目前还没有好的解决办法，可以通过css background的形式进行处理</p>
</blockquote>
<h3 id="开发模式"><a href="#开发模式" class="headerlink" title="开发模式"></a>开发模式</h3><p>开发模式下直接启用webpack-dev-server即可，会自动加载工作目录下的webpack.config.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// package.json</span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">    &quot;build&quot;: &quot;webpack&quot;,</span><br><span class="line">    &quot;dev&quot;: &quot;webpack-dev-server&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h3 id="生产模式"><a href="#生产模式" class="headerlink" title="生产模式"></a>生产模式</h3><p>生产模式下使用webpack编译，编译完成后输出最终文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></table></figure>

<h3 id="输出效果"><a href="#输出效果" class="headerlink" title="输出效果"></a>输出效果</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">├── about</span><br><span class="line">│   └── index.html</span><br><span class="line">├── images</span><br><span class="line">│   └── logo.b15c113a.png</span><br><span class="line">├── index.html</span><br><span class="line">├── scripts</span><br><span class="line">│   ├── about.3fb4aa0f.js</span><br><span class="line">│   ├── home.3fb4aa0f.js</span><br><span class="line">│   └── vendor:ed5b7d31.js</span><br><span class="line">└── styles</span><br><span class="line">    ├── about.71eb65e9.css</span><br><span class="line">    ├── home.cd2738e6.css</span><br><span class="line">    └── vendor.9df34e21.css</span><br></pre></td></tr></table></figure>

<h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><p>项目已经托管到github，有需要的读者可以自取。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/xialeistudio/webpack-multipage-example">https://github.com/xialeistudio/webpack-multipage-example</a></p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-11-14T09:00:00.000Z" title="11/14/2019, 9:00:00 AM">2019-11-14</time></span><span class="level-item"><a class="link-muted" href="/categories/backend/">backend</a><span> / </span><a class="link-muted" href="/categories/backend/mysql/">mysql</a></span><span class="level-item">4 minutes lesen (Über 570 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/14/2019-11-14-mysql-char-varchar-max-length.html">MySQL中的CHAR和VARCHAR到底支持多长?</a></p><div class="content"><p>最近在研究MySQL的数据类型，我们知道，选择合适的数据类型和数据长度对MySQL的性能影响是不可忽视的，小字段意味着可以MySQL可以读取更多的记录，从而加快查询速度。</p>
<p>网上该问题的答案有很多版本，还是通过实践得出的结论比较靠谱。</p>
<p>先说结论(MySQL版本5.7.27)</p>
<ul>
<li>CHAR最大255<strong>字符</strong>，字符集对CHAR没有影响，CHAR()括号内填写最大字符数255</li>
<li>VARCHAR最大65535<strong>字节</strong>，字符集对VARCHAR有影响<ul>
<li>UTF8字符集，每个字符大小3字节，所以65535&#x2F;3 &#x3D; 21845，最大支持21845字符，因此VARCHAR()括号中最大填写21845字符</li>
<li>GBK字符集，每个字符大小2字节，所以65535&#x2F;2 &#x3D; 32767.5，最大支持32767<strong>字符</strong>，因此VARCHAR()括号中最大填写32767字符</li>
</ul>
</li>
</ul>
<h2 id="验证过程"><a href="#验证过程" class="headerlink" title="验证过程"></a>验证过程</h2><h3 id="CHAR"><a href="#CHAR" class="headerlink" title="CHAR"></a>CHAR</h3><p>UTF8字符集(1个字符占用3个字节)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test`.`demo`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) UNSIGNED <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `title` <span class="type">char</span>(<span class="number">256</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci;</span><br></pre></td></tr></table></figure>

<p>MySQL提示错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1074 - Column length too big for column &#x27;title&#x27; (max = 255); use BLOB or TEXT instead</span><br></pre></td></tr></table></figure>

<p>GBK字符集(1个字符占用2个字节)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test`.`demo`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) UNSIGNED <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `title` <span class="type">char</span>(<span class="number">256</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> gbk <span class="keyword">COLLATE</span> <span class="operator">=</span> gbk_chinese_ci;</span><br></pre></td></tr></table></figure>

<p>MySQL提示错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1074 - Column length too big for column &#x27;title&#x27; (max = 255); use BLOB or TEXT instead</span><br></pre></td></tr></table></figure>

<blockquote>
<p>结论：CHAR最大长度和字符集没有关系，因此CHAR()括号内填写字符大小，最终数据的字节大小随着字符集不同而不同</p>
</blockquote>
<h3 id="VARCHAR"><a href="#VARCHAR" class="headerlink" title="VARCHAR"></a>VARCHAR</h3><p>UTF8字符集(1个字符占用3个字节)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test`.`demo`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) UNSIGNED <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">65535</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8_general_ci;</span><br></pre></td></tr></table></figure>

<p>MySQL提示错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1074 - Column length too big for column &#x27;title&#x27; (max = 21845); use BLOB or TEXT instead</span><br></pre></td></tr></table></figure>

<p>MySQL提示的最大长度为21845，通过UTF8字符集的大小可知VARCHAR()括号中指的是字符大小。</p>
<p>UTF8MB4字符集(1个字符占用4个字节)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `test`.`demo`  (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">0</span>) UNSIGNED <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">65535</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_general_ci;</span><br></pre></td></tr></table></figure>

<p>MySQL提示错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1074 - Column length too big for column &#x27;title&#x27; (max = 16383); use BLOB or TEXT instead</span><br></pre></td></tr></table></figure>

<p>MySQL提示的最大长度为16383，通过UTF8MB4字符集大小可知VARCHAR()括号中指的是字符大小。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-11-14T03:00:00.000Z" title="11/14/2019, 3:00:00 AM">2019-11-14</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">4 minutes lesen (Über 622 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/14/2019-11-13-es6-iterator.html">深入浅出ES6的迭代器</a></p><div class="content"><p>迭代器是ES2015中新增的规范，与之相关的for…of也是ES2015新增的。</p>
<p>本文来深入研究一下迭代器是什么，以及迭代器能够干什么？</p>
<p>或许你对for … of的执行还不了解，比如什么情况下可以使用for … of去遍历对象，什么情况下会报错等等，这篇文章应该能帮到你。</p>
<h2 id="迭代器协议"><a href="#迭代器协议" class="headerlink" title="迭代器协议"></a>迭代器协议</h2><blockquote>
<p> for … of只能迭代满足【迭代器协议】的对象</p>
</blockquote>
<p>可迭代对象的必须存在[Symbol.iterator]方法，该方法一个无参函数，返回迭代器协议的对象。</p>
<p>迭代器对象包含一个<code>next()</code>函数，该函数返回值有两种:</p>
<ul>
<li><p>如果迭代未结束，返回如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="string">&#x27;item&#x27;</span>, <span class="comment">// item是本次迭代值，可以为任意对象</span></span><br><span class="line">  <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果迭代已结束，返回如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>下面是未提供迭代器的示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> item <span class="keyword">of</span> obj) &#123; <span class="comment">// TypeError: obj is not iterable</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是提供迭代器的示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">    [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]: <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// 迭代器属性</span></span><br><span class="line">        <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>); <span class="comment">// 读取对象键列表</span></span><br><span class="line">        <span class="keyword">let</span> keyIndex = <span class="number">0</span>; <span class="comment">// 遍历未知</span></span><br><span class="line">        <span class="keyword">const</span> self = <span class="variable language_">this</span>; <span class="comment">// 保存this，next中的function会有自己的this</span></span><br><span class="line">        <span class="keyword">return</span> &#123; <span class="comment">// 返回带有next()的对象</span></span><br><span class="line">            <span class="attr">next</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (keyIndex &lt; keys.<span class="property">length</span>) &#123; <span class="comment">// 防止越界</span></span><br><span class="line">                    <span class="keyword">const</span> key = keys[keyIndex];</span><br><span class="line">                    keyIndex++; <span class="comment">// 移动到下一个位置</span></span><br><span class="line">                    <span class="keyword">return</span> &#123;</span><br><span class="line">                        <span class="attr">value</span>: [key, self[key]], <span class="comment">// 键值对数组</span></span><br><span class="line">                        <span class="attr">done</span>: <span class="literal">false</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> &#123; <span class="comment">// 遍历结束</span></span><br><span class="line">                    <span class="attr">done</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>通过给obj提供迭代器方法让obj也可以使用for…of遍历。</p>
<p>直接去理解迭代器概念比较困难，用一个简单的例子去简化理解是一件很容易的事情。</p>
<h2 id="其他可迭代对象"><a href="#其他可迭代对象" class="headerlink" title="其他可迭代对象"></a>其他可迭代对象</h2><p><code>String</code>,<code>Array</code>,<code>Map</code>,<code>Set</code>,<code>TypedArray</code>是所有内置的可迭代对象，他们的原型对象都有一个[Symbol.iterator]方法。</p>
<p>下面是两种方法迭代String对象的示例。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for ... of</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xialei&#x27;</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> char <span class="keyword">of</span> str) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(char);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// iterator</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">&#x27;xialei&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> iterator = str[<span class="title class_">Symbol</span>.<span class="property">iterator</span>](); <span class="comment">// 返回一个&#123;next:方法&#125;对象</span></span><br><span class="line"><span class="keyword">let</span> obj = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    obj = iterator.<span class="title function_">next</span>(); <span class="comment">// 返回的是对象，&#123;value:任意对象,done:布尔型&#125;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">value</span>);</span><br><span class="line">&#125;<span class="keyword">while</span>(!obj.<span class="property">done</span>);</span><br></pre></td></tr></table></figure>

<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>迭代器协议虽然一般用的比较少，但是了解其原理是非常有必要的，这样才可以才需要的实现定义自己的迭代器来遍历对象。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-11-04T04:00:00.000Z" title="11/4/2019, 4:00:00 AM">2019-11-04</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">14 minutes lesen (Über 2128 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/04/2019-11-04-es6-proxy.html">深入浅出ES6的标准内置对象Proxy</a></p><div class="content"><p>Proxy是ES6规范定义的标准内置对象，可以对目标对象的读取、函数调用等操作进行拦截。一般来说，通过Proxy可以让目标对象“可控”，比如是否能调用对象的某个方法，能否往对象添加属性等等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> originalObj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> publicObj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(originalObj, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">        <span class="comment">// 将属性值转化为大写</span></span><br><span class="line">        target[prop] = value.<span class="title function_">toString</span>().<span class="title function_">toUpperCase</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">publicObj.<span class="property">name</span> = <span class="string">&#x27;xialei&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(publicObj.<span class="property">name</span>); <span class="comment">// XIALEI</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>从上例可以看出Proxy不需要更改目标对象(也就是originalObj)，就可以对originalObj的行为进行拦截。</p>
</blockquote>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><blockquote>
<p>let obj &#x3D; new Proxy(target, handler);</p>
</blockquote>
<ul>
<li>target <code>Object</code> 目标对象。可以是任何类型的对象，甚至包括原生对象（比如数组，函数，另一个Proxy对象）</li>
<li>handler <code>Object</code> 代理行为对象。访问目标对象时会自动触发该handler的对应属性。</li>
</ul>
<p>和大多数开发者一样，刚开始学习Proxy的时候，这个handler不知道是个什么东西，什么时候能触发。</p>
<p>先看一个简单的例子，看看handler到底是什么东西。假设我们开发一个游戏脚本，由于内存修改器的盛行，我们需要对内存中的数据进行安全处理，但是不能影响外部使用，我们使用Proxy完成这个功能。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gameObj = &#123;</span><br><span class="line">    <span class="attr">hp</span>: <span class="number">0</span></span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> publicGameObj = <span class="keyword">new</span> <span class="title class_">Proxy</span>(gameObj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> target[prop]/<span class="number">2</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">      target[prop] = value*<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  publicGameObj.<span class="property">hp</span> = <span class="number">10000</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(publicGameObj.<span class="property">hp</span>, gameObj); <span class="comment">// 10000 &#123;hp: 20000&#125;</span></span><br></pre></td></tr></table></figure>

<p>gameObj是我们在内存中真实存储数据的地方，可以看到HP是20000，但是publicGameObj.hp是10000，外部使用publicGameObj.hp即可(比如UI层展示HP为10000);</p>
<h3 id="例程handler使用到的属性"><a href="#例程handler使用到的属性" class="headerlink" title="例程handler使用到的属性"></a>例程handler使用到的属性</h3><ul>
<li>get <code>publicGameObj.hp</code>进行了读取操作，因此会自动触发handler的get方法</li>
<li>set <code>publicGameObj.hp=10000</code>进行了赋值操作，因此为自动触发handler的set方法</li>
</ul>
<h2 id="handler对象"><a href="#handler对象" class="headerlink" title="handler对象"></a>handler对象</h2><p>handler对象是Proxy的核心基础，所有对目标对象的操作都需要通过handler来处理，虽然内容有点多，但是常用的不多。</p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul>
<li>目标对象 被代理的对象。外部不能直接访问(当然语法上是可以访问的，你都用上Proxy了，还访问他干嘛?)</li>
<li>代理对象 new Proxy的返回值。外部直接访问。目标对象会作为handler对应函数的参数传入</li>
<li>带*号的是常用属性</li>
</ul>
<blockquote>
<p>所有访问都是对代理对象访问才会触发，直接访问目标对象不会触发(代理对象压根没参与进来，如果触发那一定是出bug了)</p>
</blockquote>
<h3 id="handler-getPrototypeOf-target"><a href="#handler-getPrototypeOf-target" class="headerlink" title="handler.getPrototypeOf(target)"></a>handler.getPrototypeOf(target)</h3><p>说明：获取目标对象的原型</p>
<p>触发时机：Object.getPrototypeOf(代理对象)</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>Object</code> 对象的原型</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [];</span><br><span class="line"><span class="keyword">const</span> myArray = <span class="keyword">new</span> <span class="title class_">Proxy</span>(array, &#123;</span><br><span class="line">  <span class="title function_">getPrototypeOf</span>(<span class="params">target</span>) &#123;</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取对象原型&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(array);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(myArray));</span><br><span class="line"><span class="comment">// 输出</span></span><br><span class="line"><span class="comment">// 读取对象原型</span></span><br><span class="line"><span class="comment">// []</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-setPrototypeOf-target-prototype"><a href="#handler-setPrototypeOf-target-prototype" class="headerlink" title="handler.setPrototypeOf(target, prototype)"></a>handler.setPrototypeOf(target, prototype)</h3><p>说明：设置对象的原型</p>
<p>触发时机：Object.setPrototypeOf(代理对象, 原型)<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prototype <code>Object</code> 原型对象或null</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 设置成功返回true，否则返回false(比如不让设置)</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [];</span><br><span class="line"><span class="keyword">const</span> myArray = <span class="keyword">new</span> <span class="title class_">Proxy</span>(array, &#123;</span><br><span class="line">    <span class="title function_">setPrototypeOf</span>(<span class="params">target, prototype</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(target, prototype);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(myArray, <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(myArray)); <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-isExtensible-target"><a href="#handler-isExtensible-target" class="headerlink" title="handler.isExtensible(target)"></a>handler.isExtensible(target)</h3><p>说明：检测对象是否可扩展(个人理解：也就是能否添加属性、函数)<br>触发时机：Object.isExtensible(代理对象)<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
</ul>
<p>返回参数：</p>
<ul>
<li><code>boolean</code></li>
</ul>
<h3 id="handler-preventExtensions-target"><a href="#handler-preventExtensions-target" class="headerlink" title="handler.preventExtensions(target)"></a>handler.preventExtensions(target)</h3><p>说明：设置目标对象为不可扩展<br>触发时机：Object.preventExtensions(代理对象)<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 设置目标对象不可扩展后返回true，不管是否设置目标对象不可扩展，返回false都会报错</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">preventExtensions</span>(<span class="params">target</span>) &#123;</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">preventExtensions</span>(target);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">preventExtensions</span>(p);</span><br><span class="line"></span><br><span class="line">p.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p); <span class="comment">// &#123;&#125; 目标对象不可扩展，所以a属性设置不进去</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-getOwnPropertyDescriptor-target-prop"><a href="#handler-getOwnPropertyDescriptor-target-prop" class="headerlink" title="*handler.getOwnPropertyDescriptor(target, prop)"></a>*handler.getOwnPropertyDescriptor(target, prop)</h3><p>说明：获取目标对象属性的描述符</p>
<p>触发时机：Object.getOwnPropertyDescriptor(代理对象)</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>&lt;string|Symbol|number&gt;</code> 属性名</li>
</ul>
<p>返回参数：</p>
<ul>
<li><code>Object</code> 属性描述符</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">getOwnPropertyDescriptor</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> target[prop];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyDescriptor</span>(obj, <span class="string">&#x27;a&#x27;</span>)); <span class="comment">// &#123; value: 1, writable: true, enumerable: true, configurable: true &#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-defineProperty-target-prop-properties"><a href="#handler-defineProperty-target-prop-properties" class="headerlink" title="*handler.defineProperty(target,prop,properties)"></a>*handler.defineProperty(target,prop,properties)</h3><p>说明：在对象上定义属性(添加新属性或修改现有属性)<br>触发时机：Object.defineProperty(代理对象，属性名，属性描述对象)<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
<li>properties <code>Object</code> 属性描述对象</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 定义成功返回true，定义失败或不允许定义返回false</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">name2</span>: <span class="string">&#x27;xx&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">defineProperty</span>(<span class="params">target, prop, properties</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop === <span class="string">&#x27;name&#x27;</span>) &#123;</span><br><span class="line">            <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(target, prop, properties);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(p, <span class="string">&#x27;name&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(p, <span class="string">&#x27;name2&#x27;</span>, &#123; <span class="comment">// TypeError</span></span><br><span class="line">    <span class="attr">value</span>: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="handler-has-target-prop"><a href="#handler-has-target-prop" class="headerlink" title="*handler.has(target, prop)"></a>*handler.has(target, prop)</h3><p>说明：判断对象是否有指定属性<br>触发时机：prop in 代理对象<br>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code></li>
</ul>
<h3 id="handler-get-target-prop-receiver"><a href="#handler-get-target-prop-receiver" class="headerlink" title="*handler.get(target, prop, receiver)"></a>*handler.get(target, prop, receiver)</h3><p>说明: 属性读取器<br>触发时机：读取代理对象的属性时触发</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
<li>receiver <code>Proxy</code> 代理对象或者原型链上的代理对象</li>
</ul>
<p>返回值：</p>
<ul>
<li>任何值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title class_">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="keyword">return</span> target[prop].<span class="title function_">toUpperCase</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p.<span class="property">name</span>); <span class="comment">// XIALEI</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-set-target-prop-value-receiver"><a href="#handler-set-target-prop-value-receiver" class="headerlink" title="*handler.set(target, prop, value, receiver)"></a>*handler.set(target, prop, value, receiver)</h3><p>说明：属性写入访问器<br>触发时机：对代理对象的属性进行赋值时触发</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
<li>value <code>any</code> 属性值</li>
<li>receiver <code>Proxy</code> 代理对象或原型链上的代理对象</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 赋值成功返回true，否则返回false。严格模式下返回false会抛出TypeError</li>
</ul>
<h3 id="handler-deleteProperty-target-prop"><a href="#handler-deleteProperty-target-prop" class="headerlink" title="*handler.deleteProperty(target, prop)"></a>*handler.deleteProperty(target, prop)</h3><p>说明：删除对象属性<br>触发时机：对代理对象的属性进行delete时触发</p>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标对象</li>
<li>prop <code>string|number|Symbol</code> 属性名</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>boolean</code> 删除成功返回true，否则返回false。严格模式下返回false会抛出TypeError</li>
</ul>
<h3 id="handler-apply-target-thisArg-args"><a href="#handler-apply-target-thisArg-args" class="headerlink" title="*handler.apply(target, thisArg, args)"></a>*handler.apply(target, thisArg, args)</h3><p>说明：拦截函数调用，被代理对象必须是函数<br>触发时机：</p>
<ul>
<li>直接调用函数 obj.xxx()或xxx()</li>
<li>apply&#x2F;call</li>
</ul>
<p>参数：</p>
<ul>
<li>target <code>Object</code> 目标函数</li>
<li>thisArg <code>Object</code> this对象</li>
<li>args <code>Array</code> 参数列表</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>any</code> 任何值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">sum</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> absSum = <span class="keyword">new</span> <span class="title class_">Proxy</span>(sum, &#123;</span><br><span class="line">    <span class="title function_">apply</span>(<span class="params">target, thisArg, args</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> value = target.<span class="title function_">apply</span>(thisArg, args);</span><br><span class="line">        <span class="keyword">return</span> value &lt; <span class="number">0</span> ? -value : value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">absSum</span>(-<span class="number">1</span>, -<span class="number">2</span>)); <span class="comment">// 3，因为被拦截了</span></span><br></pre></td></tr></table></figure>

<h3 id="handler-construct-target-args"><a href="#handler-construct-target-args" class="headerlink" title="*handler.construct(target,args)"></a>*handler.construct(target,args)</h3><p>说明：拦截构造过程<br>触发时机：new 目标构造函数(…args)</p>
<p>参数：</p>
<ul>
<li>target <code>Function</code> 构造函数</li>
<li>args <code>Array</code> 构造函数的参数</li>
</ul>
<p>返回值：</p>
<ul>
<li><code>Object</code> 对象</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> P = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="title class_">Person</span>, &#123;</span><br><span class="line">    <span class="title function_">construct</span>(<span class="params">target, args, newTarget</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(newTarget, newTarget === P, newTarget === <span class="title class_">Person</span>); <span class="comment">// [Function: Person] true false</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">target</span>(args[<span class="number">0</span>].<span class="title function_">toUpperCase</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="title function_">P</span>(<span class="string">&#x27;xialei&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(p); <span class="comment">// Person &#123; name: &#x27;XIALEI&#x27; &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><ul>
<li><p>保护目标对象(通过钩子方法进行拦截)</p>
</li>
<li><p>数据转换(上文有一个内存保护的例子)</p>
</li>
<li><p>数据验证(不符合规则的值不允许设置)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> privateUser = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">phone</span>: <span class="string">&#x27;13888888888&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(privateUser, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop === <span class="string">&#x27;phone&#x27;</span> &amp;&amp; !<span class="regexp">/^(\+86)?1[\d]&#123;10&#125;$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        target[prop] = value;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">user.<span class="property">phone</span> = <span class="string">&#x27;13666666666&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">phone</span>); <span class="comment">// 13666666666</span></span><br><span class="line">user.<span class="property">phone</span> = <span class="string">&#x27;+8613777777777&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">phone</span>); <span class="comment">// +8613777777777</span></span><br><span class="line">user.<span class="property">phone</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">phone</span>); <span class="comment">// +8613777777777</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>数据修正(也做数据标准化)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> privateUser = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">phone</span>: <span class="string">&#x27;13888888888&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">Proxy</span>(privateUser, &#123;</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop === <span class="string">&#x27;phone&#x27;</span> &amp;&amp; !<span class="regexp">/^(\+86)?1[\d]&#123;10&#125;$/</span>.<span class="title function_">test</span>(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        target[prop] = value.<span class="title function_">replace</span>(<span class="string">&#x27;+86&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">user.<span class="property">phone</span> = <span class="string">&#x27;+8613666666666&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(user.<span class="property">phone</span>); <span class="comment">// 13666666666</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>添加实用方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>, <span class="attr">phone</span>: <span class="string">&#x27;13888888888&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;xialei1&#x27;</span>, <span class="attr">phone</span>: <span class="string">&#x27;13899999999&#x27;</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mList = <span class="keyword">new</span> <span class="title class_">Proxy</span>(list, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prop <span class="keyword">in</span> target) &#123;</span><br><span class="line">            <span class="keyword">return</span> target[prop];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> target) &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.<span class="property">name</span> === prop) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> firstItem = mList[<span class="number">0</span>];</span><br><span class="line"><span class="keyword">const</span> itemXialei = mList[<span class="string">&quot;xialei&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(firstItem); <span class="comment">// &#123; name: &#x27;xialei&#x27;, phone: &#x27;13888888888&#x27; &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(itemXialei);<span class="comment">// &#123; name: &#x27;xialei&#x27;, phone: &#x27;13888888888&#x27; &#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>提供易用API</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 本例对localStorage做了封装，可以像普通对象一样操作localStorage,而不需要调用方法</span></span><br><span class="line"><span class="keyword">const</span> storage = <span class="keyword">new</span> <span class="title class_">Proxy</span>(<span class="variable language_">localStorage</span>, &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(prop);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(<span class="params">target, prop, value</span>) &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(prop, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">deleteProperty</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(prop);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">has</span>(<span class="params">target, prop</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(prop) !== <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">storage.<span class="property">aaa</span> = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(storage.<span class="property">aaa</span>); <span class="comment">// &#x27;1&#x27;</span></span><br><span class="line"><span class="keyword">delete</span> storage.<span class="property">aaa</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(storage.<span class="property">aaa</span>); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Proxy的语法虽然简单，但是可谓前途无量，比如开了一个Virtual Dom框架也是可以的。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-31T04:00:00.000Z" title="10/31/2019, 4:00:00 AM">2019-10-31</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">4 minutes lesen (Über 541 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/31/2019-10-31-es6-set.html">ES6的Set类型</a></p><div class="content"><p>本文内容</p>
<ul>
<li>Set的基本使用</li>
<li>常用用法</li>
</ul>
<blockquote>
<p>Set 对象允许你存储任何类型的唯一值，无论是原始值或者是对象引用。</p>
</blockquote>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Set</span>([iterator])</span><br></pre></td></tr></table></figure>

<ul>
<li>iterator <Iterator> 与Map类似，Set接收一个可选的Iterator对象，所有元素将按照顺序不重复地添加到Set中。传递null或者undefined将返回一个空Set</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line"><span class="comment">// 添加元素</span></span><br><span class="line">set.<span class="title function_">add</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 移除元素</span></span><br><span class="line">set.<span class="title function_">delete</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 检测元素是否存在</span></span><br><span class="line">set.<span class="title function_">has</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 清空Set</span></span><br><span class="line">set.<span class="title function_">clear</span>();</span><br></pre></td></tr></table></figure>

<h2 id="数据类型的唯一性判定"><a href="#数据类型的唯一性判定" class="headerlink" title="数据类型的唯一性判定"></a>数据类型的唯一性判定</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(<span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line">set.</span><br><span class="line">    <span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>).<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>).</span><br><span class="line">    <span class="title function_">add</span>(<span class="number">1</span>).<span class="title function_">add</span>(<span class="number">1</span>).</span><br><span class="line">    <span class="title function_">add</span>(<span class="literal">true</span>).<span class="title function_">add</span>(<span class="literal">true</span>).</span><br><span class="line">    <span class="title function_">add</span>(<span class="literal">null</span>).<span class="title function_">add</span>(<span class="literal">null</span>).</span><br><span class="line">    <span class="title function_">add</span>(<span class="literal">undefined</span>).<span class="title function_">add</span>(<span class="literal">undefined</span>)</span><br><span class="line">    .<span class="title function_">add</span>(<span class="title class_">NaN</span>).<span class="title function_">add</span>(<span class="title class_">NaN</span>)</span><br><span class="line">    .<span class="title function_">add</span>(&#123;&#125;).<span class="title function_">add</span>(&#123;&#125;)</span><br><span class="line">    .<span class="title function_">add</span>([]).<span class="title function_">add</span>([])</span><br><span class="line">    .<span class="title function_">add</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;).<span class="title function_">add</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set);</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Set &#123;</span><br><span class="line">  &#x27;string&#x27;,</span><br><span class="line">  1,</span><br><span class="line">  true,</span><br><span class="line">  null,</span><br><span class="line">  undefined,</span><br><span class="line">  NaN,</span><br><span class="line">  &#123;&#125;,</span><br><span class="line">  &#123;&#125;,</span><br><span class="line">  [],</span><br><span class="line">  [],</span><br><span class="line">  [Function],</span><br><span class="line">  [Function]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><ul>
<li>string&#x2F;number&#x2F;boolean&#x2F;null&#x2F;undefined&#x2F;NaN是使用值判重<ul>
<li>NaN!&#x3D;&#x3D;NaN，但是Set也只会存一份，所以值判定应该不完全是用&#x3D;&#x3D;&#x3D;做的</li>
</ul>
</li>
<li>object&#x2F;array&#x2F;function等object类型使用引用判重</li>
</ul>
<h2 id="Set的迭代"><a href="#Set的迭代" class="headerlink" title="Set的迭代"></a>Set的迭代</h2><p>for…of</p>
<blockquote>
<p>由于Set实现了Symol.iteator方法，所以可以使用for…of迭代</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(<span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line">set.<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>).<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> v <span class="keyword">of</span> set.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forEach</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(<span class="literal">undefined</span>);</span><br><span class="line"></span><br><span class="line">set.<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>).<span class="title function_">add</span>(<span class="string">&quot;string&quot;</span>);</span><br><span class="line"></span><br><span class="line">set.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">value</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>Set和数组相互转化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> array = [<span class="number">1</span>,<span class="number">2</span>];</span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(array); <span class="comment">// 数组转化为set</span></span><br><span class="line"><span class="keyword">const</span> newArray = [...set]; <span class="comment">// set转化为数组</span></span><br></pre></td></tr></table></figure>

<p>去除字符串重复字符</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="string">&#x27;aabbcc&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(s);</span><br><span class="line"><span class="keyword">const</span> newString = [...set].<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newString); <span class="comment">// abc</span></span><br></pre></td></tr></table></figure>

<p>数组去重</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>(list);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>([...set]); <span class="comment">// [1,2,3]</span></span><br></pre></td></tr></table></figure>

<p>并集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">const</span> set2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br><span class="line"><span class="keyword">const</span> set3 = <span class="keyword">new</span> <span class="title class_">Set</span>([...set], [...set2]); <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>交集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">const</span> set2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br><span class="line"><span class="keyword">const</span> set3 = <span class="keyword">new</span> <span class="title class_">Set</span>([...set].<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> set2.<span class="title function_">has</span>(item))); <span class="comment">// [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>差集</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> set = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]);</span><br><span class="line"><span class="keyword">const</span> set2 = <span class="keyword">new</span> <span class="title class_">Set</span>([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]);</span><br><span class="line"><span class="keyword">const</span> set3 = <span class="keyword">new</span> <span class="title class_">Set</span>([...set2].<span class="title function_">filter</span>(<span class="function"><span class="params">item</span> =&gt;</span> !set.<span class="title function_">has</span>(item))); <span class="comment">// [4], 注意set2和set的顺序</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在需要唯一性的场景中，Set使用起来比数组要方便许多，比如添加标签，这个肯定是不重复的，用Set去实现就可以省去重复判断之类的操作，可以专注业务逻辑。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-30T04:00:00.000Z" title="10/30/2019, 4:00:00 AM">2019-10-30</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">8 minutes lesen (Über 1270 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/30/2019-10-30-es6-map.html">ES6的Map类型</a></p><div class="content"><p>本文内容</p>
<ul>
<li>Map的基本使用</li>
<li>Map支持的数据类型</li>
<li>Map的迭代</li>
<li>Map与其他对象的转化</li>
</ul>
<p>在Map出现之前，要实现类似需求，只能使用Object，但是Object还是存在一些问题的。</p>
<ul>
<li>如果使用Object作为key存储在{}中，key最终是当做<code>[object Object]</code>来使用的</li>
<li>Object的keys是无序的</li>
<li>无法安全遍历Object</li>
<li>无法直接获取Object大小</li>
</ul>
<blockquote>
<p>Map 对象保存键值对。任何值(对象或者原始值) 都可以作为一个键或一个值。</p>
</blockquote>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Map</span>([iterator])</span><br></pre></td></tr></table></figure>

<ul>
<li>iterator <Iterator> 可以是一个数组或者其他iterator对象，其元素为键值对(如<code>[&#39;key&#39;, &#39;value&#39;]</code>)。</li>
<li>null或undefined不会生效，返回一个空的Map</li>
<li>非iterator会抛出错误 <code>TypeError: object is not iterable</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="comment">// Create</span></span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;xialei&#x27;</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;https://www.ddhigh.com&#x27;</span>);</span><br><span class="line"><span class="comment">// Update</span></span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;xialeistudio&#x27;</span>);</span><br><span class="line"><span class="comment">// Read</span></span><br><span class="line">map.<span class="title function_">get</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="comment">// Delete</span></span><br><span class="line">map.<span class="title function_">delete</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="comment">// 清空</span></span><br><span class="line">map.<span class="title function_">clear</span>();</span><br><span class="line"><span class="comment">// map大小</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="property">size</span>);</span><br></pre></td></tr></table></figure>

<h2 id="数据类型测试"><a href="#数据类型测试" class="headerlink" title="数据类型测试"></a>数据类型测试</h2><p>JS中基本数据类型有string、number、boolean、null、undefined、symbol，复杂数据类型有object(包括object,array,function等)，还有个特殊的NaN(typeof结果是number)，分别对这些类型进行测试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">const</span> sKey = <span class="string">&#x27;key&#x27;</span>,</span><br><span class="line">    nKey = <span class="number">1</span>,</span><br><span class="line">    bKey = <span class="literal">true</span>,</span><br><span class="line">    nullKey = <span class="literal">null</span>,</span><br><span class="line">    uKey = <span class="literal">undefined</span>,</span><br><span class="line">    symbolKey = <span class="title class_">Symbol</span>(<span class="string">&quot;key&quot;</span>),</span><br><span class="line">    oKey = &#123;&#125;,</span><br><span class="line">    ooKey = oKey,</span><br><span class="line">    aKey = [],</span><br><span class="line">    fKey = <span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;,</span><br><span class="line">    nanKey = <span class="title class_">NaN</span>;</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">set</span>(sKey, <span class="string">&quot;string&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(nKey, <span class="string">&quot;number&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(bKey, <span class="string">&quot;boolean&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(nullKey, <span class="string">&quot;null&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(uKey, <span class="string">&quot;undefined&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(symbolKey, <span class="string">&quot;symbol&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(oKey, <span class="string">&quot;object&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(aKey, <span class="string">&quot;array&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(fKey, <span class="string">&quot;function&quot;</span>)</span><br><span class="line">    .<span class="title function_">set</span>(nanKey, <span class="string">&quot;NaN&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(sKey) === <span class="string">&quot;string&quot;</span>, map.<span class="title function_">get</span>(<span class="string">&quot;key&quot;</span>) === <span class="string">&quot;string&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(nKey) === <span class="string">&quot;number&quot;</span>, map.<span class="title function_">get</span>(<span class="number">1</span>) === <span class="string">&quot;number&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(bKey) === <span class="string">&quot;boolean&quot;</span>, map.<span class="title function_">get</span>(<span class="literal">true</span>) === <span class="string">&quot;boolean&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(nullKey) === <span class="string">&quot;null&quot;</span>, map.<span class="title function_">get</span>(<span class="literal">null</span>) === <span class="string">&quot;null&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(uKey) === <span class="string">&quot;undefined&quot;</span>, map.<span class="title function_">get</span>(<span class="literal">undefined</span>) === <span class="string">&quot;undefined&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(symbolKey) === <span class="string">&quot;symbol&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(oKey) === <span class="string">&quot;object&quot;</span>, map.<span class="title function_">get</span>(&#123;&#125;) === <span class="string">&quot;object&quot;</span>, map.<span class="title function_">get</span>(oKey) === map.<span class="title function_">get</span>(ooKey));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(aKey) === <span class="string">&quot;array&quot;</span>, map.<span class="title function_">get</span>([]) === <span class="string">&quot;array&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(fKey) === <span class="string">&quot;function&quot;</span>, map.<span class="title function_">get</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123; &#125;) === <span class="string">&quot;function&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(nanKey) === <span class="string">&quot;NaN&quot;</span>, map.<span class="title function_">get</span>(<span class="title class_">NaN</span>) === <span class="string">&quot;NaN&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>输出如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Map &#123;</span><br><span class="line">  &#x27;key&#x27; =&gt; &#x27;string&#x27;,</span><br><span class="line">  1 =&gt; &#x27;number&#x27;,</span><br><span class="line">  true =&gt; &#x27;boolean&#x27;,</span><br><span class="line">  null =&gt; &#x27;null&#x27;,</span><br><span class="line">  undefined =&gt; &#x27;undefined&#x27;,</span><br><span class="line">  Symbol(key) =&gt; &#x27;symbol&#x27;,</span><br><span class="line">  &#123;&#125; =&gt; &#x27;object&#x27;,</span><br><span class="line">  [] =&gt; &#x27;array&#x27;,</span><br><span class="line">  [Function: fKey] =&gt; &#x27;function&#x27;,</span><br><span class="line">  NaN =&gt; &#x27;NaN&#x27;</span><br><span class="line">&#125;</span><br><span class="line">true true</span><br><span class="line">true true</span><br><span class="line">true true</span><br><span class="line">true true</span><br><span class="line">true true</span><br><span class="line">true</span><br><span class="line">true false true</span><br><span class="line">true false</span><br><span class="line">true false</span><br><span class="line">true true</span><br></pre></td></tr></table></figure>

<p>结论</p>
<ul>
<li>string&#x2F;number&#x2F;boolean&#x2F;null&#x2F;undefined&#x2F;NaN 按值存储，值一致即可访问</li>
<li>symbol必须是同一个Symbol才能访问，详见<a href="https://www.ddhigh.com/2019/10/28/symbol.html">深入浅出ES6的Symbol类型</a></li>
<li>object&#x2F;array&#x2F;function等Object类型按照引用访问，必须是同一个引用才可以访问</li>
<li>Map是<code>有序</code>的，按照插入顺序</li>
<li>Map.set方法支持链式操作</li>
</ul>
<h2 id="Map的迭代"><a href="#Map的迭代" class="headerlink" title="Map的迭代"></a>Map的迭代</h2><h4 id="for…of"><a href="#for…of" class="headerlink" title="for…of"></a>for…of</h4><p>同时迭代键值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [k, v] <span class="keyword">of</span> map) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 迭代器版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [k, v] <span class="keyword">of</span> map.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>迭代键</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> k <span class="keyword">of</span> map.<span class="title function_">keys</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, map.<span class="title function_">get</span>(k));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 迭代器版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [k] <span class="keyword">of</span> map.<span class="title function_">entries</span>()) &#123; <span class="comment">// 解构赋值</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(k, map.<span class="title function_">get</span>(k));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>迭代值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> v <span class="keyword">of</span> map.<span class="title function_">values</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 迭代器版本</span></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> [,v] <span class="keyword">of</span> map.<span class="title function_">entries</span>()) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>forEach()</p>
<blockquote>
<p>forEach方法的顺序是value, key，不是key, value!</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&quot;2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">map.<span class="title function_">forEach</span>(<span class="function">(<span class="params">value, key</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(value, key);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="Map与其他类型的转换"><a href="#Map与其他类型的转换" class="headerlink" title="Map与其他类型的转换"></a>Map与其他类型的转换</h2><h3 id="Map与Object"><a href="#Map与Object" class="headerlink" title="Map与Object"></a>Map与Object</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">site</span>: <span class="string">&#x27;https://www.ddhigh.com&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>(obj);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map);</span><br></pre></td></tr></table></figure>

<p>执行报错<code>TypeError: object is not iterable</code>，因为Object不是可迭代对象。</p>
<blockquote>
<p>可迭代对象：ES6新出的语法，对象或对象的原型链实现了Symbol.iterator方法，关于迭代器的内容将在下一篇文章中详细介绍</p>
</blockquote>
<p>我们给Object.prototype添加属性方法来支持迭代：</p>
<blockquote>
<p>warning: 正式代码请谨慎修改原型链!</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">    <span class="attr">site</span>: <span class="string">&#x27;https://www.ddhigh.com&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// Symbol.iterator可以理解为全局唯一的标识</span></span><br><span class="line">    <span class="keyword">const</span> keys = <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>);</span><br><span class="line">    <span class="keyword">let</span> keyIndex = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (keyIndex &lt; keys.<span class="property">length</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> key = keys[keyIndex++];</span><br><span class="line">                <span class="keyword">return</span> &#123; <span class="attr">value</span>: [key, obj[key]] &#125;; <span class="comment">// 迭代值</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span> &#125;; <span class="comment">// 迭代结束</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>(obj);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map);</span><br></pre></td></tr></table></figure>

<h3 id="Map与数组"><a href="#Map与数组" class="headerlink" title="Map与数组"></a>Map与数组</h3><blockquote>
<p>只支持[[key, value]]这种二维数组。二维数组的每一个元素包含key和value两个子元素</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;xialeistudio&#x27;</span>], [<span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;https://www.ddhigh.com&#x27;</span>]]);</span><br></pre></td></tr></table></figure>

<h3 id="Map与Map"><a href="#Map与Map" class="headerlink" title="Map与Map"></a>Map与Map</h3><blockquote>
<p>由于Map是可迭代对象，因此可以作为参数传给Map构造函数</p>
<p>两个Map的元素是一样的，不是Map不相等，因为不是同一个对象</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;xialeistudio&#x27;</span>], [<span class="string">&#x27;site&#x27;</span>, <span class="string">&#x27;https://www.ddhigh.com&#x27;</span>]]);</span><br><span class="line"><span class="keyword">const</span> map2 = <span class="keyword">new</span> <span class="title class_">Map</span>(map);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map === map2); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>

<h3 id="Map的合并"><a href="#Map的合并" class="headerlink" title="Map的合并"></a>Map的合并</h3><blockquote>
<p>多个Map可以合并，相同key会被覆盖，规则为后面的覆盖前面的</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">    [<span class="number">2</span>, <span class="number">2</span>]</span><br><span class="line">]);</span><br><span class="line"><span class="keyword">const</span> map2 = <span class="keyword">new</span> <span class="title class_">Map</span>([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> map3 = <span class="keyword">new</span> <span class="title class_">Map</span>([...map, ...map2]);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map3); <span class="comment">// Map &#123; 1 =&gt; 2, 2 =&gt; 2 &#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Map的出现解决了传统object无法直接解决的问题，更好地向标准编程语言靠近(标准编程语言一般会提供Map集合)，使用的坑也比较少（比如没有object作为key时转换为[object Object]的问题）。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-30T04:00:00.000Z" title="10/30/2019, 4:00:00 AM">2019-10-30</time></span><span class="level-item"><a class="link-muted" href="/categories/other/">other</a></span><span class="level-item">10 minutes lesen (Über 1527 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/30/2019-10-30-twblog.html">我是如何发现我的文章被侵权以及如何得到侵权网站的联系方式的?</a></p><div class="content"><p>本文内容</p>
<ul>
<li>如何发现自己的文章被侵权</li>
<li>如何结合whois信息查询侵权网站的联系方式</li>
</ul>
<blockquote>
<p>声明：本文只做技术研究，请勿用于非法目的，如果恶意使用造成任何法律责任本人概不负责！</p>
</blockquote>
<h2 id="发现侵权"><a href="#发现侵权" class="headerlink" title="发现侵权"></a>发现侵权</h2><p>我的文章除了发布在博客之外，还会同步到思否平台。自己没事的时候会去看看百度统计，比较关注来源网站(也就是referer)，一般来说通过搜索引擎过来的流量我不太关注，私人网站过来的就比较关注了，昨天查看来源的时候看到了一个新网站。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-30-034117.png" alt="image-20191030111724873"></p>
<p>可以看到这个 <a target="_blank" rel="noopener" href="http://www.twblogs.net是一个普通网站,点进去发现这样一篇文章./">www.twblogs.net是一个普通网站，点进去发现这样一篇文章。</a></p>
<p><img src="https://static.ddhigh.com/blog/2019-10-30-031835.png" alt="image-20191030111833685"></p>
<p>可以看到这篇文章的作者是xialeistudio(也就是我常用的网络用户名)，可我压根就没听说过这个网站，我意识到可能被爬虫爬取了。</p>
<p>点击作者进入到作者的文章页，发现我昨天下午刚发布没多久的文章就被爬了。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-30-032027.png" alt="image-20191030112018569"></p>
<p>然后我去查看nginx的访问日志，没有发现异常访问，有个IP虽然是美国的，但是是Google的爬虫。这意味着文章不是直接爬取我的博客来的。</p>
<blockquote>
<p>nginx的访问日志过滤使用shell命令即可做到，不过这不是本文的重点，此处略过</p>
</blockquote>
<p>那就只剩下思否和掘金，通过文章中的公众号图片二维码，我发现了爬取的文章来源。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-30-032208.png" alt="image-20191030112207253"></p>
<p>可以看到是通过思否爬取到的。</p>
<h3 id="侵权结论"><a href="#侵权结论" class="headerlink" title="侵权结论"></a>侵权结论</h3><ul>
<li>伪造用户名爬取了思否大量的文章，截止发文时大概爬了三四十篇文章</li>
<li>思否应该并不知道这件事，应该早期的文章都爬过来了（包括我在思否已经删除的文章）</li>
</ul>
<h2 id="获取侵权网站联系方式"><a href="#获取侵权网站联系方式" class="headerlink" title="获取侵权网站联系方式"></a>获取侵权网站联系方式</h2><p>目前手头只有一个域名<a target="_blank" rel="noopener" href="https://www.twblogs.net/">https://www.twblogs.net</a>，先去站长工具的whois查询工具<a target="_blank" rel="noopener" href="http://whois.chinaz.com/">http://whois.chinaz.com/</a>查询一下。</p>
<blockquote>
<p>whois：用来查询域名注册信息的一种技术</p>
</blockquote>
<p>通过查询并没有得到什么有效的信息。看来是whois做了保护处理。</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-30-032650.png" alt="image-20191030112649319"></p>
<p>不过没关系，目前得到了twblogs.net的域名提供商是Goddy，我们可以到域名提供商的网站看一下Whois信息</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-30-032808.png" alt="image-20191030112807217"></p>
<p>浏览器打开whois.godaddy.com输入<a href="http://www.twblogs.net就可以了，查询到的Whois信息如下：">www.twblogs.net就可以了，查询到的Whois信息如下：</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">WHOIS 搜索结果</span><br><span class="line">Domain Name: twblogs.net</span><br><span class="line">Registry Domain ID: 2330628228_DOMAIN_NET-VRSN</span><br><span class="line">Registrar WHOIS Server: whois.godaddy.com</span><br><span class="line">Registrar URL: http://www.godaddy.com</span><br><span class="line">Updated Date: 2019-10-09T11:09:43Z</span><br><span class="line">Creation Date: 2018-11-08T16:30:46Z</span><br><span class="line">Registrar Registration Expiration Date: 2021-11-08T16:30:46Z</span><br><span class="line">Registrar: GoDaddy.com, LLC</span><br><span class="line">Registrar IANA ID: 146</span><br><span class="line">Registrar Abuse Contact Email: abuse@godaddy.com</span><br><span class="line">Registrar Abuse Contact Phone: +1.4806242505</span><br><span class="line">Domain Status: clientTransferProhibited http://www.icann.org/epp#clientTransferProhibited</span><br><span class="line">Domain Status: clientUpdateProhibited http://www.icann.org/epp#clientUpdateProhibited</span><br><span class="line">Domain Status: clientRenewProhibited http://www.icann.org/epp#clientRenewProhibited</span><br><span class="line">Domain Status: clientDeleteProhibited http://www.icann.org/epp#clientDeleteProhibited</span><br><span class="line">Registry Registrant ID: Not Available From Registry</span><br><span class="line">Registrant Name: kiwi robert</span><br><span class="line">Registrant Organization:</span><br><span class="line">Registrant Street: american</span><br><span class="line">Registrant City: austin</span><br><span class="line">Registrant State/Province: Anhui</span><br><span class="line">Registrant Postal Code: 73344</span><br><span class="line">Registrant Country: CN</span><br><span class="line">Registrant Phone: +86.15220288017</span><br><span class="line">Registrant Phone Ext:</span><br><span class="line">Registrant Fax:</span><br><span class="line">Registrant Fax Ext:</span><br><span class="line">Registrant Email: 898611548@qq.com</span><br><span class="line">Registry Admin ID: Not Available From Registry</span><br><span class="line">Admin Name: kiwi robert</span><br><span class="line">Admin Organization:</span><br><span class="line">Admin Street: american</span><br><span class="line">Admin City: austin</span><br><span class="line">Admin State/Province: Anhui</span><br><span class="line">Admin Postal Code: 73344</span><br><span class="line">Admin Country: CN</span><br><span class="line">Admin Phone: +86.15220288017</span><br><span class="line">Admin Phone Ext:</span><br><span class="line">Admin Fax:</span><br><span class="line">Admin Fax Ext:</span><br><span class="line">Admin Email: 898611548@qq.com</span><br><span class="line">Registry Tech ID: Not Available From Registry</span><br><span class="line">Tech Name: kiwi robert</span><br><span class="line">Tech Organization:</span><br><span class="line">Tech Street: american</span><br><span class="line">Tech City: austin</span><br><span class="line">Tech State/Province: Anhui</span><br><span class="line">Tech Postal Code: 73344</span><br><span class="line">Tech Country: CN</span><br><span class="line">Tech Phone: +86.15220288017</span><br><span class="line">Tech Phone Ext:</span><br><span class="line">Tech Fax:</span><br><span class="line">Tech Fax Ext:</span><br><span class="line">Tech Email: 898611548@qq.com</span><br><span class="line">Name Server: JOBS.NS.CLOUDFLARE.COM</span><br><span class="line">Name Server: LANA.NS.CLOUDFLARE.COM</span><br><span class="line">DNSSEC: unsigned</span><br><span class="line">URL of the ICANN WHOIS Data Problem Reporting System: http://wdprs.internic.net/</span><br><span class="line">&gt;&gt;&gt; Last update of WHOIS database: 2019-10-30T03:00:00Z &lt;&lt;&lt;</span><br></pre></td></tr></table></figure>

<p>可以看到域名注册者有点意思，<code>手机号是深圳的</code>,<code>省份是安徽的</code>，估计是<code>安徽人到深圳上班</code>。</p>
<p>拿到联系信息之后就通知思否小姐姐去发律师函了</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>通过百度统计发现来源网站</li>
<li>通过访问来源网站发现内容侵权</li>
<li>check博客服务器的nginx访问日志，看看有无明显异常的访问</li>
<li>通过文章中的图片发现文章是通过思否爬取的</li>
<li>检测侵权网站的whois信息，如果做了保护就去域名提供商获取whois</li>
<li>获取到联系方式之后可以联系思否小姐姐帮你处理，给思否点个赞，内容这块的响应速度很快</li>
</ol>
<p>大家发现侵权不要不作为，可以处理的方法如下：</p>
<ol>
<li>向国家新闻出版广电总局举报<a target="_blank" rel="noopener" href="http://www.sapprft.gov.cn/sapprft/channels/6979.shtml">http://www.sapprft.gov.cn/sapprft/channels/6979.shtml</a></li>
<li>联系平台（思否，知乎，掘金等等），平台会帮你发律师函啥的，毕竟内容使他们的根基</li>
</ol>
<blockquote>
<p>《中华人民共和国刑法》节选如下：</p>
<p>第二百一十七条　【侵犯著作权罪】以营利为目的，有下列侵犯著作权情形之一，违法所得数额较大或者有其他严重情节的，处三年以下有期徒刑或者拘役，并处或者单处罚金;违法所得数额巨大或者有其他特别严重情节的，<code>处三年以上七年以下有期徒刑，并处罚金</code>：</p>
<p>(一)未经著作权人许可，复制发行其文字作品、音乐、电影、电视、录像作品、计算机软件及其他作品的;</p>
<p>(二)出版他人享有专有出版权的图书的;</p>
<p>(三)未经录音录像制作者许可，复制发行其制作的录音录像的;</p>
<p>(四)制作、出售假冒他人署名的美术作品的。</p>
</blockquote>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-29T04:00:00.000Z" title="10/29/2019, 4:00:00 AM">2019-10-29</time></span><span class="level-item"><a class="link-muted" href="/categories/backend/">backend</a></span><span class="level-item">12 minutes lesen (Über 1788 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/29/2019-10-29-redis-high-concurrent.html">Redis优化高并发下的秒杀性能</a></p><div class="content"><p>本文内容</p>
<ul>
<li>使用Redis优化高并发场景下的接口性能</li>
<li>数据库乐观锁</li>
</ul>
<p>随着双11的临近，各种促销活动开始变得热门起来，比较主流的有秒杀、抢优惠券、拼团等等。</p>
<p>涉及到高并发争抢同一个资源的主要场景有秒杀和抢优惠券。</p>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h2><p>活动规则</p>
<ul>
<li>奖品数量有限，比如100个</li>
<li>不限制参与用户数</li>
<li>每个用户只能参与1次秒杀</li>
</ul>
<p>活动要求</p>
<ul>
<li>不能多发，也不能少发，100个奖品要全部发出去</li>
<li>1个用户最多抢1个奖品</li>
<li>遵循先到先得原则，先来的用户有奖品</li>
</ul>
<h2 id="数据库实现"><a href="#数据库实现" class="headerlink" title="数据库实现"></a>数据库实现</h2><p>悲观锁性能太差，本文不予讨论，讨论一下使用乐观锁解决高并发问题的优缺点。</p>
<h3 id="数据库结构"><a href="#数据库结构" class="headerlink" title="数据库结构"></a>数据库结构</h3><table>
<thead>
<tr>
<th>ID</th>
<th>Code</th>
<th>UserId</th>
<th>CreatedAt</th>
<th>RewardAt</th>
</tr>
</thead>
<tbody><tr>
<td>奖品ID</td>
<td>奖品码</td>
<td>用户ID</td>
<td>创建时间</td>
<td>中奖时间</td>
</tr>
</tbody></table>
<ul>
<li>未中奖时UserId为0，RewardAt为NULL</li>
<li>中奖时UserId为中奖用户ID，RewardAt为中奖时间</li>
</ul>
<h3 id="乐观锁实现"><a href="#乐观锁实现" class="headerlink" title="乐观锁实现"></a>乐观锁实现</h3><p>乐观锁实际上并不存在真正的锁，乐观锁是利用数据的某个字段来做的，比如本文的例子就是以UserId来实现的。</p>
<p>实现流程如下：</p>
<ol>
<li><p>查询UserId为0的奖品，如果未找到则提示无奖品</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> envelope <span class="keyword">WHERE</span> user_id<span class="operator">=</span><span class="number">0</span> LIMIT <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>更新奖品的用户ID和中奖时间(假设奖品ID为1，中奖用户ID为100，当前时间为2019-10-29 12:00:00)，这里的user_id&#x3D;0就是我们的乐观锁了。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> envelope <span class="keyword">SET</span> user_id<span class="operator">=</span><span class="number">100</span>, reward_at<span class="operator">=</span><span class="string">&#x27;2019-10-29 12:00:00&#x27;</span> <span class="keyword">WHERE</span> user_id<span class="operator">=</span><span class="number">0</span> <span class="keyword">AND</span> id<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>检测UPDATE语句的执行返回值，如果返回1证明中奖成功，否则证明该奖品被其他人抢了</p>
</li>
</ol>
<h4 id="为什么要添加乐观锁"><a href="#为什么要添加乐观锁" class="headerlink" title="为什么要添加乐观锁"></a>为什么要添加乐观锁</h4><p>正常情况下获取奖品、然后把奖品更新给指定用户是没问题的。如果不添加user_id&#x3D;0时，高并发场景下会出现下面的问题：</p>
<ol>
<li>两个用户同时查询到了1个未中奖的奖品(发生并发问题)</li>
<li>将奖品的中奖用户更新为用户1，更新条件只有ID&#x3D;奖品ID</li>
<li>上述SQL执行是成功的，影响行数也是1，此时接口会返回用户1中奖</li>
<li>接下来将中奖用户更新为用户2，更新条件也只有ID&#x3D;奖品ID</li>
<li>由于是同一个奖品，已经发给用户1的奖品会重新发放给用户2，此时影响行数为1，接口返回用户2也中奖</li>
<li>所以该奖品的最终结果是发放给用户2</li>
<li><code>用户1就会过来投诉活动方了，因为抽奖接口返回用户1中奖，但他的奖品被抢了，此时活动方只能赔钱了</code></li>
</ol>
<h4 id="添加乐观锁之后的抽奖流程"><a href="#添加乐观锁之后的抽奖流程" class="headerlink" title="添加乐观锁之后的抽奖流程"></a>添加乐观锁之后的抽奖流程</h4><ol>
<li>更新用户1时的条件为<code>id=红包ID AND user_id=0</code> ,由于此时红包未分配给任何人，用户1更新成功，接口返回用户1中奖</li>
<li>当更新用户2时更新条件为<code>id=红包ID AND user_id=0</code>，由于此时该红包已经分配给用户1了，所以该条件不会更新任何记录，接口返回用户2中奖</li>
</ol>
<h4 id="乐观锁优缺点"><a href="#乐观锁优缺点" class="headerlink" title="乐观锁优缺点"></a>乐观锁优缺点</h4><p>优点</p>
<ul>
<li>性能尚可，因为无锁</li>
<li>不会超发</li>
</ul>
<p>缺点</p>
<ul>
<li>通常不满足“先到先得”的活动规则，一旦发生并发，就会发生未中奖的情况，此时奖品库还有奖品</li>
</ul>
<h3 id="压测"><a href="#压测" class="headerlink" title="压测"></a>压测</h3><p>在MacBook Pro 2018上的压测表现如下(Golang实现的HTTP服务器,MySQL连接池大小100，Jmeter压测)：</p>
<ul>
<li>500并发 500总请求数 平均响应时间331ms 发放成功数为31 吞吐量458.7&#x2F;s</li>
</ul>
<h2 id="Redis实现"><a href="#Redis实现" class="headerlink" title="Redis实现"></a>Redis实现</h2><p>可以看到乐观锁的实现下争抢比太高，不是推荐的实现方法，下面通过Redis来优化这个秒杀业务。</p>
<h3 id="Redis高性能的原因"><a href="#Redis高性能的原因" class="headerlink" title="Redis高性能的原因"></a>Redis高性能的原因</h3><ul>
<li>单线程 省去了线程切换开销</li>
<li>基于内存的操作 虽然持久化操作涉及到硬盘访问，但是那是异步的，不会影响Redis的业务</li>
<li>使用了IO多路复用</li>
</ul>
<h3 id="实现流程"><a href="#实现流程" class="headerlink" title="实现流程"></a>实现流程</h3><ol>
<li><p>活动开始前将数据库中奖品的code写入Redis队列中</p>
</li>
<li><p>活动进行时使用lpop弹出队列中的元素</p>
</li>
<li><p>如果获取成功，则使用UPDATE语法发放奖品</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> reward <span class="keyword">SET</span> user_id<span class="operator">=</span>用户ID,reward_at<span class="operator">=</span>当前时间 <span class="keyword">WHERE</span> code<span class="operator">=</span><span class="string">&#x27;奖品码&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果获取失败，则当前无可用奖品，提示未中奖即可</p>
</li>
</ol>
<p>使用Redis的情况下并发访问是通过Redis的<code>lpop()</code>来保证的，该方法是原子方法，可以保证并发情况下也是一个个弹出的。</p>
<h3 id="压测-1"><a href="#压测-1" class="headerlink" title="压测"></a>压测</h3><p>在MacBook Pro 2018上的压测表现如下(Golang实现的HTTP服务器,MySQL连接池大小100，Redis连接池代销100，Jmeter压测)：</p>
<ul>
<li>500并发 500总请求数 平均响应时间48ms 发放成功数100 吞吐量497.0&#x2F;s</li>
</ul>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>可以看到Redis的表现是稳定的，不会出现超发，且访问延迟少了8倍左右，吞吐量还没达到瓶颈，可以看出Redis对于高并发系统的性能提升是非常大的！接入成本也不算高，值得学习！</p>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"></p>
<h2 id="实验代码"><a href="#实验代码" class="headerlink" title="实验代码"></a>实验代码</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.go</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/go-redis/redis&quot;</span></span><br><span class="line">	_ <span class="string">&quot;github.com/go-sql-driver/mysql&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/jinzhu/gorm&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Envelope <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id        <span class="type">int</span> <span class="string">`gorm:&quot;primary_key&quot;`</span></span><br><span class="line">	Code      <span class="type">string</span></span><br><span class="line">	UserId    <span class="type">int</span></span><br><span class="line">	CreatedAt time.Time</span><br><span class="line">	RewardAt  *time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Envelope)</span></span> TableName() <span class="type">string</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;envelope&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Envelope)</span></span> BeforeCreate() <span class="type">error</span> &#123;</span><br><span class="line">	p.CreatedAt = time.Now()</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">	QueueEnvelope = <span class="string">&quot;envelope&quot;</span></span><br><span class="line">	QueueUser     = <span class="string">&quot;user&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">	db          *gorm.DB</span><br><span class="line">	redisClient *redis.Client</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> err <span class="type">error</span></span><br><span class="line">	db, err = gorm.Open(<span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;root:root@tcp(localhost:3306)/test?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err = db.DB().Ping(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	db.DB().SetMaxOpenConns(<span class="number">100</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;database connected. pool size 10&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	redisClient = redis.NewClient(&amp;redis.Options&#123;</span><br><span class="line">		Addr:     <span class="string">&quot;localhost:6379&quot;</span>,</span><br><span class="line">		DB:       <span class="number">0</span>,</span><br><span class="line">		PoolSize: <span class="number">100</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> _, err := redisClient.Ping().Result(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;redis connected. pool size 100&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取Code写入Queue</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	envelopes := <span class="built_in">make</span>([]Envelope, <span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">	<span class="keyword">if</span> err := db.Debug().Where(<span class="string">&quot;user_id=0&quot;</span>).Limit(<span class="number">100</span>).Find(&amp;envelopes).Error; err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(envelopes) != <span class="number">100</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;不足100个奖品&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> envelopes &#123;</span><br><span class="line">		<span class="keyword">if</span> err := redisClient.LPush(QueueEnvelope, envelopes[i].Code).Err(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Fatal(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Println(<span class="string">&quot;load 100 envelopes&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/envelope&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		uid := r.Header.Get(<span class="string">&quot;x-user-id&quot;</span>)</span><br><span class="line">		<span class="keyword">if</span> uid == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">			w.WriteHeader(<span class="number">401</span>)</span><br><span class="line">			_, _ = fmt.Fprint(w, <span class="string">&quot;UnAuthorized&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		uidValue, err := strconv.Atoi(uid)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			w.WriteHeader(<span class="number">400</span>)</span><br><span class="line">			_, _ = fmt.Fprint(w, <span class="string">&quot;Bad Request&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 检测用户是否抢过了</span></span><br><span class="line">		<span class="keyword">if</span> result, err := redisClient.HIncrBy(QueueUser, uid, <span class="number">1</span>).Result(); err != <span class="literal">nil</span> || result != <span class="number">1</span> &#123;</span><br><span class="line">			w.WriteHeader(<span class="number">429</span>)</span><br><span class="line">			_, _ = fmt.Fprint(w, <span class="string">&quot;Too Many Request&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 检测是否在队列中</span></span><br><span class="line">		code, err := redisClient.LPop(QueueEnvelope).Result()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			w.WriteHeader(<span class="number">200</span>)</span><br><span class="line">			_, _ = fmt.Fprint(w, <span class="string">&quot;No Envelope&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// 发放红包</span></span><br><span class="line">		envelope := &amp;Envelope&#123;&#125;</span><br><span class="line">		err = db.Where(<span class="string">&quot;code=?&quot;</span>, code).Take(&amp;envelope).Error</span><br><span class="line">		<span class="keyword">if</span> err == gorm.ErrRecordNotFound &#123;</span><br><span class="line">			w.WriteHeader(<span class="number">200</span>)</span><br><span class="line">			_, _ = fmt.Fprint(w, <span class="string">&quot;No Envelope&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			w.WriteHeader(<span class="number">500</span>)</span><br><span class="line">			_, _ = fmt.Fprint(w, err)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		now := time.Now()</span><br><span class="line">		envelope.UserId = uidValue</span><br><span class="line">		envelope.RewardAt = &amp;now</span><br><span class="line">		rowsAffected := db.Where(<span class="string">&quot;user_id=0&quot;</span>).Save(&amp;envelope).RowsAffected <span class="comment">// 添加user_id=0来验证Redis是否真的解决争抢问题</span></span><br><span class="line">		<span class="keyword">if</span> rowsAffected == <span class="number">0</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;发生争抢. id=%d\n&quot;</span>, envelope.Id)</span><br><span class="line">			w.WriteHeader(<span class="number">500</span>)</span><br><span class="line">			_, _ = fmt.Fprintf(w, <span class="string">&quot;发生争抢. id=%d\n&quot;</span>, envelope.Id)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">		_, _ = fmt.Fprint(w, envelope.Code)</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;listen on 8080&quot;</span>)</span><br><span class="line">	fmt.Println(http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Gepostet vor&nbsp;<time dateTime="2019-10-28T04:00:00.000Z" title="10/28/2019, 4:00:00 AM">2019-10-28</time></span><span class="level-item"><a class="link-muted" href="/categories/frontend/">frontend</a><span> / </span><a class="link-muted" href="/categories/frontend/javascript/">javascript</a></span><span class="level-item">7 minutes lesen (Über 1013 Wörter)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/10/28/2019-10-28-symbol.html">深入浅出ES6的Symbol类型</a></p><div class="content"><h2 id="本文内容"><a href="#本文内容" class="headerlink" title="本文内容"></a>本文内容</h2><ul>
<li>JS基本数据类型种类</li>
<li>Symbol的主要用法, 全局Symbol的使用与检测</li>
<li>Symbol与其他基本类型转换时的规则</li>
</ul>
<p>ES6引入了一种新的原始数据类型，表示独一无二的值，最大的用处是作为对象属性的唯一标识符。</p>
<p>至此，Javascript拥有6种基本数据类型和一种复杂数据类型。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>基本类型</p>
<ul>
<li>string</li>
<li>number</li>
<li>boolean</li>
<li>undefined</li>
<li>null</li>
<li>symbol</li>
</ul>
<p>复杂类型</p>
<ul>
<li>object</li>
</ul>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Symbol</span>([description])</span><br></pre></td></tr></table></figure>

<ul>
<li>description 可选的描述，一般用在调试的时候作为区分，但是 <strong>不能用来访问Symbol</strong>。</li>
<li>该方法返回一个symbol值</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> s = <span class="title class_">Symbol</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> s2 = <span class="title class_">Symbol</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> s3 = <span class="keyword">new</span> <span class="title class_">Symbol</span>(<span class="string">&#x27;test&#x27;</span>); <span class="comment">// TypeError</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s === s2); <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">typeof</span> s); <span class="comment">// symbol</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s.<span class="property">description</span>); <span class="comment">// test</span></span><br></pre></td></tr></table></figure>

<ul>
<li>每次调用Symbol()返回的值都是独一无二的，不管描述是否一致。</li>
<li><code>Symbol</code>不支持<code>new</code>调用</li>
<li>通过description属性可以获取到传入Symbol的描述性字符串</li>
</ul>
<h3 id="全局单例的Symbol"><a href="#全局单例的Symbol" class="headerlink" title="全局单例的Symbol"></a>全局单例的Symbol</h3><p>使用Symbol.for()可以创建全局单例的symbol值，语法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">for</span>([name])</span><br></pre></td></tr></table></figure>

<ul>
<li>name 可选的描述，建议传入，否则name会作为undefined传入</li>
</ul>
<ol>
<li>类似于单例模式，执行环境(一般是浏览器)内部维护了一个全局Symbol注册表，记录name和Symbol(name)关系</li>
<li>尝试通过name在该注册表查找对应symbol值，如果找到，则返回这个symbol值</li>
<li>如果没找到，则使用Symbol(name)创建一个symbol值，并记录该symbol值与name的关联关系，之后返回该symbol</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> name2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> name3 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name === name2); <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name2 === name3); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>全局Symbol映射关系中name是作为字符串来使用的，结构类似下面的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> globalSymbols = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用同样的字符串描述调用Symbol()和Symbol.for()获取到的symbol值不相等</p>
</li>
</ul>
<h3 id="查找是否为全局的单例Symbol"><a href="#查找是否为全局的单例Symbol" class="headerlink" title="查找是否为全局的单例Symbol"></a>查找是否为全局的单例Symbol</h3><p>使用Symbol.keyFor()可以检测给定的symbol值是否是全局单例的symbol(简单来说就是检测是否是Symbol.for()创建的)，语法如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(symbol)</span><br></pre></td></tr></table></figure>

<ul>
<li>symbol 必传， 待检测的symbol值</li>
<li>如果给定的symbol值是通过Symbol.for()得到的，该方法返回传入symbol的字符串描述</li>
<li>如果给定的symbol值不是通过Symbol.for()得到的，该方法返回undefined</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="title class_">Symbol</span>(<span class="string">&#x27;s1&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> s2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;s2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(s)); <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(s2)); <span class="comment">// s2</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol与JSON-stringify"><a href="#Symbol与JSON-stringify" class="headerlink" title="Symbol与JSON.stringify"></a>Symbol与JSON.stringify</h3><blockquote>
<p>Symbol类型的属性不会参与JSON的序列化</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  [name]: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(obj)); <span class="comment">// &#123;&quot;data&quot;: 1&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol与for-…-in和for-…-of"><a href="#Symbol与for-…-in和for-…-of" class="headerlink" title="Symbol与for … in和for … of"></a>Symbol与for … in和for … of</h3><blockquote>
<p>Symbol类型的属性不会出现在for … in和for … of循环中</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  [name]: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">in</span> user) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(i, user[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 上述循环输出 data 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i <span class="keyword">of</span> user) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(i, user[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// TypeError: user不是可迭代对象</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol与Object-keys-和Object-getOwnPropertyNames"><a href="#Symbol与Object-keys-和Object-getOwnPropertyNames" class="headerlink" title="Symbol与Object.keys()和Object.getOwnPropertyNames()"></a>Symbol与Object.keys()和Object.getOwnPropertyNames()</h3><blockquote>
<p>Symbol类型的属性不会出现在Object.keys()和Object.getOwnPropertyNames()返回结果中</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  [name]: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(user)); <span class="comment">// [&quot;data&quot;]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(user)); <span class="comment">// [&quot;data&quot;]</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol与Object-getOwnPropertySymbols"><a href="#Symbol与Object-getOwnPropertySymbols" class="headerlink" title="Symbol与Object.getOwnPropertySymbols()"></a>Symbol与Object.getOwnPropertySymbols()</h3><blockquote>
<p>Symbol类型的属性会出现在Object.Object.getOwnPropertySymbols()</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  [name]: <span class="string">&#x27;xialei&#x27;</span>,</span><br><span class="line">  <span class="attr">data</span>: <span class="number">1</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Object</span>.<span class="property">Object</span>.<span class="title function_">getOwnPropertySymbols</span>(user)); <span class="comment">// [Symbol(name)]</span></span><br></pre></td></tr></table></figure>

<h3 id="Symbol数据类型转换"><a href="#Symbol数据类型转换" class="headerlink" title="Symbol数据类型转换"></a>Symbol数据类型转换</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name + <span class="number">1</span>); <span class="comment">// TypeError</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Number</span>(name)); <span class="comment">// 创建包装对象</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name + <span class="string">&#x27;1&#x27;</span>); <span class="comment">// TypeError</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">String</span>(name)); <span class="comment">// Symbol(1)</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(!!name); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Boolean</span>(name)); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>symbol值不能转换为数字</li>
<li>symbol不能直接转换为字符串，需要通过String包装才能转化</li>
<li>symbol可以直接转换为boolean，转化后为true</li>
</ul>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><ul>
<li>使用Symbol最大的注意事项应该是使用方括号语法去访问对应的属性，而不是字符串。</li>
<li>Symbol数据类型转换规范比较简单，大部分场景下也没用拿Symbol去做数据转换</li>
</ul>
<p><img src="https://static.ddhigh.com/blog/2019-10-22-102654.jpg" alt="0.jpeg"><img src="https://static.ddhigh.com/blog/2021-02-25-112206-2.png" alt="image-20210225112205987"></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/8/">Zurück</a></div><div class="pagination-next"><a href="/page/10/">Weiter</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/8/">8</a></li><li><a class="pagination-link is-current" href="/page/9/">9</a></li><li><a class="pagination-link" href="/page/10/">10</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/31/">31</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://static.ddhigh.com/blog/2019-09-18-094336.jpg" alt="XiaLei"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">XiaLei</p><p class="is-size-6 is-block">Senior Software Engineer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Tencent</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Seiten</p><a href="/archives"><p class="title">306</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Kategorien</p><a href="/categories"><p class="title">25</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">38</p></a></div></div></nav><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/xialeistudio"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="LinkedIn" href="https://www.linkedin.com/in/xialeidoc/"><i class="fa-brands fa-linkedin"></i></a></div></div></div><!--!--></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/">Learning &amp; Sharing</a><p class="is-size-7"><span>&copy; 2023 Xia Lei</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en-us");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><a id="back-to-top" title="Zurück nach oben" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "Diese Website verwendet Cookies, um Ihre Erfahrung zu verbessern.",
          dismiss: "Verstanden!",
          allow: "Cookies zulassen",
          deny: "Ablehnen",
          link: "Mehr erfahren",
          policy: "Cookie-Richtlinie",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Tippen Sie etwas..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Tippen Sie etwas...","untitled":"(Ohne Titel)","posts":"Seiten","pages":"Pages","categories":"Kategorien","tags":"Tags"});
        });</script></body></html>