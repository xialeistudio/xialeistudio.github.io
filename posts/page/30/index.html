<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Posts</title>
<meta charset=utf-8><meta name=description content="Ladder@Posts - Lei Xia"><meta name=author content="Lei Xia"><link rel=canonical href=https://www.ddhigh.com/posts/><link rel=alternate type=application/rss+xml href=https://www.ddhigh.com/index.xml title="Lei Xia"><script async defer data-website-id=865c8529-0729-4cf5-88a9-448616abbcbb src=https://umami-beta-peach.vercel.app/xialeistudio></script><meta property="og:title" content="Posts"><meta property="og:description" content="Learning & Writing & Sharing"><meta property="og:type" content="website"><meta property="og:url" content="https://www.ddhigh.com/posts/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content="Learning & Writing & Sharing"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.ddhigh.com/posts/"}]}</script><link rel=icon href=/img/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/img/favicon.ico><link rel=manifest href=/img/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.894ca9c68afab956438c4926a0dc7f5293e04e08595bd27abdb123e94801f684.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/categories>Categories</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>Guestbook</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/xialeistudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><div class=blog-wrapper><div><div class=blog-list><article><div class=blog-card><h3><a href=/2014/09/20/php-website-auto-update/>PHP自动更新网站</a></h3><p><small>September 20, 2014&nbsp;· 331 words&nbsp;· 2 min</small><p>目前软件开发主流越来越倾向于B/S模式，不同于C/S模式的软件，B/S模式下的WEB程序自动更新是个麻烦问题。
本人利用PHP下载远程文件和ZIP类，写了一个简单的自动更新DEMO，供大家参考。
服务端 目录结构 |data |--20140918.zip |--index.php 其中 data 文件夹用来存放补丁包,index.php 文件用来响应版本数据给客户端。
index.php &lt;?php sleep(3); header('Content-Type:application/json;utf-8'); echo json_encode(array( '20140918' => array( 'version' => 20140920, 'desc' => 'BUG修正，缓存系统', 'url' => 'http://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'] . '/data/20140918.zip' ) )); exit(); 20140918 对应的是客户端版本号，20140920 对应的是服务端版本号，desc 是本次补丁的描述，url 则是补丁包下载地址
客户端 目录结构 |tmp |--config.php |--Zip.php |--index.php config.php 为配置文件，保存本地版本信息，Zip.php 为ZIP操作类（从服务端下载的补丁包均为zip格式）,index.php 为自动更新程序（只是为了方便，实际中可以写个方法出来）
index.php &lt;?php ob_implicit_flush(true); $begin = microtime(true); //检查更新,加载本地版本号 $config = require(__DIR__ . '/config.php'); $server = 'http://localhost/version'; echo '连接更新服务器...&lt;br/>'; ob_flush(); $versions = json_decode(file_get_contents($server), true); if (!</div></article><article><div class=blog-card><h3><a href=/2014/09/20/php-download-remote-file/>PHP下载远程文件</a></h3><p><small>September 20, 2014&nbsp;· 18 words&nbsp;· One minute</small><p>在开发爬虫的时候，文章的图片往往是有防盗链措施的，一个比较好的解决办法是通过PHP下载图片到本地并且替换URL实现。
由于图片这种东西不能直接像下载HTML那样直接下载，所以需要指定fopen的打开模式为b(二进制模式)。
&lt;?php $url = 'http://picturescdn.qiniudn.com/93aa93787ae02be68192b3533d3e76b0'; $remote_fp = fopen($url,'rb'); $local_fp = fopen(date('YmdHis'),'wb'); while(!feof($remote_fp)){ fwrite($local_fp,fread($remote_fp,128)); } fclose($remote_fp); fclose($local_fp); 这样就在本地目录生成了一张图片。</div></article><article><div class=blog-card><h3><a href=/2014/09/18/bootstrap3-disable-responsive-layout/>bootstrap3禁用响应式布局</a></h3><p><small>September 18, 2014&nbsp;· 7 words&nbsp;· One minute</small><p>IE8及以下版本的浏览器确实是心中的痛,不支持媒体查询和CSS3，导致bootstrap样式怪怪的。没办法，只能采取折中的办法&ndash;禁用响应式布局
移除 viewport 标签 引入该CSS文件以重置bootstrap的响应式布局 这种情况下会导致一些高级浏览器不能得到最好的效果，所以，进阶的办法是:
利用PHP判断是否是IE8及以下版本的浏览器，如果不是，则进行正常的响应式布局。如果是，则禁用响应式布局</div></article><article><div class=blog-card><h3><a href=/2014/09/18/grunt-get-started/>Grunt快速上手</a></h3><p><small>September 18, 2014&nbsp;· 104 words&nbsp;· One minute</small><p>为什么要使用Grunt? 一句话：自动化。对于需要反复重复的任务，例如压缩（minification）、编译、单元测试、linting等，自动化工具可以减轻你的劳动，简化你的工作。当你正确配置好了任务，任务运行器就会自动帮你或你的小组完成大部分无聊的工作。
怎么使用Grunt? 1.grunt是基于nodejs的，所以请先安装nodejs和npm安装grunt
2.新版本的grunt安装需要两步，终端执行
npm install grunt-cli -g 3.进入项目目录，终端执行
npm install grunt --save-dev 4.安装常用插件
npm install grunt-contrib-cssmin grunt-contrib-uglify grunt-contrib-watch --save-dev 5.项目目录
--dev |--js |-- jquery.js |-- main.js |--css |-- library.css |-- main.css 一个很简单的JS,CSS目录，很关键的任务在于如何定义Gruntfile.js文件（请在项目根目录下创建Gruntfile.js,大小写不能错）
6.Gruntfile.js
module.exports = function(grunt) { grunt.initConfig({ cssmin: { site: { files: { 'build/css/site.css': ['dev/css/library.css', 'dev/css/main.css'] } }, }, uglify: { site: { src: ['dev/js/jquery.js', 'dev/js/main.js'], dest: 'build/js/site.js' }, }, watch: { site: { files: ['dev/js/**.*', 'dev/css/**.*'], tasks: ['uglify:site', 'cssmin:site'] } } }); grunt.</div></article><article><div class=blog-card><h3><a href=/2014/09/18/qiniu-custom-data/>七牛云存储定义自定义变量返回数据</a></h3><p><small>September 18, 2014&nbsp;· 43 words&nbsp;· One minute</small><p>背景 七牛云存储也使用了这么久了。一直一来都只用了它的图片上传和处理功能。用的是客户端直传API，七牛给我返回一个key（一串随机的hash值，对人类无可读性）。
最近做的一个文件共享的项目，因为文件是客户端直传七牛的，那么我在后台PHP这边是拿不到原始文件名的，但是文件列表必须显示原始文件名，不能显示那个hash值。后来查找文件发现，七牛可以自定义返回的变量。
关键代码 &lt;?php Qiniu_SetKeys($this->accessKey, $this->secretKey); $putPolicy = new Qiniu_RS_PutPolicy($this->bucket); $putPolicy->Expires = $expires; $putPolicy->SaveKey = $filename; $putPolicy->FsizeLimit = 20*1024*1024; if($returnUrl != '') putPolicy->ReturnUrl = $returnUrl; $upToken = $putPolicy->Token(null); return $upToken; 通过对 $filename参数进行定制
$filename = '$(fsize)/$(fname)' 这样子七牛返回的hash应该是
a3466b7fa159ab4f671bdc4ae45dae08/103/稿件共享.txt 通过 explode 函数就可以拿到文件名了。
题外话 七牛还有很多自定义参数有待各位挖掘，这里只做个抛砖引玉的作用。</div></article><article><div class=blog-card><h3><a href=/2014/09/15/linux-public-key-git/>linux利用ssh公钥部署git代码</a></h3><p><small>September 15, 2014&nbsp;· 21 words&nbsp;· One minute</small><p>背景 阿里云的使用门槛降低，直接导致了很多人优先使用VPS而不是以前的虚拟主机，毕竟虚拟主机存在诸多限制。阿里云犹如一台全新的服务器，所有软件都要自己安装。作为一个写PHP的，代码部署就略麻烦了，以前使用FTP的时候很方便部署，但是不适合长期开发（因为没有版本控制），所以使用GIT会很方便。
问题 在windows开发机上使用https方式进行git操作是没问题的，但是在linux上进行git操作的时候就会出错误，会让你输入帐号密码，就算是对的帐号密码也不行。这种情况下需要使用 ssh 方式进行GIT。
解决方法 生成密钥 在终端下输入 ssh-keygen -t rsa 接下来的询问全部直接按回车 最后得到了两个文件：id_rsa和id_rsa.pub cat ~/.ssh/id_rsa.pub 将显示的内容全部复制下来 进入你的git网站，比如oschina的git 添加ssh公钥 保存 enjoy!</div></article><article><div class=blog-card><h3><a href=/2014/09/13/linux-delete-messy-code-file/>Linux删除乱码文件</a></h3><p><small>September 13, 2014&nbsp;· 19 words&nbsp;· One minute</small><p>shell终端中有时候中文文件名会出现乱码，导致很多操作都不能进行，一个最简单的就是删除了。
linux中每个文件有类似于ID的东西，使用以下命令查看
ll -i 显示出来的第一个数字就是文件的inum
可以利用以下命令进行删除操作,假设inum为111111
find . -inum 11111 -exec rm -f {} \ rm -f {}可以自行替换为自己需要操作的命令。 这样的话，不管什么文件都可以操作，只要有inum!</div></article><article><div class=blog-card><h3><a href=/2014/09/13/mysql-combined-primary-key/>MySQL联合主键</a></h3><p><small>September 13, 2014&nbsp;· 45 words&nbsp;· One minute</small><p>单字段主键 MySQL单字段主键相信大家都熟悉了。就是以一个字段主要数据行的主键，比如下面这个表
create table `user`( user_id int(11) auto_increment, username varchar(24), password char(32), primary key(user_id) ); user_id作为单字段主键,说明任何用户的user_id都不能相同，一个user_id即标识一个用户。
多字段联合主键 再看这个表
create table `user`( username varchar(24), password char(32), email varchar(40), primary key(username,email) ); 这里使用username,email作为联合主键，为了标识一个用户，只有在username和email共同存在，且不同时才能标识。
例子 username password email zhangsan 111111 zhangsan@qq.com zhangsan 111111 lisi@qq.com lisi 111111 zhangsan@qq.com 这三条记录均为合法记录，多字段联合主键的核心就是（所有字段才能唯一确定一条记录，就像上面的username,email）。</div></article><article><div class=blog-card><h3><a href=/2014/09/13/php-regex-chinese/>PHP正则表达式匹配中文</a></h3><p><small>September 13, 2014&nbsp;· 54 words&nbsp;· One minute</small><p>正常的正则表达式匹配英文和数字以及一些常用字符还是很简单的，如
/^\w$/ /^[0-9]$/ /^[\-\_]$/ 等等，但是匹配中文的话就有些麻烦了。UTF-8的中文根据unicode编码，所以我们需要手动构造UTF-8字符串
/^[\x{4e00}-\x{9fa5}]$/u 请注意大括号，因为没有大括号PHP会报错
Warning: preg_match() [function.preg-match]: Compilation failed: PCRE does not support \L, \l, \N, \U, or \u at offset 3 in test.php on line 3 因为\x是表示十六进制数的，所以需要用大括号括起来
另外，需要增加 u 修饰符。
此修正符启用了一个 PCRE 中与 Perl 不兼容的额外功能。模式字符串被当成 UTF-8。
本修正符在 Unix 下自 PHP 4.1.0 起可用，在 win32 下自 PHP 4.2.3 起可用。
很多时候google的作用确实比 X度 大，学会google吧！</div></article><article><div class=blog-card><h3><a href=/2014/09/10/nginx-urlrewritepathinfo/>nginx url重写和pathinfo配置</a></h3><p><small>September 10, 2014&nbsp;· 127 words&nbsp;· One minute</small><p>nginx近年来的上涨趋势确实挺快的，但是apache作为老牌HTTP服务器，拥有的生态圈是nginx比不上的。一个最简单的例子，URL重写，apache的话利用无所不能的.htaccess文件就可以了。nginx还要改主配置文件。
URL重写配置 主配置文件 location / { if (!-e $request_filename) { rewrite ^/(.*)$ /index.php?$1 last; } } if和(中间要有括号,url重写这里就配置完了。
pathinfo配置 nginx原生是不支持pathinfo的，但是通过配置fastcgi参数可以达到效果
主配置文件 location ~ [^/]\.php(/|$) { # comment try_files $uri =404; to enable pathinfo #try_files $uri =404; fastcgi_pass unix:/tmp/php-cgi.sock; fastcgi_index index.php; include fastcgi.conf; include pathinfo.conf; } fastcgi.conf fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; fastcgi_param QUERY_STRING $query_string; fastcgi_param REQUEST_METHOD $request_method; fastcgi_param CONTENT_TYPE $content_type; fastcgi_param CONTENT_LENGTH $content_length; fastcgi_param SCRIPT_NAME $fastcgi_script_name; fastcgi_param REQUEST_URI $request_uri; fastcgi_param DOCUMENT_URI $document_uri; fastcgi_param DOCUMENT_ROOT $document_root; fastcgi_param SERVER_PROTOCOL $server_protocol; fastcgi_param HTTPS $https if_not_empty; fastcgi_param GATEWAY_INTERFACE CGI/1.</div></article></div><div class=paginator><a class=prev href=/posts/page/29/>&larr;&nbsp;&nbsp;Pre Page</a>
<a class=next href=/posts/page/31/>Next Page&nbsp;&nbsp;&rarr;</a></div></div></div></div><footer class=footer><p>&copy; 2014 - 2023 <a href=https://www.ddhigh.com>Lei Xia</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
<a href=https://umami-beta-peach.vercel.app/ target=_blank>Statistics</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>