<!doctype html><html lang=zh><head><meta name=viewport content="width=device-width,initial-scale=1"><title>OpenTelemetry上手指南</title>
<meta charset=utf-8><meta name=google-adsense-account content="ca-pub-2871082647721658"><meta content="Web开发 ,Java ,Go ,Node.js ,PHP ,Koa ,MySQL ,Redis ,前端 ,后端 ,数据库" name=keywords><meta name=description content="可观测性的三要素 在现代分布式系统中，随着架构复杂性和微服务化的加剧，传统的监控手段已不足以应对系统运行状态的全面掌握。可观测性（Observability）作为一种新兴理念，旨在通过数据的采集和分析，帮助开发者、运维人员深入理解系统内部行为，确保系统健康和性能。可观测性通常由以下三大核心要素构成：
Metrics（指标） Metrics 是对系统性能和健康状态的量化描述，通常以数值形式呈现。这些数据通过定期采集，提供系统在特定时间点的运行快照，帮助用户快速了解系统的整体状况。"><meta name=author content="Lei Xia"><link rel=canonical href=https://www.ddhigh.com/2024/12/02/opentelemetry-getstarted/><link rel=alternate type=application/rss+xml href=https://www.ddhigh.com/index.xml title=每天进步一点点><script async src="https://www.googletagmanager.com/gtag/js?id=G-EC3XLVSGKV"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EC3XLVSGKV")</script><meta property="og:title" content="OpenTelemetry上手指南"><meta property="og:description" content="可观测性的三要素 在现代分布式系统中，随着架构复杂性和微服务化的加剧，传统的监控手段已不足以应对系统运行状态的全面掌握。可观测性（Observability）作为一种新兴理念，旨在通过数据的采集和分析，帮助开发者、运维人员深入理解系统内部行为，确保系统健康和性能。可观测性通常由以下三大核心要素构成：
Metrics（指标） Metrics 是对系统性能和健康状态的量化描述，通常以数值形式呈现。这些数据通过定期采集，提供系统在特定时间点的运行快照，帮助用户快速了解系统的整体状况。"><meta property="og:type" content="article"><meta property="og:url" content="https://www.ddhigh.com/2024/12/02/opentelemetry-getstarted/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-12-02T11:53:08+08:00"><meta property="article:modified_time" content="2024-12-02T11:53:08+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="OpenTelemetry上手指南"><meta name=twitter:description content="可观测性的三要素 在现代分布式系统中，随着架构复杂性和微服务化的加剧，传统的监控手段已不足以应对系统运行状态的全面掌握。可观测性（Observability）作为一种新兴理念，旨在通过数据的采集和分析，帮助开发者、运维人员深入理解系统内部行为，确保系统健康和性能。可观测性通常由以下三大核心要素构成：
Metrics（指标） Metrics 是对系统性能和健康状态的量化描述，通常以数值形式呈现。这些数据通过定期采集，提供系统在特定时间点的运行快照，帮助用户快速了解系统的整体状况。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.ddhigh.com/posts/"},{"@type":"ListItem","position":3,"name":"OpenTelemetry上手指南","item":"https://www.ddhigh.com/2024/12/02/opentelemetry-getstarted/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"OpenTelemetry上手指南","name":"OpenTelemetry上手指南","description":"可观测性的三要素 在现代分布式系统中，随着架构复杂性和微服务化的加剧，传统的监控手段已不足以应对系统运行状态的全面掌握。可观测性（Observability）作为一种新兴理念，旨在通过数据的采集和分析，帮助开发者、运维人员深入理解系统内部行为，确保系统健康和性能。可观测性通常由以下三大核心要素构成：\nMetrics（指标） Metrics 是对系统性能和健康状态的量化描述，通常以数值形式呈现。这些数据通过定期采集，提供系统在特定时间点的运行快照，帮助用户快速了解系统的整体状况。","keywords":["Observability"],"articleBody":"可观测性的三要素 在现代分布式系统中，随着架构复杂性和微服务化的加剧，传统的监控手段已不足以应对系统运行状态的全面掌握。可观测性（Observability）作为一种新兴理念，旨在通过数据的采集和分析，帮助开发者、运维人员深入理解系统内部行为，确保系统健康和性能。可观测性通常由以下三大核心要素构成：\nMetrics（指标） Metrics 是对系统性能和健康状态的量化描述，通常以数值形式呈现。这些数据通过定期采集，提供系统在特定时间点的运行快照，帮助用户快速了解系统的整体状况。\n常见示例：CPU 使用率（如 75%）、内存占用量（如 2GB/8GB）、请求速率（如每秒 100 次请求）、错误率（如 2% 的请求失败）等。 应用场景：Metrics 通常与监控系统（如 Prometheus）结合，用于设置告警规则。例如，当错误率超过 5% 时触发告警通知。 特点：Metrics 是高度聚合的数据，适合长期趋势分析，但缺乏请求级别的细节。 Traces（追踪） Traces 通过记录请求在分布式系统中的完整生命周期，揭示了请求从进入系统到离开的每一步路径。它特别适用于理解跨服务调用的复杂交互。\n组成：每个 Trace 由多个 Span 组成，Span 是请求在系统中某一个操作的执行记录（如调用数据库、发送 HTTP 请求等），包含开始时间、结束时间和元数据（如服务名称）。 实际用途：例如，当用户访问一个电商网站下单时，Trace 可以展示从前端到支付服务、库存服务再到物流服务的调用链，快速定位延迟或错误的来源。 优势：Traces 是调试分布式系统中性能瓶颈和故障的利器，尤其在微服务架构中尤为重要。 Logs（日志） Logs 是系统运行时生成的时间序列事件记录，提供系统行为的详细上下文。\n形式：日志可以是结构化的（如 JSON 格式，带有明确字段）或非结构化的（如纯文本）。结构化日志更易于查询和分析，例如：{“timestamp”: “2025-02-25T10:00:00Z”, “level”: “INFO”, “message”: “User login successful”}。 用途：Logs 是故障排查的基石。例如，当系统抛出 500 错误时，开发者可以通过日志查看具体的错误堆栈或异常信息。 与 Metrics 和 Traces 的关系：Logs 提供细粒度的上下文，而 Metrics 提供宏观趋势，Traces 提供请求路径，三者相辅相成。 OpenTelemetry：可观测性的统一标准 OpenTelemetry 是一个由 CNCF（云原生计算基金会）支持的开源项目，旨在为分布式系统提供一致、可移植的可观测性数据采集和传输框架。它由 OpenTracing 和 OpenCensus 两个项目合并发展而来，解决了之前标准不统一的问题。以下是 OpenTelemetry 的核心功能和优势：\n统一的 API 和 SDK：支持多种编程语言（如 Go、Java、Python 等），开发者只需集成一次即可采集 Metrics、Traces 和 Logs，无需为不同工具编写重复代码。 上下文自动传播：在分布式系统中，OpenTelemetry 利用 W3C Trace Context 标准，自动在服务间传递追踪上下文，确保跨服务的 Trace 完整无缺。例如，一个请求从前端到后端，Trace ID 会贯穿始终。 广泛的后端支持：支持将数据导出到多种可观测性平台，如 Prometheus（Metrics）、Jaeger（Traces）、Elasticsearch（Logs）等，提供灵活的选择。 高度可扩展性：通过插件机制，开发者可以自定义数据采集逻辑，例如添加特定的业务指标或日志字段。 注意事项：OpenTelemetry 本身不负责数据的存储或可视化，它只是一个数据采集和传输的工具集。要实现完整可观测性，需要搭配后端平台（如本文使用的 OpenObserve）。\nGo 服务接入 OpenTelemetry 实践 接下来，我们将通过一个完整的示例，展示如何在 Go 服务中集成 OpenTelemetry，并结合 OpenObserve 实现可观测性。示例包括本地环境的搭建、OpenTelemetry Collector 的配置以及 Go 代码的埋点实践。\n1. 启动本地 OpenObserve 服务 OpenObserve 是一个轻量级的可观测性平台，支持存储和可视化 Metrics、Traces 和 Logs。假设已安装 Docker，可以通过以下步骤启动：\ndocker run -v $PWD/data:/data -e ZO_DATA_DIR=\"/data\" -p 5080:5080 \\ -e ZO_ROOT_USER_EMAIL=\"root@example.com\" -e ZO_ROOT_USER_PASSWORD=\"Complexpass#123\" \\ public.ecr.aws/zinclabs/openobserve:latest 参数说明 -v $PWD/data:/data：将本地目录挂载到容器，用于持久化存储数据。 -p 5080:5080：映射端口，使 OpenObserve 的 Web 界面可在本地访问。 ZO_ROOT_USER_EMAIL 和 ZO_ROOT_USER_PASSWORD：设置管理员账户。 验证：启动后，打开浏览器访问 http://localhost:5080，使用 root@example.com 和 Complexpass#123 登录，检查仪表盘是否正常。 启动OpenTelemetry Collector服务 OpenTelemetry Collector 是一个独立的服务，负责接收、处理和导出可观测性数据。我们需要创建一个配置文件 otel-collector-config.yaml：\nreceivers: otlp: protocols: grpc: endpoint: 0.0.0.0:4317 http: endpoint: 0.0.0.0:4318 processors: batch: timeout: 1s send_batch_size: 1024 exporters: otlphttp/openobserve: endpoint: http://localhost:5080/api/default headers: Authorization: Basic bGVpQGNvbm5lY3RseS5haTphMldmRzFTWXlGWXhjUWtp stream-name: default service: pipelines: traces: receivers: [otlp] processors: [batch] exporters: [otlphttp/openobserve] metrics: receivers: [otlp] processors: [batch] exporters: [otlphttp/openobserve] logs: receivers: [otlp] processors: [batch] exporters: [otlphttp/openobserve] 配置文件解析：\nReceivers：使用 OTLP 协议（OpenTelemetry Protocol）接收数据，支持 gRPC 和 HTTP 两种方式。 Processors：batch 处理器将数据批量处理，减少网络开销。 Exporters：将数据发送到 OpenObserve，Authorization 使用 Base64 编码的用户名和密码（这里是示例值，实际使用时需替换）。 启动 Collector：使用 Docker Compose 启动服务，配置文件如下：\nservices: otel-collector: image: otel/opentelemetry-collector-contrib:0.114.0 volumes: - ./otel-collector-config.yaml:/etc/otelcol-contrib/config.yaml - /var/lib/docker/containers:/var/lib/docker/containers:ro - /var/log/containers:/var/log/containers:ro ports: # - 1888:1888 # pprof extension # - 18888:8888 # Prometheus metrics exposed by the Collector # - 18889:8889 # Prometheus exporter metrics # - 13133:13133 # health_check extension - 4317:4317 # OTLP gRPC receiver - 4318:4318 # OTLP http receiver # - 55679:55679 # zpages extension volumes: data: 运行 docker-compose up 后，Collector 将监听 4317 和 4318 端口，接收数据并转发到 OpenObserve。\nGo代码埋点 以下是一个基于 Gin 框架的 Web 服务示例，展示如何集成 OpenTelemetry，采集 Metrics、Traces 和 Logs。服务包含两个端口：主服务（8080）和内部服务（18080），模拟分布式调用。\n初始化 OpenTelemetry 在 main.go 中初始化 Trace、Metric 和 Log 的 Provider：\nfunc initProvider() (func(), error) { ctx := context.Background() // 定义服务资源 res, err := resource.New(ctx, resource.WithAttributes( semconv.ServiceName(\"my-service\"), semconv.ServiceVersion(\"1.0.0\"), ), ) if err != nil { return nil, err } // 连接到 Collector conn, err := grpc.Dial(\"127.0.0.1:4317\", grpc.WithTransportCredentials(insecure.NewCredentials())) if err != nil { return nil, err } // Trace exporter traceExporter, err := otlptracegrpc.New(ctx, otlptracegrpc.WithGRPCConn(conn)) if err != nil { return nil, err } tracerProvider := sdktrace.NewTracerProvider(sdktrace.WithBatcher(traceExporter), sdktrace.WithResource(res)) otel.SetTracerProvider(tracerProvider) // Metric exporter metricExporter, err := otlpmetricgrpc.New(ctx, otlpmetricgrpc.WithGRPCConn(conn)) if err != nil { return nil, err } metricProvider := sdkmetric.NewMeterProvider(sdkmetric.WithResource(res), sdkmetric.WithReader(sdkmetric.NewPeriodicReader(metricExporter))) otel.SetMeterProvider(metricProvider) // Log exporter logExporter, err := otlploggrpc.New(ctx, otlploggrpc.WithGRPCConn(conn)) if err != nil { return nil, err } logProvider := log.NewLoggerProvider(log.WithResource(res), log.WithProcessor(log.NewBatchProcessor(logExporter))) global.SetLoggerProvider(logProvider) return func() { tracerProvider.Shutdown(ctx) metricProvider.Shutdown(ctx) logProvider.Shutdown(ctx) conn.Close() }, nil } 添加 Metrics 中间件 使用中间件记录 HTTP 请求的延迟和计数：\nfunc metricsMiddleware() gin.HandlerFunc { meter := otel.GetMeterProvider().Meter(\"http_server\") latencyHist, _ := meter.Float64Histogram(\"http_server_request_duration_seconds\", metric.WithDescription(\"HTTP request duration\")) requestCount, _ := meter.Int64Counter(\"http_server_requests_total\", metric.WithDescription(\"Total HTTP requests\")) return func(c *gin.Context) { start := time.Now() c.Next() duration := time.Since(start).Seconds() attrs := []attribute.KeyValue{ attribute.String(\"method\", c.Request.Method), attribute.String(\"path\", c.FullPath()), attribute.Int(\"status\", c.Writer.Status()), } latencyHist.Record(c.Request.Context(), duration, metric.WithAttributes(attrs...)) requestCount.Add(c.Request.Context(), 1, metric.WithAttributes(attrs...)) } } 主服务和内部服务 主服务监听 8080 端口，提供 /ping 和 /trace 两个端点。/trace 调用内部服务（18080 端口的 /hello）：\nfunc main() { cleanup, err := initProvider() if err != nil { panic(err) } defer cleanup() logger := zap.New(otelzap.NewCore(\"my-service\", otelzap.WithLoggerProvider(global.GetLoggerProvider()))) sugar := logger.Sugar() httpClient := \u0026http.Client{Transport: otelhttp.NewTransport(http.DefaultTransport)} // 启动内部服务 internalServer := newTracedServer(httpClient, sugar) go func() { if err := internalServer.Run(\":18080\"); err != nil { sugar.Errorw(\"internal server failed\", \"error\", err) } }() // 主服务 r := gin.New() r.Use(gin.Recovery(), metricsMiddleware()) r.GET(\"/ping\", func(c *gin.Context) { sugar.Infow(\"ping\", \"url\", c.Request.URL.String(), \"method\", c.Request.Method) c.JSON(http.StatusOK, gin.H{\"message\": \"pong\"}) }) r.GET(\"/trace\", func(c *gin.Context) { ctx := c.Request.Context() traceID := trace.SpanContextFromContext(ctx).TraceID().String() tr := otel.Tracer(\"time-consuming-operation\") ctx, span := tr.Start(ctx, \"sleep-operation\") time.Sleep(1 * time.Second) span.End() req, _ := http.NewRequestWithContext(ctx, \"GET\", \"http://localhost:18080/hello\", nil) resp, err := httpClient.Do(req) if err != nil { sugar.Errorw(\"failed to send request\", \"error\", err, \"trace_id\", traceID) c.JSON(http.StatusInternalServerError, gin.H{\"error\": err.Error()}) return } defer resp.Body.Close() body, _ := io.ReadAll(resp.Body) var respBody map[string]any json.Unmarshal(body, \u0026respBody) sugar.Infow(\"trace request completed\", \"trace_id\", traceID, \"status\", resp.StatusCode) c.Header(\"X-Trace-ID\", traceID) c.JSON(resp.StatusCode, respBody) }) fmt.Println(\"Server started at :8080\") panic(r.Run(\":8080\")) } func newTracedServer(httpClient *http.Client, sugar *zap.SugaredLogger) *gin.Engine { r := gin.New() r.Use(gin.Recovery()) r.GET(\"/hello\", func(c *gin.Context) { req, _ := http.NewRequestWithContext(c.Request.Context(), \"GET\", \"https://api.github.com\", nil) resp, err := httpClient.Do(req) if err != nil { sugar.Errorw(\"failed to send request\", \"error\", err) c.JSON(http.StatusInternalServerError, gin.H{\"error\": err.Error()}) return } defer resp.Body.Close() body, _ := io.ReadAll(resp.Body) var respBody map[string]any json.Unmarshal(body, \u0026respBody) c.JSON(http.StatusOK, respBody) }) return r } 总结 通过本文的实践，我们展示了如何利用 OpenTelemetry 在 Go 服务中实现全面的可观测性：\n本地环境搭建：启动 OpenObserve 和 OpenTelemetry Collector，为数据存储和处理奠定基础。 组件初始化：在 Go 中配置 Trace、Metric 和 Log 的 Provider，确保数据采集的完整性。 指标收集：通过中间件记录 HTTP 请求的性能数据，适合实时监控。 链路追踪：实现跨服务的请求追踪，定位分布式系统中的问题。 日志集成：结合 Zap 和 OpenTelemetry，输出结构化日志，便于故障排查。 未来，可以进一步探索以下方向：\n高级可视化：结合 Grafana Tempo 或 Jaeger，优化 Traces 的展示效果。 自动化告警：基于 Metrics 配置动态阈值告警。 性能优化：分析采集数据的开销，调整批量处理参数。 可观测性不仅是技术工具，更是现代系统设计的核心理念。通过 OpenTelemetry 和后端平台的结合，我们能够构建健壮、可维护的分布式系统。\n参考链接 OpenTelemetry官方文档 OpenTelemetry Go SDK OpenObserve文档 Gin Web Framework OpenTelemetry Collector Zap Logger ","wordCount":"772","inLanguage":"zh","datePublished":"2024-12-02T11:53:08+08:00","dateModified":"2024-12-02T11:53:08+08:00","author":{"@type":"Person","name":"Lei Xia"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ddhigh.com/2024/12/02/opentelemetry-getstarted/"},"publisher":{"@type":"Organization","name":"每天进步一点点","logo":{"@type":"ImageObject","url":"https://www.ddhigh.com/favicon.ico"}}}</script><link rel=icon href=/img/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/img/favicon.ico><link rel=manifest href=/img/favicon.ico><link href=/titilliumweb/titilliumweb.css rel=stylesheet><link rel=stylesheet href=/css/main.min.0eb4160ba4a2d63122fe8ae83f1560951a87ab510d5dab0615973b5206555759.css integrity="sha256-DrQWC6Si1jEi/oroPxVglRqHq1ENXasGFZc7UgZVV1k=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css integrity="sha512-ygEyjMC6rqnzJqWGjRTJUPYMEs9JUOm3i7OWUS9CgQ4XkBUvMsgCS1I8JqavidQ2ClHcREB7IbA2mN08+r9Elg==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.894ca9c68afab956438c4926a0dc7f5293e04e08595bd27abdb123e94801f684.js></script><script>hljs.highlightAll()</script><script>$darkModeInit.Content|safeJS</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2871082647721658" crossorigin=anonymous></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>每天进步一点点
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/>首页</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>归档</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/books>出版物</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>留言板</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/xialeistudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li><li class="navigation-item navigation-language"><a href=https://www.ddhigh.com/en/2024/12/02/opentelemetry-getstarted/>EN</a></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>OpenTelemetry上手指南</h1></header><p><small>2024年12月2日&nbsp;· 772 字&nbsp;· 4 分钟</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#可观测性的三要素>可观测性的三要素</a><ul><li><a href=#metrics指标>Metrics（指标）</a></li><li><a href=#traces追踪>Traces（追踪）</a></li><li><a href=#logs日志>Logs（日志）</a></li></ul></li><li><a href=#opentelemetry可观测性的统一标准>OpenTelemetry：可观测性的统一标准</a></li><li><a href=#go-服务接入-opentelemetry-实践>Go 服务接入 OpenTelemetry 实践</a><ul><li><a href=#1-启动本地-openobserve-服务>1. 启动本地 OpenObserve 服务</a></li><li><a href=#启动opentelemetry-collector服务>启动OpenTelemetry Collector服务</a></li><li><a href=#go代码埋点>Go代码埋点</a></li></ul></li><li><a href=#总结>总结</a></li><li><a href=#参考链接>参考链接</a></li></ul></nav></div><section class=blog-content><h2 id=可观测性的三要素>可观测性的三要素</h2><p>在现代分布式系统中，随着架构复杂性和微服务化的加剧，传统的监控手段已不足以应对系统运行状态的全面掌握。可观测性（Observability）作为一种新兴理念，旨在通过数据的采集和分析，帮助开发者、运维人员深入理解系统内部行为，确保系统健康和性能。可观测性通常由以下三大核心要素构成：</p><h3 id=metrics指标>Metrics（指标）</h3><p>Metrics 是对系统性能和健康状态的量化描述，通常以数值形式呈现。这些数据通过定期采集，提供系统在特定时间点的运行快照，帮助用户快速了解系统的整体状况。</p><ul><li><strong>常见示例</strong>：CPU 使用率（如 75%）、内存占用量（如 2GB/8GB）、请求速率（如每秒 100 次请求）、错误率（如 2% 的请求失败）等。</li><li><strong>应用场景</strong>：Metrics 通常与监控系统（如 Prometheus）结合，用于设置告警规则。例如，当错误率超过 5% 时触发告警通知。</li><li><strong>特点</strong>：Metrics 是高度聚合的数据，适合长期趋势分析，但缺乏请求级别的细节。</li></ul><h3 id=traces追踪>Traces（追踪）</h3><p>Traces 通过记录请求在分布式系统中的完整生命周期，揭示了请求从进入系统到离开的每一步路径。它特别适用于理解跨服务调用的复杂交互。</p><ul><li><strong>组成</strong>：每个 Trace 由多个 Span 组成，Span 是请求在系统中某一个操作的执行记录（如调用数据库、发送 HTTP 请求等），包含开始时间、结束时间和元数据（如服务名称）。</li><li><strong>实际用途</strong>：例如，当用户访问一个电商网站下单时，Trace 可以展示从前端到支付服务、库存服务再到物流服务的调用链，快速定位延迟或错误的来源。</li><li><strong>优势</strong>：Traces 是调试分布式系统中性能瓶颈和故障的利器，尤其在微服务架构中尤为重要。</li></ul><h3 id=logs日志>Logs（日志）</h3><p>Logs 是系统运行时生成的时间序列事件记录，提供系统行为的详细上下文。</p><ul><li><strong>形式</strong>：日志可以是结构化的（如 JSON 格式，带有明确字段）或非结构化的（如纯文本）。结构化日志更易于查询和分析，例如：{&ldquo;timestamp&rdquo;: &ldquo;2025-02-25T10:00:00Z&rdquo;, &ldquo;level&rdquo;: &ldquo;INFO&rdquo;, &ldquo;message&rdquo;: &ldquo;User login successful&rdquo;}。</li><li><strong>用途</strong>：Logs 是故障排查的基石。例如，当系统抛出 500 错误时，开发者可以通过日志查看具体的错误堆栈或异常信息。</li><li><strong>与 Metrics 和 Traces 的关系</strong>：Logs 提供细粒度的上下文，而 Metrics 提供宏观趋势，Traces 提供请求路径，三者相辅相成。</li></ul><hr><h2 id=opentelemetry可观测性的统一标准>OpenTelemetry：可观测性的统一标准</h2><p>OpenTelemetry 是一个由 CNCF（云原生计算基金会）支持的开源项目，旨在为分布式系统提供一致、可移植的可观测性数据采集和传输框架。它由 OpenTracing 和 OpenCensus 两个项目合并发展而来，解决了之前标准不统一的问题。以下是 OpenTelemetry 的核心功能和优势：</p><ul><li><strong>统一的 API 和 SDK</strong>：支持多种编程语言（如 Go、Java、Python 等），开发者只需集成一次即可采集 Metrics、Traces 和 Logs，无需为不同工具编写重复代码。</li><li><strong>上下文自动传播</strong>：在分布式系统中，OpenTelemetry 利用 W3C Trace Context 标准，自动在服务间传递追踪上下文，确保跨服务的 Trace 完整无缺。例如，一个请求从前端到后端，Trace ID 会贯穿始终。</li><li><strong>广泛的后端支持</strong>：支持将数据导出到多种可观测性平台，如 Prometheus（Metrics）、Jaeger（Traces）、Elasticsearch（Logs）等，提供灵活的选择。</li><li><strong>高度可扩展性</strong>：通过插件机制，开发者可以自定义数据采集逻辑，例如添加特定的业务指标或日志字段。</li></ul><p><strong>注意事项</strong>：OpenTelemetry 本身不负责数据的存储或可视化，它只是一个数据采集和传输的工具集。要实现完整可观测性，需要搭配后端平台（如本文使用的 OpenObserve）。</p><hr><h2 id=go-服务接入-opentelemetry-实践>Go 服务接入 OpenTelemetry 实践</h2><p>接下来，我们将通过一个完整的示例，展示如何在 Go 服务中集成 OpenTelemetry，并结合 OpenObserve 实现可观测性。示例包括本地环境的搭建、OpenTelemetry Collector 的配置以及 Go 代码的埋点实践。</p><h3 id=1-启动本地-openobserve-服务>1. 启动本地 OpenObserve 服务</h3><p>OpenObserve 是一个轻量级的可观测性平台，支持存储和可视化 Metrics、Traces 和 Logs。假设已安装 Docker，可以通过以下步骤启动：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -v $PWD/data:/data -e ZO_DATA_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/data&#34;</span> -p 5080:5080 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    -e ZO_ROOT_USER_EMAIL<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;root@example.com&#34;</span> -e ZO_ROOT_USER_PASSWORD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;Complexpass#123&#34;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    public.ecr.aws/zinclabs/openobserve:latest
</span></span></code></pre></div><ul><li>参数说明<ul><li>-v $PWD/data:/data：将本地目录挂载到容器，用于持久化存储数据。</li><li>-p 5080:5080：映射端口，使 OpenObserve 的 Web 界面可在本地访问。</li><li>ZO_ROOT_USER_EMAIL 和 ZO_ROOT_USER_PASSWORD：设置管理员账户。</li></ul></li><li><strong>验证</strong>：启动后，打开浏览器访问 http://localhost:5080，使用 <a href=mailto:root@example.com target=_blank rel=noopener>root@example.com</a> 和 Complexpass#123 登录，检查仪表盘是否正常。</li></ul><h3 id=启动opentelemetry-collector服务>启动OpenTelemetry Collector服务</h3><p>OpenTelemetry Collector 是一个独立的服务，负责接收、处理和导出可观测性数据。我们需要创建一个配置文件 otel-collector-config.yaml：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>otlp</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>protocols</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>grpc</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>endpoint</span>: <span style=color:#ae81ff>0.0.0.0</span>:<span style=color:#ae81ff>4317</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>endpoint</span>: <span style=color:#ae81ff>0.0.0.0</span>:<span style=color:#ae81ff>4318</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>processors</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>batch</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>1s</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>send_batch_size</span>: <span style=color:#ae81ff>1024</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>exporters</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>otlphttp/openobserve</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>endpoint</span>: <span style=color:#ae81ff>http://localhost:5080/api/default</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>headers</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Authorization</span>: <span style=color:#ae81ff>Basic bGVpQGNvbm5lY3RseS5haTphMldmRzFTWXlGWXhjUWtp</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>stream-name</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>pipelines</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>traces</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>receivers</span>: [<span style=color:#ae81ff>otlp]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>processors</span>: [<span style=color:#ae81ff>batch]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>exporters</span>: [<span style=color:#ae81ff>otlphttp/openobserve]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>metrics</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>receivers</span>: [<span style=color:#ae81ff>otlp]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>processors</span>: [<span style=color:#ae81ff>batch]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>exporters</span>: [<span style=color:#ae81ff>otlphttp/openobserve]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>logs</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>receivers</span>: [<span style=color:#ae81ff>otlp]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>processors</span>: [<span style=color:#ae81ff>batch]</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>exporters</span>: [<span style=color:#ae81ff>otlphttp/openobserve]</span>
</span></span></code></pre></div><p><strong>配置文件解析</strong>：</p><ul><li><strong>Receivers</strong>：使用 OTLP 协议（OpenTelemetry Protocol）接收数据，支持 gRPC 和 HTTP 两种方式。</li><li><strong>Processors</strong>：batch 处理器将数据批量处理，减少网络开销。</li><li><strong>Exporters</strong>：将数据发送到 OpenObserve，Authorization 使用 Base64 编码的用户名和密码（这里是示例值，实际使用时需替换）。</li></ul><p><strong>启动 Collector</strong>：使用 Docker Compose 启动服务，配置文件如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>otel-collector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>otel/opentelemetry-collector-contrib:0.114.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./otel-collector-config.yaml:/etc/otelcol-contrib/config.yaml</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>/var/log/containers:/var/log/containers:ro</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># - 1888:1888 # pprof extension</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - 18888:8888 # Prometheus metrics exposed by the Collector</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - 18889:8889 # Prometheus exporter metrics</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - 13133:13133 # health_check extension</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>4317</span>:<span style=color:#ae81ff>4317</span> <span style=color:#75715e># OTLP gRPC receiver</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>4318</span>:<span style=color:#ae81ff>4318</span> <span style=color:#75715e># OTLP http receiver</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># - 55679:55679 # zpages extension</span>
</span></span><span style=display:flex><span><span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>data</span>:
</span></span></code></pre></div><p>运行 docker-compose up 后，Collector 将监听 4317 和 4318 端口，接收数据并转发到 OpenObserve。</p><h3 id=go代码埋点>Go代码埋点</h3><p>以下是一个基于 Gin 框架的 Web 服务示例，展示如何集成 OpenTelemetry，采集 Metrics、Traces 和 Logs。服务包含两个端口：主服务（8080）和内部服务（18080），模拟分布式调用。</p><h4 id=初始化-opentelemetry>初始化 OpenTelemetry</h4><p>在 main.go 中初始化 Trace、Metric 和 Log 的 Provider：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>initProvider</span>() (<span style=color:#66d9ef>func</span>(), <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 定义服务资源
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>res</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>ctx</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>WithAttributes</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>semconv</span>.<span style=color:#a6e22e>ServiceName</span>(<span style=color:#e6db74>&#34;my-service&#34;</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>semconv</span>.<span style=color:#a6e22e>ServiceVersion</span>(<span style=color:#e6db74>&#34;1.0.0&#34;</span>),
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 连接到 Collector
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>conn</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>Dial</span>(<span style=color:#e6db74>&#34;127.0.0.1:4317&#34;</span>, <span style=color:#a6e22e>grpc</span>.<span style=color:#a6e22e>WithTransportCredentials</span>(<span style=color:#a6e22e>insecure</span>.<span style=color:#a6e22e>NewCredentials</span>()))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Trace exporter
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>traceExporter</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>otlptracegrpc</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>otlptracegrpc</span>.<span style=color:#a6e22e>WithGRPCConn</span>(<span style=color:#a6e22e>conn</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tracerProvider</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sdktrace</span>.<span style=color:#a6e22e>NewTracerProvider</span>(<span style=color:#a6e22e>sdktrace</span>.<span style=color:#a6e22e>WithBatcher</span>(<span style=color:#a6e22e>traceExporter</span>), <span style=color:#a6e22e>sdktrace</span>.<span style=color:#a6e22e>WithResource</span>(<span style=color:#a6e22e>res</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>otel</span>.<span style=color:#a6e22e>SetTracerProvider</span>(<span style=color:#a6e22e>tracerProvider</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Metric exporter
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>metricExporter</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>otlpmetricgrpc</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>otlpmetricgrpc</span>.<span style=color:#a6e22e>WithGRPCConn</span>(<span style=color:#a6e22e>conn</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>metricProvider</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sdkmetric</span>.<span style=color:#a6e22e>NewMeterProvider</span>(<span style=color:#a6e22e>sdkmetric</span>.<span style=color:#a6e22e>WithResource</span>(<span style=color:#a6e22e>res</span>), <span style=color:#a6e22e>sdkmetric</span>.<span style=color:#a6e22e>WithReader</span>(<span style=color:#a6e22e>sdkmetric</span>.<span style=color:#a6e22e>NewPeriodicReader</span>(<span style=color:#a6e22e>metricExporter</span>)))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>otel</span>.<span style=color:#a6e22e>SetMeterProvider</span>(<span style=color:#a6e22e>metricProvider</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Log exporter
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>logExporter</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>otlploggrpc</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>otlploggrpc</span>.<span style=color:#a6e22e>WithGRPCConn</span>(<span style=color:#a6e22e>conn</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logProvider</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>NewLoggerProvider</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithResource</span>(<span style=color:#a6e22e>res</span>), <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithProcessor</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>NewBatchProcessor</span>(<span style=color:#a6e22e>logExporter</span>)))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>global</span>.<span style=color:#a6e22e>SetLoggerProvider</span>(<span style=color:#a6e22e>logProvider</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tracerProvider</span>.<span style=color:#a6e22e>Shutdown</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>metricProvider</span>.<span style=color:#a6e22e>Shutdown</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>logProvider</span>.<span style=color:#a6e22e>Shutdown</span>(<span style=color:#a6e22e>ctx</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>conn</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>    }, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=添加-metrics-中间件>添加 Metrics 中间件</h4><p>使用中间件记录 HTTP 请求的延迟和计数：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>metricsMiddleware</span>() <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>HandlerFunc</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>meter</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>otel</span>.<span style=color:#a6e22e>GetMeterProvider</span>().<span style=color:#a6e22e>Meter</span>(<span style=color:#e6db74>&#34;http_server&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>latencyHist</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>meter</span>.<span style=color:#a6e22e>Float64Histogram</span>(<span style=color:#e6db74>&#34;http_server_request_duration_seconds&#34;</span>, <span style=color:#a6e22e>metric</span>.<span style=color:#a6e22e>WithDescription</span>(<span style=color:#e6db74>&#34;HTTP request duration&#34;</span>))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requestCount</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>meter</span>.<span style=color:#a6e22e>Int64Counter</span>(<span style=color:#e6db74>&#34;http_server_requests_total&#34;</span>, <span style=color:#a6e22e>metric</span>.<span style=color:#a6e22e>WithDescription</span>(<span style=color:#e6db74>&#34;Total HTTP requests&#34;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Next</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>duration</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Since</span>(<span style=color:#a6e22e>start</span>).<span style=color:#a6e22e>Seconds</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>attrs</span> <span style=color:#f92672>:=</span> []<span style=color:#a6e22e>attribute</span>.<span style=color:#a6e22e>KeyValue</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>attribute</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;method&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Method</span>),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>attribute</span>.<span style=color:#a6e22e>String</span>(<span style=color:#e6db74>&#34;path&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>FullPath</span>()),
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>attribute</span>.<span style=color:#a6e22e>Int</span>(<span style=color:#e6db74>&#34;status&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Writer</span>.<span style=color:#a6e22e>Status</span>()),
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>latencyHist</span>.<span style=color:#a6e22e>Record</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Context</span>(), <span style=color:#a6e22e>duration</span>, <span style=color:#a6e22e>metric</span>.<span style=color:#a6e22e>WithAttributes</span>(<span style=color:#a6e22e>attrs</span><span style=color:#f92672>...</span>))
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>requestCount</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Context</span>(), <span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>metric</span>.<span style=color:#a6e22e>WithAttributes</span>(<span style=color:#a6e22e>attrs</span><span style=color:#f92672>...</span>))
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=主服务和内部服务>主服务和内部服务</h4><p>主服务监听 8080 端口，提供 /ping 和 /trace 两个端点。/trace 调用内部服务（18080 端口的 /hello）：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cleanup</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>initProvider</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        panic(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>cleanup</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>logger</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>otelzap</span>.<span style=color:#a6e22e>NewCore</span>(<span style=color:#e6db74>&#34;my-service&#34;</span>, <span style=color:#a6e22e>otelzap</span>.<span style=color:#a6e22e>WithLoggerProvider</span>(<span style=color:#a6e22e>global</span>.<span style=color:#a6e22e>GetLoggerProvider</span>())))
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>sugar</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>logger</span>.<span style=color:#a6e22e>Sugar</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>httpClient</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Client</span>{<span style=color:#a6e22e>Transport</span>: <span style=color:#a6e22e>otelhttp</span>.<span style=color:#a6e22e>NewTransport</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>DefaultTransport</span>)}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 启动内部服务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>internalServer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>newTracedServer</span>(<span style=color:#a6e22e>httpClient</span>, <span style=color:#a6e22e>sugar</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>go</span> <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>internalServer</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#e6db74>&#34;:18080&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>sugar</span>.<span style=color:#a6e22e>Errorw</span>(<span style=color:#e6db74>&#34;internal server failed&#34;</span>, <span style=color:#e6db74>&#34;error&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 主服务
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>New</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Use</span>(<span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Recovery</span>(), <span style=color:#a6e22e>metricsMiddleware</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#e6db74>&#34;/ping&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sugar</span>.<span style=color:#a6e22e>Infow</span>(<span style=color:#e6db74>&#34;ping&#34;</span>, <span style=color:#e6db74>&#34;url&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>URL</span>.<span style=color:#a6e22e>String</span>(), <span style=color:#e6db74>&#34;method&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Method</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>, <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>H</span>{<span style=color:#e6db74>&#34;message&#34;</span>: <span style=color:#e6db74>&#34;pong&#34;</span>})
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#e6db74>&#34;/trace&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Context</span>()
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>traceID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>trace</span>.<span style=color:#a6e22e>SpanContextFromContext</span>(<span style=color:#a6e22e>ctx</span>).<span style=color:#a6e22e>TraceID</span>().<span style=color:#a6e22e>String</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>tr</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>otel</span>.<span style=color:#a6e22e>Tracer</span>(<span style=color:#e6db74>&#34;time-consuming-operation&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>span</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tr</span>.<span style=color:#a6e22e>Start</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;sleep-operation&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>span</span>.<span style=color:#a6e22e>End</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewRequestWithContext</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;http://localhost:18080/hello&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>httpClient</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>req</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>sugar</span>.<span style=color:#a6e22e>Errorw</span>(<span style=color:#e6db74>&#34;failed to send request&#34;</span>, <span style=color:#e6db74>&#34;error&#34;</span>, <span style=color:#a6e22e>err</span>, <span style=color:#e6db74>&#34;trace_id&#34;</span>, <span style=color:#a6e22e>traceID</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>, <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>H</span>{<span style=color:#e6db74>&#34;error&#34;</span>: <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>()})
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Body</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>body</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>ReadAll</span>(<span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Body</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>respBody</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>body</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>respBody</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>sugar</span>.<span style=color:#a6e22e>Infow</span>(<span style=color:#e6db74>&#34;trace request completed&#34;</span>, <span style=color:#e6db74>&#34;trace_id&#34;</span>, <span style=color:#a6e22e>traceID</span>, <span style=color:#e6db74>&#34;status&#34;</span>, <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>StatusCode</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Header</span>(<span style=color:#e6db74>&#34;X-Trace-ID&#34;</span>, <span style=color:#a6e22e>traceID</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>StatusCode</span>, <span style=color:#a6e22e>respBody</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;Server started at :8080&#34;</span>)
</span></span><span style=display:flex><span>    panic(<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Run</span>(<span style=color:#e6db74>&#34;:8080&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>newTracedServer</span>(<span style=color:#a6e22e>httpClient</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>Client</span>, <span style=color:#a6e22e>sugar</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>zap</span>.<span style=color:#a6e22e>SugaredLogger</span>) <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Engine</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>New</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Use</span>(<span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Recovery</span>())
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>GET</span>(<span style=color:#e6db74>&#34;/hello&#34;</span>, <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>Context</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>req</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>NewRequestWithContext</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Request</span>.<span style=color:#a6e22e>Context</span>(), <span style=color:#e6db74>&#34;GET&#34;</span>, <span style=color:#e6db74>&#34;https://api.github.com&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resp</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>httpClient</span>.<span style=color:#a6e22e>Do</span>(<span style=color:#a6e22e>req</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>sugar</span>.<span style=color:#a6e22e>Errorw</span>(<span style=color:#e6db74>&#34;failed to send request&#34;</span>, <span style=color:#e6db74>&#34;error&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusInternalServerError</span>, <span style=color:#a6e22e>gin</span>.<span style=color:#a6e22e>H</span>{<span style=color:#e6db74>&#34;error&#34;</span>: <span style=color:#a6e22e>err</span>.<span style=color:#a6e22e>Error</span>()})
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Body</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>body</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>ReadAll</span>(<span style=color:#a6e22e>resp</span>.<span style=color:#a6e22e>Body</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>respBody</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#a6e22e>any</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>json</span>.<span style=color:#a6e22e>Unmarshal</span>(<span style=color:#a6e22e>body</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>respBody</span>)
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JSON</span>(<span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>StatusOK</span>, <span style=color:#a6e22e>respBody</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=总结>总结</h2><p>通过本文的实践，我们展示了如何利用 OpenTelemetry 在 Go 服务中实现全面的可观测性：</p><ol><li><strong>本地环境搭建</strong>：启动 OpenObserve 和 OpenTelemetry Collector，为数据存储和处理奠定基础。</li><li><strong>组件初始化</strong>：在 Go 中配置 Trace、Metric 和 Log 的 Provider，确保数据采集的完整性。</li><li><strong>指标收集</strong>：通过中间件记录 HTTP 请求的性能数据，适合实时监控。</li><li><strong>链路追踪</strong>：实现跨服务的请求追踪，定位分布式系统中的问题。</li><li><strong>日志集成</strong>：结合 Zap 和 OpenTelemetry，输出结构化日志，便于故障排查。</li></ol><p>未来，可以进一步探索以下方向：</p><ul><li><strong>高级可视化</strong>：结合 Grafana Tempo 或 Jaeger，优化 Traces 的展示效果。</li><li><strong>自动化告警</strong>：基于 Metrics 配置动态阈值告警。</li><li><strong>性能优化</strong>：分析采集数据的开销，调整批量处理参数。</li></ul><p>可观测性不仅是技术工具，更是现代系统设计的核心理念。通过 OpenTelemetry 和后端平台的结合，我们能够构建健壮、可维护的分布式系统。</p><h2 id=参考链接>参考链接</h2><ul><li><a href=https://opentelemetry.io/docs/ target=_blank rel=noopener>OpenTelemetry官方文档</a></li><li><a href=https://github.com/open-telemetry/opentelemetry-go target=_blank rel=noopener>OpenTelemetry Go SDK</a></li><li><a href=https://openobserve.ai/docs/ target=_blank rel=noopener>OpenObserve文档</a></li><li><a href=https://gin-gonic.com/ target=_blank rel=noopener>Gin Web Framework</a></li><li><a href=https://opentelemetry.io/docs/collector/ target=_blank rel=noopener>OpenTelemetry Collector</a></li><li><a href=https://github.com/uber-go/zap target=_blank rel=noopener>Zap Logger</a></li></ul><div class=blog-footer><div class=social-share></div><div class=copyright><ul><li style=margin-bottom:.5em>本文作者: <a href=https://ddhigh.com/ target=_blank style=color:#000;text-decoration:none>xialeistudio</a></li><li style=margin-bottom:.5em>本文链接: <a href=https://www.ddhigh.com/2024/12/02/opentelemetry-getstarted/ target=_blank style=color:#000;text-decoration:none>OpenTelemetry上手指南</a></li><li>版权声明: <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank style=color:#000;text-decoration:none>「署名-非商业性使用-相同方式共享 4.0 国际」</a></li></ul></div><div style=margin-top:2rem><img src=/img/mp.png alt=qrcode></div></div></section><div class=paginator><a class=prev href=https://www.ddhigh.com/2025/02/12/the-evolution-of-service-architecture/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg><span>服务架构的演进历史</span></a>
<a class=next href=https://www.ddhigh.com/2024/08/22/build-a-weather-query-agent/><span>构建一个天气查询Agent</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div><div class=comments><script>const getTheme=window.localStorage&&window.localStorage.getItem("theme");let theme=getTheme==="dark"?"dark":"light",s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","xialeistudio/discussion"),s.setAttribute("data-repo-id","R_kgDOKurTRA"),s.setAttribute("data-category","General"),s.setAttribute("data-category-id","DIC_kwDOKurTRM4CbCJt"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",theme),s.setAttribute("data-lang","en"),s.setAttribute("data-loading","lazy"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></article></div><footer class=footer><p>&copy; 2014 - 2025 <a href=https://www.ddhigh.com>每天进步一点点</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script><script src=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js integrity="sha512-9DNXrSjk17bU9MUbRp3IjwcWe46V8FaGA062PFbryPUAEQVRbz4jiZP6FW0AdbqEGtMYBDWnul3eiGBMJOQajA==" crossorigin=anonymous referrerpolicy=no-referrer></script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>