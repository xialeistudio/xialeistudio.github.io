<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Lunet: Design and Implementation of a High-Performance Coroutine Network Library</title>
<meta charset=utf-8><meta name=google-adsense-account content="ca-pub-2871082647721658"><meta content="Web ,Java ,Go ,Node.js ,PHP ,Koa ,MySQL ,Redis ,front-end ,back-end ,database" name=keywords><meta name=description content="Lunet is a high-performance runtime written in C that integrates LuaJIT and libuv, focusing on coroutine-driven asynchronous programming. It simplifies the handling of asynchronous I/O and blocking tasks, enabling developers to easily write high-concurrency network applications using Lua scripts. It&rsquo;s ideal for scenarios like game servers and network services."><meta name=author content="Lei Xia"><link rel=canonical href=https://www.ddhigh.com/en/2025/07/12/lunet-high-performance-coroutine-network-library/><link rel=alternate type=application/rss+xml href=https://www.ddhigh.com/index.xml title=每天进步一点点><script async src="https://www.googletagmanager.com/gtag/js?id=G-EC3XLVSGKV"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EC3XLVSGKV")</script><meta property="og:title" content="Lunet: Design and Implementation of a High-Performance Coroutine Network Library"><meta property="og:description" content="Lunet is a high-performance runtime written in C that integrates LuaJIT and libuv, focusing on coroutine-driven asynchronous programming. It simplifies the handling of asynchronous I/O and blocking tasks, enabling developers to easily write high-concurrency network applications using Lua scripts. It&rsquo;s ideal for scenarios like game servers and network services."><meta property="og:type" content="article"><meta property="og:url" content="https://www.ddhigh.com/en/2025/07/12/lunet-high-performance-coroutine-network-library/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-12T11:53:08+08:00"><meta property="article:modified_time" content="2025-07-12T11:53:08+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Lunet: Design and Implementation of a High-Performance Coroutine Network Library"><meta name=twitter:description content="Lunet is a high-performance runtime written in C that integrates LuaJIT and libuv, focusing on coroutine-driven asynchronous programming. It simplifies the handling of asynchronous I/O and blocking tasks, enabling developers to easily write high-concurrency network applications using Lua scripts. It&rsquo;s ideal for scenarios like game servers and network services."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":4,"name":"Lunet: Design and Implementation of a High-Performance Coroutine Network Library","item":"https://www.ddhigh.com/en/2025/07/12/lunet-high-performance-coroutine-network-library/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Lunet: Design and Implementation of a High-Performance Coroutine Network Library","name":"Lunet: Design and Implementation of a High-Performance Coroutine Network Library","description":"Lunet is a high-performance runtime written in C that integrates LuaJIT and libuv, focusing on coroutine-driven asynchronous programming. It simplifies the handling of asynchronous I/O and blocking tasks, enabling developers to easily write high-concurrency network applications using Lua scripts. It\u0026rsquo;s ideal for scenarios like game servers and network services.\n","keywords":["libuv","lua"],"articleBody":"Lunet is a high-performance runtime written in C that integrates LuaJIT and libuv, focusing on coroutine-driven asynchronous programming. It simplifies the handling of asynchronous I/O and blocking tasks, enabling developers to easily write high-concurrency network applications using Lua scripts. It’s ideal for scenarios like game servers and network services.\nWhat is Lunet In modern application development, high concurrency and asynchronous programming have become essential skills. However, traditional asynchronous programming often requires developers to handle complex callback functions and state management, resulting in poor code readability. Lunet cleverly solves this problem through coroutine technology.\nLunet is a coroutine-based network library that provides synchronous-style APIs with asynchronous execution underneath. This means you can write asynchronous programs like synchronous code, maintaining code clarity and readability while achieving high performance through asynchronous execution.\nCore Architecture Lunet’s architectural design fully embodies the philosophy of “standing on the shoulders of giants”:\nTechnology Stack C Core: High-performance native implementation providing optimal execution efficiency LuaJIT: Fast Lua execution environment supporting FFI (Foreign Function Interface) libuv: Cross-platform asynchronous I/O library, the underlying engine of Node.js Coroutines: Concurrent programming using Lua coroutines Design Philosophy Simplicity: Provides simple and intuitive APIs, reducing learning costs High Performance: Fully utilizes LuaJIT’s JIT compilation capabilities and libuv’s asynchronous features Modularity: Divides functionality into modules for easy maintenance and extension Cross-platform: Supports Linux, macOS, and Windows Core Modules Explained 1. Core Module (lunet) The core module provides basic functionality for coroutine management:\nlocal lunet = require('lunet') -- Create and run new coroutine lunet.spawn(function() print(\"Hello from coroutine!\") lunet.sleep(1000) -- Non-blocking sleep print(\"After 1 second\") end) 2. Network Module (lunet.socket) The network module is the core of Lunet, providing complete TCP network programming capabilities:\nlocal socket = require('lunet.socket') -- Create TCP server local listener, err = socket.listen(\"tcp\", \"127.0.0.1\", 8080) if not listener then error(\"Failed to listen: \" .. err) end -- Accept connections lunet.spawn(function() while true do local client, err = socket.accept(listener) if client then -- Handle each client in a new coroutine lunet.spawn(function() local data, err = socket.read(client) if data then socket.write(client, \"Echo: \" .. data) end socket.close(client) end) end end end) 3. File System Module (lunet.fs) The file system module provides asynchronous file operation capabilities:\nlocal fs = require('lunet.fs') lunet.spawn(function() -- Asynchronous file operations local file, err = fs.open('config.json', 'r') if file then local content, err = fs.read(file, 1024) if content then print(\"Config content:\", content) end fs.close(file) end -- Directory traversal local entries, err = fs.scandir('./logs') if entries then for i, entry in ipairs(entries) do print(\"Log file:\", entry.name, \"type:\", entry.type) end end end) 4. Database Module (lunet.mysql) The database module provides asynchronous MySQL database access capabilities:\nlocal mysql = require('lunet.mysql') lunet.spawn(function() local conn, err = mysql.open({ host = \"localhost\", port = 3306, user = \"root\", password = \"password\", database = \"myapp\" }) if conn then -- Query operations local users, err = mysql.query(conn, \"SELECT * FROM users WHERE active = 1\") if users then for i, user in ipairs(users) do print(\"User:\", user.name, user.email) end end -- Update operations local result, err = mysql.exec(conn, \"UPDATE users SET last_login = NOW() WHERE id = ?\", {user_id}) if result then print(\"Updated\", result.affected_rows, \"rows\") end mysql.close(conn) end end) Practical Case: Building a High-Performance Web Server Let’s demonstrate Lunet’s powerful capabilities through a complete example:\nlocal lunet = require('lunet') local socket = require('lunet.socket') local fs = require('lunet.fs') local mysql = require('lunet.mysql') -- Database connection pool local db_pool = {} -- Initialize database connections local function init_database() for i = 1, 10 do -- Create 10 connections local conn, err = mysql.open({ host = \"localhost\", port = 3306, user = \"webuser\", password = \"password\", database = \"website\" }) if conn then table.insert(db_pool, conn) end end end -- Get database connection local function get_db_connection() if #db_pool \u003e 0 then return table.remove(db_pool, 1) end return nil end -- Release database connection local function release_db_connection(conn) table.insert(db_pool, conn) end -- Handle HTTP requests local function handle_request(client) local request, err = socket.read(client) if not request then socket.close(client) return end -- Parse request local method, path = request:match(\"([A-Z]+) ([^ ]+)\") if path == \"/api/users\" then -- Handle user API local conn = get_db_connection() if conn then local users, err = mysql.query(conn, \"SELECT id, name, email FROM users LIMIT 10\") release_db_connection(conn) if users then local json_response = json.encode(users) local response = string.format( \"HTTP/1.1 200 OK\\r\\n\" .. \"Content-Type: application/json\\r\\n\" .. \"Content-Length: %d\\r\\n\\r\\n%s\", #json_response, json_response ) socket.write(client, response) end end elseif path == \"/static/\" then -- Handle static files local filename = path:sub(9) -- Remove \"/static/\" local file, err = fs.open(\"public/\" .. filename, \"r\") if file then local content, err = fs.read(file, 1024 * 1024) -- Read 1MB fs.close(file) if content then local response = string.format( \"HTTP/1.1 200 OK\\r\\n\" .. \"Content-Type: text/html\\r\\n\" .. \"Content-Length: %d\\r\\n\\r\\n%s\", #content, content ) socket.write(client, response) end end else -- 404 response local response = \"HTTP/1.1 404 Not Found\\r\\nContent-Length: 0\\r\\n\\r\\n\" socket.write(client, response) end socket.close(client) end -- Main server logic local function start_server() init_database() local listener, err = socket.listen(\"tcp\", \"0.0.0.0\", 8080) if not listener then error(\"Failed to start server: \" .. err) end print(\"Server started on http://0.0.0.0:8080\") lunet.spawn(function() while true do local client, err = socket.accept(listener) if client then -- Create independent coroutine for each client lunet.spawn(function() handle_request(client) end) end end end) end -- Start server start_server() Performance Advantages 1. Coroutines vs Threads Traditional multi-threading models require creating one thread per connection, which brings the following problems:\nThread creation and destruction overhead Context switching costs Memory consumption (each thread requires several MB of stack space) Lunet’s coroutine model is different:\nCoroutine creation has almost zero cost Coroutine switching is controlled by user space, no kernel involvement needed A single coroutine only occupies a few KB of memory 2. Advantages of Asynchronous I/O Through libuv’s event loop, Lunet can handle thousands of concurrent connections in a single thread, avoiding the blocking issues of traditional synchronous I/O.\n3. LuaJIT Performance LuaJIT’s JIT compiler can compile hot code paths to machine code, achieving performance close to C language, far exceeding traditional interpreted execution.\nUse Cases 1. Game Server -- Game server example local lunet = require('lunet') local socket = require('lunet.socket') -- Player connection management local players = {} local function handle_player(client) local player_id = generate_player_id() players[player_id] = { client = client, x = 0, y = 0, last_heartbeat = os.time() } while true do local message, err = socket.read(client) if not message then break end -- Handle game messages local msg_type, data = parse_message(message) if msg_type == \"move\" then players[player_id].x = data.x players[player_id].y = data.y broadcast_player_position(player_id, data.x, data.y) elseif msg_type == \"heartbeat\" then players[player_id].last_heartbeat = os.time() end end -- Player disconnection players[player_id] = nil socket.close(client) end 2. Microservice Gateway -- API gateway example local lunet = require('lunet') local socket = require('lunet.socket') -- Service discovery local services = { user_service = {\"127.0.0.1:3001\", \"127.0.0.1:3002\"}, order_service = {\"127.0.0.1:3003\", \"127.0.0.1:3004\"} } local function proxy_request(service_name, request) local service_list = services[service_name] if not service_list then return nil, \"Service not found\" end -- Load balancing (round-robin) local service_addr = service_list[math.random(#service_list)] local host, port = service_addr:match(\"([^:]+):(%d+)\") -- Forward request local backend, err = socket.connect(host, tonumber(port)) if not backend then return nil, \"Failed to connect to backend\" end socket.write(backend, request) local response, err = socket.read(backend) socket.close(backend) return response, err end 3. Real-time Data Processing -- Real-time data processing example local lunet = require('lunet') local socket = require('lunet.socket') -- Data processing pipeline local function process_data_stream() local listener, err = socket.listen(\"tcp\", \"0.0.0.0\", 9999) if not listener then error(\"Failed to start data processor\") end lunet.spawn(function() while true do local client, err = socket.accept(listener) if client then lunet.spawn(function() while true do local data, err = socket.read(client) if not data then break end -- Data processing local processed = process_json_data(data) -- Send to message queue send_to_queue(processed) -- Real-time statistics update_metrics(processed) end socket.close(client) end) end end end) end Development Experience 1. Type Safety Lunet provides complete type definitions, supporting intelligent hints in modern IDEs:\n---@type lunet local lunet = require('lunet') -- IDE will provide complete function signatures and documentation lunet.spawn(function() lunet.sleep(1000) -- Smart hint: Sleep for specified milliseconds end) 2. Error Handling Lunet adopts Lua-style error handling patterns:\nlocal result, err = some_operation() if not result then -- Handle error print(\"Error:\", err) return end -- Continue processing result 3. Debugging Support Since business logic is written in Lua, you can utilize LuaJIT’s debugging tools for development and debugging.\nSummary Lunet, through clever design, perfectly combines coroutines, asynchronous I/O, and high-performance runtime, providing developers with a powerful yet easy-to-use network programming framework. Its main advantages include:\nHigh development efficiency: Synchronous-style APIs that are easy to understand and maintain Excellent performance: Based on LuaJIT and libuv, with extremely high concurrency capabilities Complete functionality: Covers common modules like networking, file systems, and databases Cross-platform: Supports mainstream operating systems Community-friendly: Open source project with continuous updates and maintenance Whether you’re building high-concurrency web servers, game servers, or real-time data processing systems, Lunet can provide you with powerful technical support. If you’re looking for a high-performance, easy-to-use network programming framework, Lunet is definitely worth trying.\nRelated Resources GitHub Repository API Documentation Chinese Documentation This article provides an in-depth introduction to Lunet’s design philosophy, core functionality, and usage methods, hoping to help you better understand and use this powerful network programming framework.\n","wordCount":"1511","inLanguage":"en","datePublished":"2025-07-12T11:53:08+08:00","dateModified":"2025-07-12T11:53:08+08:00","author":{"@type":"Person","name":"Lei Xia"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ddhigh.com/en/2025/07/12/lunet-high-performance-coroutine-network-library/"},"publisher":{"@type":"Organization","name":"每天进步一点点","logo":{"@type":"ImageObject","url":"https://www.ddhigh.com/favicon.ico"}}}</script><link rel=icon href=/img/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/img/favicon.ico><link rel=manifest href=/img/favicon.ico><link href=/titilliumweb/titilliumweb.css rel=stylesheet><link rel=stylesheet href=/css/main.min.0eb4160ba4a2d63122fe8ae83f1560951a87ab510d5dab0615973b5206555759.css integrity="sha256-DrQWC6Si1jEi/oroPxVglRqHq1ENXasGFZc7UgZVV1k=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css integrity="sha512-ygEyjMC6rqnzJqWGjRTJUPYMEs9JUOm3i7OWUS9CgQ4XkBUvMsgCS1I8JqavidQ2ClHcREB7IbA2mN08+r9Elg==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.894ca9c68afab956438c4926a0dc7f5293e04e08595bd27abdb123e94801f684.js></script><script>hljs.highlightAll()</script><script>$darkModeInit.Content|safeJS</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2871082647721658" crossorigin=anonymous></script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/en>DayDayUP
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/en/>Home</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/en/archives>Archives</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/en/books>Books</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/en/guestbook>Guestbook</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/xialeistudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li><li class="navigation-item navigation-language"><a href=https://www.ddhigh.com/2025/07/12/lunet-high-performance-coroutine-network-library/>中</a></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Lunet: Design and Implementation of a High-Performance Coroutine Network Library</h1></header><p><small>July 12, 2025&nbsp;· 1511 words&nbsp;· 8 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#what-is-lunet>What is Lunet</a></li><li><a href=#core-architecture>Core Architecture</a><ul><li><a href=#technology-stack>Technology Stack</a></li><li><a href=#design-philosophy>Design Philosophy</a></li></ul></li><li><a href=#core-modules-explained>Core Modules Explained</a><ul><li><a href=#1-core-module-lunet>1. Core Module (<code>lunet</code>)</a></li><li><a href=#2-network-module-lunetsocket>2. Network Module (<code>lunet.socket</code>)</a></li><li><a href=#3-file-system-module-lunetfs>3. File System Module (<code>lunet.fs</code>)</a></li><li><a href=#4-database-module-lunetmysql>4. Database Module (<code>lunet.mysql</code>)</a></li></ul></li><li><a href=#practical-case-building-a-high-performance-web-server>Practical Case: Building a High-Performance Web Server</a></li><li><a href=#performance-advantages>Performance Advantages</a><ul><li><a href=#1-coroutines-vs-threads>1. Coroutines vs Threads</a></li><li><a href=#2-advantages-of-asynchronous-io>2. Advantages of Asynchronous I/O</a></li><li><a href=#3-luajit-performance>3. LuaJIT Performance</a></li></ul></li><li><a href=#use-cases>Use Cases</a><ul><li><a href=#1-game-server>1. Game Server</a></li><li><a href=#2-microservice-gateway>2. Microservice Gateway</a></li><li><a href=#3-real-time-data-processing>3. Real-time Data Processing</a></li></ul></li><li><a href=#development-experience>Development Experience</a><ul><li><a href=#1-type-safety>1. Type Safety</a></li><li><a href=#2-error-handling>2. Error Handling</a></li><li><a href=#3-debugging-support>3. Debugging Support</a></li></ul></li><li><a href=#summary>Summary</a></li><li><a href=#related-resources>Related Resources</a></li></ul></nav></div><section class=blog-content><p>Lunet is a high-performance runtime written in C that integrates LuaJIT and libuv, focusing on coroutine-driven asynchronous programming. It simplifies the handling of asynchronous I/O and blocking tasks, enabling developers to easily write high-concurrency network applications using Lua scripts. It&rsquo;s ideal for scenarios like game servers and network services.</p><h2 id=what-is-lunet>What is Lunet</h2><p>In modern application development, high concurrency and asynchronous programming have become essential skills. However, traditional asynchronous programming often requires developers to handle complex callback functions and state management, resulting in poor code readability. Lunet cleverly solves this problem through coroutine technology.</p><p>Lunet is a coroutine-based network library that provides <strong>synchronous-style APIs with asynchronous execution underneath</strong>. This means you can write asynchronous programs like synchronous code, maintaining code clarity and readability while achieving high performance through asynchronous execution.</p><h2 id=core-architecture>Core Architecture</h2><p>Lunet&rsquo;s architectural design fully embodies the philosophy of &ldquo;standing on the shoulders of giants&rdquo;:</p><h3 id=technology-stack>Technology Stack</h3><ul><li><strong>C Core</strong>: High-performance native implementation providing optimal execution efficiency</li><li><strong>LuaJIT</strong>: Fast Lua execution environment supporting FFI (Foreign Function Interface)</li><li><strong>libuv</strong>: Cross-platform asynchronous I/O library, the underlying engine of Node.js</li><li><strong>Coroutines</strong>: Concurrent programming using Lua coroutines</li></ul><h3 id=design-philosophy>Design Philosophy</h3><ol><li><strong>Simplicity</strong>: Provides simple and intuitive APIs, reducing learning costs</li><li><strong>High Performance</strong>: Fully utilizes LuaJIT&rsquo;s JIT compilation capabilities and libuv&rsquo;s asynchronous features</li><li><strong>Modularity</strong>: Divides functionality into modules for easy maintenance and extension</li><li><strong>Cross-platform</strong>: Supports Linux, macOS, and Windows</li></ol><h2 id=core-modules-explained>Core Modules Explained</h2><h3 id=1-core-module-lunet>1. Core Module (<code>lunet</code>)</h3><p>The core module provides basic functionality for coroutine management:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> lunet <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Create and run new coroutine</span>
</span></span><span style=display:flex><span>lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Hello from coroutine!&#34;</span>)
</span></span><span style=display:flex><span>    lunet.sleep(<span style=color:#ae81ff>1000</span>)  <span style=color:#75715e>-- Non-blocking sleep</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;After 1 second&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>)
</span></span></code></pre></div><h3 id=2-network-module-lunetsocket>2. Network Module (<code>lunet.socket</code>)</h3><p>The network module is the core of Lunet, providing complete TCP network programming capabilities:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> socket <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet.socket&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Create TCP server</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> listener, err <span style=color:#f92672>=</span> socket.listen(<span style=color:#e6db74>&#34;tcp&#34;</span>, <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>, <span style=color:#ae81ff>8080</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> listener <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    error(<span style=color:#e6db74>&#34;Failed to listen: &#34;</span> <span style=color:#f92672>..</span> err)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Accept connections</span>
</span></span><span style=display:flex><span>lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>true</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> client, err <span style=color:#f92672>=</span> socket.accept(listener)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> client <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#75715e>-- Handle each client in a new coroutine</span>
</span></span><span style=display:flex><span>            lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>local</span> data, err <span style=color:#f92672>=</span> socket.read(client)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> data <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                    socket.write(client, <span style=color:#e6db74>&#34;Echo: &#34;</span> <span style=color:#f92672>..</span> data)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>                socket.close(client)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>)
</span></span></code></pre></div><h3 id=3-file-system-module-lunetfs>3. File System Module (<code>lunet.fs</code>)</h3><p>The file system module provides asynchronous file operation capabilities:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> fs <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet.fs&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- Asynchronous file operations</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> file, err <span style=color:#f92672>=</span> fs.open(<span style=color:#e6db74>&#39;config.json&#39;</span>, <span style=color:#e6db74>&#39;r&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> file <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> content, err <span style=color:#f92672>=</span> fs.read(file, <span style=color:#ae81ff>1024</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> content <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Config content:&#34;</span>, content)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        fs.close(file)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- Directory traversal</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> entries, err <span style=color:#f92672>=</span> fs.scandir(<span style=color:#e6db74>&#39;./logs&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> entries <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> i, entry <span style=color:#66d9ef>in</span> ipairs(entries) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Log file:&#34;</span>, entry.name, <span style=color:#e6db74>&#34;type:&#34;</span>, entry.type)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>)
</span></span></code></pre></div><h3 id=4-database-module-lunetmysql>4. Database Module (<code>lunet.mysql</code>)</h3><p>The database module provides asynchronous MySQL database access capabilities:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> mysql <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet.mysql&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> conn, err <span style=color:#f92672>=</span> mysql.open({
</span></span><span style=display:flex><span>        host <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;localhost&#34;</span>,
</span></span><span style=display:flex><span>        port <span style=color:#f92672>=</span> <span style=color:#ae81ff>3306</span>,
</span></span><span style=display:flex><span>        user <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;root&#34;</span>,
</span></span><span style=display:flex><span>        password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;password&#34;</span>,
</span></span><span style=display:flex><span>        database <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;myapp&#34;</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> conn <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- Query operations</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> users, err <span style=color:#f92672>=</span> mysql.query(conn, <span style=color:#e6db74>&#34;SELECT * FROM users WHERE active = 1&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> users <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> i, user <span style=color:#66d9ef>in</span> ipairs(users) <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>                print(<span style=color:#e6db74>&#34;User:&#34;</span>, user.name, user.email)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- Update operations</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> result, err <span style=color:#f92672>=</span> mysql.exec(conn, 
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#34;UPDATE users SET last_login = NOW() WHERE id = ?&#34;</span>, {user_id})
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> result <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            print(<span style=color:#e6db74>&#34;Updated&#34;</span>, result.affected_rows, <span style=color:#e6db74>&#34;rows&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        mysql.close(conn)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>)
</span></span></code></pre></div><h2 id=practical-case-building-a-high-performance-web-server>Practical Case: Building a High-Performance Web Server</h2><p>Let&rsquo;s demonstrate Lunet&rsquo;s powerful capabilities through a complete example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> lunet <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> socket <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet.socket&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> fs <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet.fs&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> mysql <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet.mysql&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Database connection pool</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> db_pool <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Initialize database connections</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>init_database</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> i <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>do</span>  <span style=color:#75715e>-- Create 10 connections</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> conn, err <span style=color:#f92672>=</span> mysql.open({
</span></span><span style=display:flex><span>            host <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;localhost&#34;</span>,
</span></span><span style=display:flex><span>            port <span style=color:#f92672>=</span> <span style=color:#ae81ff>3306</span>,
</span></span><span style=display:flex><span>            user <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;webuser&#34;</span>,
</span></span><span style=display:flex><span>            password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;password&#34;</span>,
</span></span><span style=display:flex><span>            database <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;website&#34;</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> conn <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            table.insert(db_pool, conn)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Get database connection</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>get_db_connection</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>#</span>db_pool <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> table.remove(db_pool, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Release database connection</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>release_db_connection</span>(conn)
</span></span><span style=display:flex><span>    table.insert(db_pool, conn)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Handle HTTP requests</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handle_request</span>(client)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> request, err <span style=color:#f92672>=</span> socket.read(client)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> request <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        socket.close(client)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- Parse request</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> method, path <span style=color:#f92672>=</span> request:match(<span style=color:#e6db74>&#34;([A-Z]+) ([^ ]+)&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> path <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;/api/users&#34;</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- Handle user API</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> conn <span style=color:#f92672>=</span> get_db_connection()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> conn <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>local</span> users, err <span style=color:#f92672>=</span> mysql.query(conn, <span style=color:#e6db74>&#34;SELECT id, name, email FROM users LIMIT 10&#34;</span>)
</span></span><span style=display:flex><span>            release_db_connection(conn)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> users <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>local</span> json_response <span style=color:#f92672>=</span> json.encode(users)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>local</span> response <span style=color:#f92672>=</span> string.format(
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;HTTP/1.1 200 OK</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>..</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;Content-Type: application/json</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>..</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;Content-Length: %d</span><span style=color:#ae81ff>\r\n\r\n</span><span style=color:#e6db74>%s&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>#</span>json_response, json_response
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                socket.write(client, response)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elseif</span> path <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;/static/&#34;</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- Handle static files</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> filename <span style=color:#f92672>=</span> path:sub(<span style=color:#ae81ff>9</span>)  <span style=color:#75715e>-- Remove &#34;/static/&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> file, err <span style=color:#f92672>=</span> fs.open(<span style=color:#e6db74>&#34;public/&#34;</span> <span style=color:#f92672>..</span> filename, <span style=color:#e6db74>&#34;r&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> file <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>local</span> content, err <span style=color:#f92672>=</span> fs.read(file, <span style=color:#ae81ff>1024</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>1024</span>)  <span style=color:#75715e>-- Read 1MB</span>
</span></span><span style=display:flex><span>            fs.close(file)
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> content <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>local</span> response <span style=color:#f92672>=</span> string.format(
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;HTTP/1.1 200 OK</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>..</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;Content-Type: text/html</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>..</span>
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;Content-Length: %d</span><span style=color:#ae81ff>\r\n\r\n</span><span style=color:#e6db74>%s&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#f92672>#</span>content, content
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>                socket.write(client, response)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- 404 response</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> response <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;HTTP/1.1 404 Not Found</span><span style=color:#ae81ff>\r\n</span><span style=color:#e6db74>Content-Length: 0</span><span style=color:#ae81ff>\r\n\r\n</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        socket.write(client, response)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    socket.close(client)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Main server logic</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>start_server</span>()
</span></span><span style=display:flex><span>    init_database()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> listener, err <span style=color:#f92672>=</span> socket.listen(<span style=color:#e6db74>&#34;tcp&#34;</span>, <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>, <span style=color:#ae81ff>8080</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> listener <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        error(<span style=color:#e6db74>&#34;Failed to start server: &#34;</span> <span style=color:#f92672>..</span> err)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Server started on http://0.0.0.0:8080&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>true</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>local</span> client, err <span style=color:#f92672>=</span> socket.accept(listener)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> client <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                <span style=color:#75715e>-- Create independent coroutine for each client</span>
</span></span><span style=display:flex><span>                lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>                    handle_request(client)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Start server</span>
</span></span><span style=display:flex><span>start_server()
</span></span></code></pre></div><h2 id=performance-advantages>Performance Advantages</h2><h3 id=1-coroutines-vs-threads>1. Coroutines vs Threads</h3><p>Traditional multi-threading models require creating one thread per connection, which brings the following problems:</p><ul><li>Thread creation and destruction overhead</li><li>Context switching costs</li><li>Memory consumption (each thread requires several MB of stack space)</li></ul><p>Lunet&rsquo;s coroutine model is different:</p><ul><li>Coroutine creation has almost zero cost</li><li>Coroutine switching is controlled by user space, no kernel involvement needed</li><li>A single coroutine only occupies a few KB of memory</li></ul><h3 id=2-advantages-of-asynchronous-io>2. Advantages of Asynchronous I/O</h3><p>Through libuv&rsquo;s event loop, Lunet can handle thousands of concurrent connections in a single thread, avoiding the blocking issues of traditional synchronous I/O.</p><h3 id=3-luajit-performance>3. LuaJIT Performance</h3><p>LuaJIT&rsquo;s JIT compiler can compile hot code paths to machine code, achieving performance close to C language, far exceeding traditional interpreted execution.</p><h2 id=use-cases>Use Cases</h2><h3 id=1-game-server>1. Game Server</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- Game server example</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> lunet <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> socket <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet.socket&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Player connection management</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> players <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handle_player</span>(client)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> player_id <span style=color:#f92672>=</span> generate_player_id()
</span></span><span style=display:flex><span>    players[player_id] <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>        client <span style=color:#f92672>=</span> client,
</span></span><span style=display:flex><span>        x <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>        y <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>,
</span></span><span style=display:flex><span>        last_heartbeat <span style=color:#f92672>=</span> os.time()
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>true</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> message, err <span style=color:#f92672>=</span> socket.read(client)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> message <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#75715e>-- Handle game messages</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>local</span> msg_type, data <span style=color:#f92672>=</span> parse_message(message)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> msg_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;move&#34;</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            players[player_id].x <span style=color:#f92672>=</span> data.x
</span></span><span style=display:flex><span>            players[player_id].y <span style=color:#f92672>=</span> data.y
</span></span><span style=display:flex><span>            broadcast_player_position(player_id, data.x, data.y)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elseif</span> msg_type <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;heartbeat&#34;</span> <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            players[player_id].last_heartbeat <span style=color:#f92672>=</span> os.time()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- Player disconnection</span>
</span></span><span style=display:flex><span>    players[player_id] <span style=color:#f92672>=</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    socket.close(client)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><h3 id=2-microservice-gateway>2. Microservice Gateway</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- API gateway example</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> lunet <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> socket <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet.socket&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Service discovery</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> services <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    user_service <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;127.0.0.1:3001&#34;</span>, <span style=color:#e6db74>&#34;127.0.0.1:3002&#34;</span>},
</span></span><span style=display:flex><span>    order_service <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#34;127.0.0.1:3003&#34;</span>, <span style=color:#e6db74>&#34;127.0.0.1:3004&#34;</span>}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>proxy_request</span>(service_name, request)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> service_list <span style=color:#f92672>=</span> services[service_name]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> service_list <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#e6db74>&#34;Service not found&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- Load balancing (round-robin)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> service_addr <span style=color:#f92672>=</span> service_list[math.random(<span style=color:#f92672>#</span>service_list)]
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> host, port <span style=color:#f92672>=</span> service_addr:match(<span style=color:#e6db74>&#34;([^:]+):(%d+)&#34;</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- Forward request</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> backend, err <span style=color:#f92672>=</span> socket.connect(host, tonumber(port))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> backend <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#e6db74>&#34;Failed to connect to backend&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    socket.write(backend, request)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> response, err <span style=color:#f92672>=</span> socket.read(backend)
</span></span><span style=display:flex><span>    socket.close(backend)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> response, err
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><h3 id=3-real-time-data-processing>3. Real-time Data Processing</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>-- Real-time data processing example</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> lunet <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> socket <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet.socket&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Data processing pipeline</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>process_data_stream</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>local</span> listener, err <span style=color:#f92672>=</span> socket.listen(<span style=color:#e6db74>&#34;tcp&#34;</span>, <span style=color:#e6db74>&#34;0.0.0.0&#34;</span>, <span style=color:#ae81ff>9999</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> listener <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        error(<span style=color:#e6db74>&#34;Failed to start data processor&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>true</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>local</span> client, err <span style=color:#f92672>=</span> socket.accept(listener)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> client <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>true</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>local</span> data, err <span style=color:#f92672>=</span> socket.read(client)
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> data <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>                        
</span></span><span style=display:flex><span>                        <span style=color:#75715e>-- Data processing</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>local</span> processed <span style=color:#f92672>=</span> process_json_data(data)
</span></span><span style=display:flex><span>                        
</span></span><span style=display:flex><span>                        <span style=color:#75715e>-- Send to message queue</span>
</span></span><span style=display:flex><span>                        send_to_queue(processed)
</span></span><span style=display:flex><span>                        
</span></span><span style=display:flex><span>                        <span style=color:#75715e>-- Real-time statistics</span>
</span></span><span style=display:flex><span>                        update_metrics(processed)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>                    socket.close(client)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>end</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><h2 id=development-experience>Development Experience</h2><h3 id=1-type-safety>1. Type Safety</h3><p>Lunet provides complete type definitions, supporting intelligent hints in modern IDEs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#75715e>---@type lunet</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>local</span> lunet <span style=color:#f92672>=</span> require(<span style=color:#e6db74>&#39;lunet&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- IDE will provide complete function signatures and documentation</span>
</span></span><span style=display:flex><span>lunet.spawn(<span style=color:#66d9ef>function</span>()
</span></span><span style=display:flex><span>    lunet.sleep(<span style=color:#ae81ff>1000</span>)  <span style=color:#75715e>-- Smart hint: Sleep for specified milliseconds</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>)
</span></span></code></pre></div><h3 id=2-error-handling>2. Error Handling</h3><p>Lunet adopts Lua-style error handling patterns:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span><span style=color:#66d9ef>local</span> result, err <span style=color:#f92672>=</span> some_operation()
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> result <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- Handle error</span>
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;Error:&#34;</span>, err)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span><span style=color:#75715e>-- Continue processing result</span>
</span></span></code></pre></div><h3 id=3-debugging-support>3. Debugging Support</h3><p>Since business logic is written in Lua, you can utilize LuaJIT&rsquo;s debugging tools for development and debugging.</p><h2 id=summary>Summary</h2><p>Lunet, through clever design, perfectly combines coroutines, asynchronous I/O, and high-performance runtime, providing developers with a powerful yet easy-to-use network programming framework. Its main advantages include:</p><ol><li><strong>High development efficiency</strong>: Synchronous-style APIs that are easy to understand and maintain</li><li><strong>Excellent performance</strong>: Based on LuaJIT and libuv, with extremely high concurrency capabilities</li><li><strong>Complete functionality</strong>: Covers common modules like networking, file systems, and databases</li><li><strong>Cross-platform</strong>: Supports mainstream operating systems</li><li><strong>Community-friendly</strong>: Open source project with continuous updates and maintenance</li></ol><p>Whether you&rsquo;re building high-concurrency web servers, game servers, or real-time data processing systems, Lunet can provide you with powerful technical support. If you&rsquo;re looking for a high-performance, easy-to-use network programming framework, Lunet is definitely worth trying.</p><h2 id=related-resources>Related Resources</h2><ul><li><a href=https://github.com/xialeistudio/lunet target=_blank rel=noopener>GitHub Repository</a></li><li><a href=https://github.com/xialeistudio/lunet/blob/main/README.md target=_blank rel=noopener>API Documentation</a></li><li><a href=https://github.com/xialeistudio/lunet/blob/main/README-CN.md target=_blank rel=noopener>Chinese Documentation</a></li></ul><p><em>This article provides an in-depth introduction to Lunet&rsquo;s design philosophy, core functionality, and usage methods, hoping to help you better understand and use this powerful network programming framework.</em></p><div class=blog-footer><div class=social-share></div><div class=copyright><ul><li style=margin-bottom:.5em>Author: <a href=https://ddhigh.com/ target=_blank style=color:#000;text-decoration:none>xialeistudio</a></li><li style=margin-bottom:.5em>Link: <a href=https://www.ddhigh.com/en/2025/07/12/lunet-high-performance-coroutine-network-library/ target=_blank style=color:#000;text-decoration:none>Lunet: Design and Implementation of a High-Performance Coroutine Network Library</a></li><li>Copyright: <a href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank style=color:#000;text-decoration:none>「CC BY-NC 4.0 DEED」</a></li></ul></div></div></section><div class=paginator><a class=next href=https://www.ddhigh.com/en/2025/03/25/aws-irsa-vs-ec2iam/><span>IRSA vs. EC2 IAM:Usage Scenarios and Permission Management Practices</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div><div class=comments><script>const getTheme=window.localStorage&&window.localStorage.getItem("theme");let theme=getTheme==="dark"?"dark":"light",s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","xialeistudio/discussion"),s.setAttribute("data-repo-id","R_kgDOKurTRA"),s.setAttribute("data-category","General"),s.setAttribute("data-category-id","DIC_kwDOKurTRM4CbCJt"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",theme),s.setAttribute("data-lang","en"),s.setAttribute("data-loading","lazy"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></article></div><footer class=footer><p>&copy; 2014 - 2025 <a href=https://www.ddhigh.com>每天进步一点点</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script><script src=https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js integrity="sha512-9DNXrSjk17bU9MUbRp3IjwcWe46V8FaGA062PFbryPUAEQVRbz4jiZP6FW0AdbqEGtMYBDWnul3eiGBMJOQajA==" crossorigin=anonymous referrerpolicy=no-referrer></script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>