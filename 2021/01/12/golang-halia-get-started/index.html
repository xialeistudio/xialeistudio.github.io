<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><title>Golang组件化网络服务器框架Halia指南</title>
<meta charset=utf-8><meta name=description content="Ladder@写在前面 在netty框架面世之前，几乎没有一个成熟的OOP/组件化规范指导网络服务器开发，一些常用的FrameDecoder,BusinessHandler等等组件紧密耦合在了项目当中，整个项目可以说扩展性比较差。
netty的出现可以说是划时代的，基于OOP/组件化屏蔽了底层 BlockingIO/NonBlockingIO/AsynchrousIO之间的差异，各种组件可以无缝切换，网络服务器开发效率有了非常大的提高。
通过阅读netty源码，以及核心组件的架构，基于Golang进行了实现，至此，Golang的Halia框架面世了！
Halia特性 组件化/可扩展 Halia框架面向接口编程，并提供默认实现，同时内置常用的解码器，真正做到开箱即用。
高性能 基于Golang原生网络库进行开发，无第三方依赖，性能有保障。
易用性 Halia框架采用极简设计，没有冗余代码，并附带3个常用解码器示例，助您基于Halia快速开始开发。
开源免费 Halia框架基于MIT开源协议发布，无论是商用以及非商用都可以免费使用。
社区驱动 Halia框架托管于Github，任何人都可以贡献一臂之力。
快速开始 接下来将演示如何开发一个时间回显服务器。
客户端每隔1秒发送时间字符串给服务器，服务器回显该数据。
公用代码 encoder.go 字符串编码器，将字符串转换为[]byte传输到下一个出站处理器
package main import ( &#34;halia/channel&#34; ) type StringToByteEncoder struct{} // 编码器不处理处理，交由下一个处理器(也就是业务处理器)处理 func (e *StringToByteEncoder) OnError(c channel.HandlerContext, err error) { c.FireOnError(err) } func (e *StringToByteEncoder) Write(c channel.HandlerContext, msg interface{}) error { if str, ok := msg.(string); ok { // string才转换 return c.Write([]byte(str)) } return c.Write(msg) } func (e *StringToByteEncoder) Flush(c channel."><meta name=author content="Lei Xia"><link rel=canonical href=https://www.ddhigh.com/2021/01/12/golang-halia-get-started/><link rel=alternate type=application/rss+xml href=https://www.ddhigh.com/index.xml title="Lei Xia"><script async defer data-website-id=865c8529-0729-4cf5-88a9-448616abbcbb src=https://umami-beta-peach.vercel.app/xialeistudio></script><meta property="og:title" content="Golang组件化网络服务器框架Halia指南"><meta property="og:description" content="写在前面 在netty框架面世之前，几乎没有一个成熟的OOP/组件化规范指导网络服务器开发，一些常用的FrameDecoder,BusinessHandler等等组件紧密耦合在了项目当中，整个项目可以说扩展性比较差。
netty的出现可以说是划时代的，基于OOP/组件化屏蔽了底层 BlockingIO/NonBlockingIO/AsynchrousIO之间的差异，各种组件可以无缝切换，网络服务器开发效率有了非常大的提高。
通过阅读netty源码，以及核心组件的架构，基于Golang进行了实现，至此，Golang的Halia框架面世了！
Halia特性 组件化/可扩展 Halia框架面向接口编程，并提供默认实现，同时内置常用的解码器，真正做到开箱即用。
高性能 基于Golang原生网络库进行开发，无第三方依赖，性能有保障。
易用性 Halia框架采用极简设计，没有冗余代码，并附带3个常用解码器示例，助您基于Halia快速开始开发。
开源免费 Halia框架基于MIT开源协议发布，无论是商用以及非商用都可以免费使用。
社区驱动 Halia框架托管于Github，任何人都可以贡献一臂之力。
快速开始 接下来将演示如何开发一个时间回显服务器。
客户端每隔1秒发送时间字符串给服务器，服务器回显该数据。
公用代码 encoder.go 字符串编码器，将字符串转换为[]byte传输到下一个出站处理器
package main import ( &#34;halia/channel&#34; ) type StringToByteEncoder struct{} // 编码器不处理处理，交由下一个处理器(也就是业务处理器)处理 func (e *StringToByteEncoder) OnError(c channel.HandlerContext, err error) { c.FireOnError(err) } func (e *StringToByteEncoder) Write(c channel.HandlerContext, msg interface{}) error { if str, ok := msg.(string); ok { // string才转换 return c.Write([]byte(str)) } return c.Write(msg) } func (e *StringToByteEncoder) Flush(c channel."><meta property="og:type" content="article"><meta property="og:url" content="https://www.ddhigh.com/2021/01/12/golang-halia-get-started/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-12T00:00:00+00:00"><meta property="article:modified_time" content="2021-01-12T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Golang组件化网络服务器框架Halia指南"><meta name=twitter:description content="写在前面 在netty框架面世之前，几乎没有一个成熟的OOP/组件化规范指导网络服务器开发，一些常用的FrameDecoder,BusinessHandler等等组件紧密耦合在了项目当中，整个项目可以说扩展性比较差。
netty的出现可以说是划时代的，基于OOP/组件化屏蔽了底层 BlockingIO/NonBlockingIO/AsynchrousIO之间的差异，各种组件可以无缝切换，网络服务器开发效率有了非常大的提高。
通过阅读netty源码，以及核心组件的架构，基于Golang进行了实现，至此，Golang的Halia框架面世了！
Halia特性 组件化/可扩展 Halia框架面向接口编程，并提供默认实现，同时内置常用的解码器，真正做到开箱即用。
高性能 基于Golang原生网络库进行开发，无第三方依赖，性能有保障。
易用性 Halia框架采用极简设计，没有冗余代码，并附带3个常用解码器示例，助您基于Halia快速开始开发。
开源免费 Halia框架基于MIT开源协议发布，无论是商用以及非商用都可以免费使用。
社区驱动 Halia框架托管于Github，任何人都可以贡献一臂之力。
快速开始 接下来将演示如何开发一个时间回显服务器。
客户端每隔1秒发送时间字符串给服务器，服务器回显该数据。
公用代码 encoder.go 字符串编码器，将字符串转换为[]byte传输到下一个出站处理器
package main import ( &#34;halia/channel&#34; ) type StringToByteEncoder struct{} // 编码器不处理处理，交由下一个处理器(也就是业务处理器)处理 func (e *StringToByteEncoder) OnError(c channel.HandlerContext, err error) { c.FireOnError(err) } func (e *StringToByteEncoder) Write(c channel.HandlerContext, msg interface{}) error { if str, ok := msg.(string); ok { // string才转换 return c.Write([]byte(str)) } return c.Write(msg) } func (e *StringToByteEncoder) Flush(c channel."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.ddhigh.com/posts/"},{"@type":"ListItem","position":3,"name":"Golang组件化网络服务器框架Halia指南","item":"https://www.ddhigh.com/2021/01/12/golang-halia-get-started/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Golang组件化网络服务器框架Halia指南","name":"Golang组件化网络服务器框架Halia指南","description":"写在前面 在netty框架面世之前，几乎没有一个成熟的OOP/组件化规范指导网络服务器开发，一些常用的FrameDecoder,BusinessHandler等等组件紧密耦合在了项目当中，整个项目可以说扩展性比较差。\nnetty的出现可以说是划时代的，基于OOP/组件化屏蔽了底层 BlockingIO/NonBlockingIO/AsynchrousIO之间的差异，各种组件可以无缝切换，网络服务器开发效率有了非常大的提高。\n通过阅读netty源码，以及核心组件的架构，基于Golang进行了实现，至此，Golang的Halia框架面世了！\nHalia特性 组件化/可扩展 Halia框架面向接口编程，并提供默认实现，同时内置常用的解码器，真正做到开箱即用。\n高性能 基于Golang原生网络库进行开发，无第三方依赖，性能有保障。\n易用性 Halia框架采用极简设计，没有冗余代码，并附带3个常用解码器示例，助您基于Halia快速开始开发。\n开源免费 Halia框架基于MIT开源协议发布，无论是商用以及非商用都可以免费使用。\n社区驱动 Halia框架托管于Github，任何人都可以贡献一臂之力。\n快速开始 接下来将演示如何开发一个时间回显服务器。\n客户端每隔1秒发送时间字符串给服务器，服务器回显该数据。\n公用代码 encoder.go 字符串编码器，将字符串转换为[]byte传输到下一个出站处理器\npackage main import ( \u0026#34;halia/channel\u0026#34; ) type StringToByteEncoder struct{} // 编码器不处理处理，交由下一个处理器(也就是业务处理器)处理 func (e *StringToByteEncoder) OnError(c channel.HandlerContext, err error) { c.FireOnError(err) } func (e *StringToByteEncoder) Write(c channel.HandlerContext, msg interface{}) error { if str, ok := msg.(string); ok { // string才转换 return c.Write([]byte(str)) } return c.Write(msg) } func (e *StringToByteEncoder) Flush(c channel.","keywords":["halia"],"articleBody":"写在前面 在netty框架面世之前，几乎没有一个成熟的OOP/组件化规范指导网络服务器开发，一些常用的FrameDecoder,BusinessHandler等等组件紧密耦合在了项目当中，整个项目可以说扩展性比较差。\nnetty的出现可以说是划时代的，基于OOP/组件化屏蔽了底层 BlockingIO/NonBlockingIO/AsynchrousIO之间的差异，各种组件可以无缝切换，网络服务器开发效率有了非常大的提高。\n通过阅读netty源码，以及核心组件的架构，基于Golang进行了实现，至此，Golang的Halia框架面世了！\nHalia特性 组件化/可扩展 Halia框架面向接口编程，并提供默认实现，同时内置常用的解码器，真正做到开箱即用。\n高性能 基于Golang原生网络库进行开发，无第三方依赖，性能有保障。\n易用性 Halia框架采用极简设计，没有冗余代码，并附带3个常用解码器示例，助您基于Halia快速开始开发。\n开源免费 Halia框架基于MIT开源协议发布，无论是商用以及非商用都可以免费使用。\n社区驱动 Halia框架托管于Github，任何人都可以贡献一臂之力。\n快速开始 接下来将演示如何开发一个时间回显服务器。\n客户端每隔1秒发送时间字符串给服务器，服务器回显该数据。\n公用代码 encoder.go 字符串编码器，将字符串转换为[]byte传输到下一个出站处理器\npackage main import ( \"halia/channel\" ) type StringToByteEncoder struct{} // 编码器不处理处理，交由下一个处理器(也就是业务处理器)处理 func (e *StringToByteEncoder) OnError(c channel.HandlerContext, err error) { c.FireOnError(err) } func (e *StringToByteEncoder) Write(c channel.HandlerContext, msg interface{}) error { if str, ok := msg.(string); ok { // string才转换 return c.Write([]byte(str)) } return c.Write(msg) } func (e *StringToByteEncoder) Flush(c channel.HandlerContext) error { return c.Flush() } 客户端代码 handler.go 客户端业务处理代码。\npackage main import ( \"fmt\" log \"github.com/sirupsen/logrus\" \"halia/channel\" \"strings\" \"time\" ) type EchoClientHandler struct { log *log.Entry } func NewEchoClientHandler() *EchoClientHandler { return \u0026EchoClientHandler{ log: log.WithField(\"component\", \"EchoClientHandler\"), } } // 发送错误回调 func (p *EchoClientHandler) OnError(c channel.HandlerContext, err error) { p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Warnln(\"error caught\", err) } // 连接已建立 func (p *EchoClientHandler) ChannelActive(c channel.HandlerContext) { p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Infoln(\"connected\") if err := c.WriteAndFlush(\"Hello World\\r\\n\"); err != nil { p.log.WithError(err).Warnln(\"write error\") } p.log.Infof(\"pipeline in: %v\", strings.Join(c.Pipeline().InboundNames(), \"-\u003e\")) p.log.Infof(\"pipeline out: %v\", strings.Join(c.Pipeline().OutboundNames(), \"-\u003e\")) } // 连接已断开 func (p *EchoClientHandler) ChannelInActive(c channel.HandlerContext) { p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Infoln(\"disconnected\") } // 读取到完整的消息回调 func (p *EchoClientHandler) ChannelRead(c channel.HandlerContext, msg interface{}) { data, ok := msg.([]byte) if !ok { p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Warnf(\"unknown msg type: %+v\", msg) return } str := string(data) p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Infoln(\"receive \", str) // 1秒后发送数据给服务器 time.AfterFunc(time.Second, func() { if err := c.WriteAndFlush(fmt.Sprintf(\"client say:%s\\r\\n\", time.Now().String())); err != nil { p.log.WithError(err).Warnln(\"write error\") } }) } main.go package main import ( log \"github.com/sirupsen/logrus\" \"halia/bootstrap\" \"halia/channel\" \"halia/handler/codec\" \"net\" \"os\" ) func init() { log.SetOutput(os.Stdout) log.SetLevel(log.DebugLevel) } func main() { client := bootstrap.NewClient(\u0026bootstrap.ClientOptions{ // 将原始net.Conn包装为Channel实现，一般情况下用DefaultChannel即可 ChannelFactory: func(conn net.Conn) channel.Channel { c := channel.NewDefaultChannel(conn) // 添加解码器，换行符分割报文解码器 c.Pipeline().AddInbound(\"decoder\", codec.NewLineBasedFrameDecoder()) // 添加业务处理器 c.Pipeline().AddInbound(\"handler\", NewEchoClientHandler()) // 添加编码器 c.Pipeline().AddOutbound(\"encoder\", \u0026StringToByteEncoder{}) return c }, }) // 连接服务器 log.WithField(\"component\", \"client\").Fatal(client.Dial(\"tcp\", \"127.0.0.1:8080\")) } 服务端代码 handler.go package main import ( log \"github.com/sirupsen/logrus\" \"halia/channel\" \"strings\" ) type EchoServerHandler struct { log *log.Entry } func NewEchoServerHandler() *EchoServerHandler { return \u0026EchoServerHandler{ log: log.WithField(\"component\", \"EchoServerHandler\"), } } func (p *EchoServerHandler) OnError(c channel.HandlerContext, err error) { p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Warnln(\"error caught\", err) } func (p *EchoServerHandler) ChannelActive(c channel.HandlerContext) { p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Infoln(\"connected\") p.log.Infof(\"pipeline in: %v\", strings.Join(c.Pipeline().InboundNames(), \"-\u003e\")) p.log.Infof(\"pipeline out: %v\", strings.Join(c.Pipeline().OutboundNames(), \"-\u003e\")) } func (p *EchoServerHandler) ChannelInActive(c channel.HandlerContext) { p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Infoln(\"disconnected\") p.log.Infof(\"pipeline in: %v\", strings.Join(c.Pipeline().InboundNames(), \"-\u003e\")) p.log.Infof(\"pipeline out: %v\", strings.Join(c.Pipeline().OutboundNames(), \"-\u003e\")) } func (p *EchoServerHandler) ChannelRead(c channel.HandlerContext, msg interface{}) { data, ok := msg.([]byte) if !ok { p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Warnf(\"unknown msg type: %+v\", msg) return } str := string(data) p.log.WithField(\"peer\", c.Channel().RemoteAddr()).Infoln(\"receive \", str) if err := c.Write(\"server:\" + str + \"\\r\\n\"); err != nil { p.log.WithField(\"peer\", c.Channel().RemoteAddr()).WithError(err).Warnln(\"write error\") } } main.go package main import ( log \"github.com/sirupsen/logrus\" \"halia/bootstrap\" \"halia/channel\" \"halia/handler/codec\" \"net\" \"os\" ) func init() { log.SetOutput(os.Stdout) log.SetLevel(log.DebugLevel) } func main() { s := bootstrap.NewServer(\u0026bootstrap.ServerOptions{ ChannelFactory: func(conn net.Conn) channel.Channel { c := channel.NewDefaultChannel(conn) c.Pipeline().AddInbound(\"decoder\", codec.NewLineBasedFrameDecoder()) c.Pipeline().AddInbound(\"handler\", NewEchoServerHandler()) c.Pipeline().AddOutbound(\"encoder\", \u0026StringToByteEncoder{}) return c }, }) log.WithField(\"component\", \"server\").Fatal(s.Listen(\"tcp\", \"0.0.0.0:8080\")) } 运行 先运行服务端，再运行客户端。\n服务端输出\ntime=\"2021-01-12T11:30:13+08:00\" level=info msg=started addr=\"0.0.0.0:8080\" component=server network=tcp pid=7584 time=\"2021-01-12T11:30:13+08:00\" level=info msg=initialized component=channelId machineId=a0c5895a25a3 pid=7584 time=\"2021-01-12T11:30:18+08:00\" level=info msg=connected component=EchoServerHandler peer=\"127.0.0.1:57641\" time=\"2021-01-12T11:30:18+08:00\" level=info msg=\"pipeline in: InHeadContext-\u003edecoder-\u003ehandler\" component=EchoServerHandler time=\"2021-01-12T11:30:18+08:00\" level=info msg=\"pipeline out: OutHeadContext-\u003eencoder-\u003eOutTailContext\" component=EchoServerHandler time=\"2021-01-12T11:30:18+08:00\" level=info msg=\"receive Hello World\" component=EchoServerHandler peer=\"127.0.0.1:57641\" time=\"2021-01-12T11:30:19+08:00\" level=info msg=\"receive client say:2021-01-12 11:30:19.5192868 +0800 CST m=+1.046443501\" component=EchoServerHandler peer=\"127.0.0.1:57641\" time=\"2021-01-12T11:30:20+08:00\" level=info msg=\"receive client say:2021-01-12 11:30:20.5193884 +0800 CST m=+2.046545101\" component=EchoServerHandler peer=\"127.0.0.1:57641\" time=\"2021-01-12T11:30:21+08:00\" level=info msg=\"receive client say:2021-01-12 11:30:21.5345887 +0800 CST m=+3.061745401\" component=EchoServerHandler peer=\"127.0.0.1:57641\" time=\"2021-01-12T11:30:22+08:00\" level=info msg=\"receive client say:2021-01-12 11:30:22.5459978 +0800 CST m=+4.073154501\" component=EchoServerHandler peer=\"127.0.0.1:57641\" 客户端输出\ntime=\"2021-01-12T11:30:18+08:00\" level=info msg=connected component=EchoClientHandler peer=\"127.0.0.1:8080\" time=\"2021-01-12T11:30:18+08:00\" level=info msg=\"pipeline in: InHeadContext-\u003edecoder-\u003ehandler\" component=EchoClientHandler time=\"2021-01-12T11:30:18+08:00\" level=info msg=\"pipeline out: OutHeadContext-\u003eencoder-\u003eOutTailContext\" component=EchoClientHandler time=\"2021-01-12T11:30:18+08:00\" level=info msg=\"receive server:Hello World\" component=EchoClientHandler peer=\"127.0.0.1:8080\" time=\"2021-01-12T11:30:18+08:00\" level=info msg=initialized component=channelId machineId=a0c5895a25a3 pid=960 time=\"2021-01-12T11:30:19+08:00\" level=info msg=\"receive server:client say:2021-01-12 11:30:19.5192868 +0800 CST m=+1.046443501\" component=EchoClientHandler peer=\"127.0.0.1:8080\" time=\"2021-01-12T11:30:20+08:00\" level=info msg=\"receive server:client say:2021-01-12 11:30:20.5193884 +0800 CST m=+2.046545101\" component=EchoClientHandler peer=\"127.0.0.1:8080\" time=\"2021-01-12T11:30:21+08:00\" level=info msg=\"receive server:client say:2021-01-12 11:30:21.5345887 +0800 CST m=+3.061745401\" component=EchoClientHandler peer=\"127.0.0.1:8080\" time=\"2021-01-12T11:30:22+08:00\" level=info msg=\"receive server:client say:2021-01-12 11:30:22.5459978 +0800 CST m=+4.073154501\" component=EchoClientHandler peer=\"127.0.0.1:8080\" 写在后面 Halia期待您的贡献！\n文档地址 仓库地址 ","wordCount":"614","inLanguage":"en","datePublished":"2021-01-12T00:00:00Z","dateModified":"2021-01-12T00:00:00Z","author":{"@type":"Person","name":"Lei Xia"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ddhigh.com/2021/01/12/golang-halia-get-started/"},"publisher":{"@type":"Organization","name":"Lei Xia","logo":{"@type":"ImageObject","url":"https://www.ddhigh.com/favicon.ico"}}}</script><link rel=icon href=/img/favicon.ico sizes=16x16><link rel=apple-touch-icon href=/img/favicon.ico><link rel=manifest href=/img/favicon.ico><link rel=stylesheet href=https://cdn.staticfile.org/lxgw-wenkai-webfont/1.6.0/style.css><link rel=stylesheet href=/css/main.min.ff1bc260fafbfb440e10194d7d06d57eb5e85eed11d12d06255581262664204e.css integrity="sha256-/xvCYPr7+0QOEBlNfQbVfrXoXu0R0S0GJVWBJiZkIE4=" crossorigin=anonymous media=screen><link rel=stylesheet href=/scss/highlight/github-dark.min.min.66034289ee9a113219a2c4aae0a8bd2095ab255c832a42efcf5863f10814e7a1.css><script src=/js/highlight.min.min.894ca9c68afab956438c4926a0dc7f5293e04e08595bd27abdb123e94801f684.js></script><script>hljs.highlightAll()</script><script>(()=>{var t=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,e=localStorage.getItem("theme");t&&e===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),t&&e==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),e==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script></head><body><main class=wrapper><nav class=navigation><section class=container><a class=navigation-brand href=/>HOME
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><span></span><span></span><span></span></label><ul class=navigation-list id=navigation-list><li class="navigation-item navigation-menu"><a class=navigation-link href=/archives>Archive</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/tags>Tags</a></li><li class="navigation-item navigation-menu"><a class=navigation-link href=/guestbook>Guestbook</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class="navigation-item navigation-social"><a class=navigation-link href=https://github.com/xialeistudio><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li class="navigation-item navigation-dark"><button id=mode type=button aria-label="toggle user light or dark theme">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></li></ul></section></nav><div id=content><article class=blog-single><header class=blog-title><h1>Golang组件化网络服务器框架Halia指南</h1></header><p><small>January 12, 2021&nbsp;· 614 words&nbsp;· 3 min</small><p><div class=blog-toc><nav id=TableOfContents><ul><li><a href=#写在前面>写在前面</a></li><li><a href=#halia特性>Halia特性</a><ul><li><a href=#组件化可扩展>组件化/可扩展</a></li><li><a href=#高性能>高性能</a></li><li><a href=#易用性>易用性</a></li><li><a href=#开源免费>开源免费</a></li><li><a href=#社区驱动>社区驱动</a></li></ul></li><li><a href=#快速开始>快速开始</a><ul><li><a href=#公用代码>公用代码</a></li><li><a href=#客户端代码>客户端代码</a></li><li><a href=#服务端代码>服务端代码</a></li><li><a href=#运行>运行</a></li></ul></li><li><a href=#写在后面>写在后面</a></li></ul></nav></div><section class=blog-content><h2 id=写在前面>写在前面</h2><p>在<strong>netty</strong>框架面世之前，几乎没有一个成熟的OOP/组件化规范指导网络服务器开发，一些常用的<code>FrameDecoder</code>,<code>BusinessHandler</code>等等组件紧密耦合在了项目当中，整个项目可以说扩展性比较差。</p><p>netty的出现可以说是划时代的，基于OOP/组件化屏蔽了底层 <strong>BlockingIO</strong>/<strong>NonBlockingIO</strong>/<strong>AsynchrousIO</strong>之间的差异，各种组件可以无缝切换，网络服务器开发效率有了非常大的提高。</p><p>通过阅读netty源码，以及核心组件的架构，基于Golang进行了实现，至此，Golang的Halia框架面世了！</p><h2 id=halia特性>Halia特性</h2><h3 id=组件化可扩展>组件化/可扩展</h3><p>Halia框架面向接口编程，并提供默认实现，同时内置常用的解码器，真正做到开箱即用。</p><h3 id=高性能>高性能</h3><p>基于Golang原生网络库进行开发，无第三方依赖，性能有保障。</p><h3 id=易用性>易用性</h3><p>Halia框架采用极简设计，没有冗余代码，并附带3个常用解码器示例，助您基于Halia快速开始开发。</p><h3 id=开源免费>开源免费</h3><p>Halia框架基于MIT开源协议发布，无论是商用以及非商用都可以免费使用。</p><h3 id=社区驱动>社区驱动</h3><p>Halia框架托管于Github，任何人都可以贡献一臂之力。</p><h2 id=快速开始>快速开始</h2><p>接下来将演示如何开发一个时间回显服务器。</p><p>客户端每隔1秒发送时间字符串给服务器，服务器回显该数据。</p><h3 id=公用代码>公用代码</h3><h4 id=encodergo>encoder.go</h4><p>字符串编码器，将字符串转换为<code>[]byte</code>传输到下一个出站处理器</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;halia/channel&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>StringToByteEncoder</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span><span style=color:#75715e>// 编码器不处理处理，交由下一个处理器(也就是业务处理器)处理
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>StringToByteEncoder</span>) <span style=color:#a6e22e>OnError</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>FireOnError</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>StringToByteEncoder</span>) <span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>, <span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>interface</span>{}) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>str</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>msg</span>.(<span style=color:#66d9ef>string</span>); <span style=color:#a6e22e>ok</span> { <span style=color:#75715e>// string才转换
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Write</span>([]byte(<span style=color:#a6e22e>str</span>))
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#a6e22e>msg</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>StringToByteEncoder</span>) <span style=color:#a6e22e>Flush</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Flush</span>()
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=客户端代码>客户端代码</h3><h4 id=handlergo>handler.go</h4><p>客户端业务处理代码。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span> <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;halia/channel&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;time&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EchoClientHandler</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Entry</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewEchoClientHandler</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoClientHandler</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>EchoClientHandler</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>: <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;component&#34;</span>, <span style=color:#e6db74>&#34;EchoClientHandler&#34;</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// 发送错误回调
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoClientHandler</span>) <span style=color:#a6e22e>OnError</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Warnln</span>(<span style=color:#e6db74>&#34;error caught&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// 连接已建立
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoClientHandler</span>) <span style=color:#a6e22e>ChannelActive</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Infoln</span>(<span style=color:#e6db74>&#34;connected&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>WriteAndFlush</span>(<span style=color:#e6db74>&#34;Hello World\r\n&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithError</span>(<span style=color:#a6e22e>err</span>).<span style=color:#a6e22e>Warnln</span>(<span style=color:#e6db74>&#34;write error&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;pipeline in: %v&#34;</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>InboundNames</span>(), <span style=color:#e6db74>&#34;-&gt;&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;pipeline out: %v&#34;</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>OutboundNames</span>(), <span style=color:#e6db74>&#34;-&gt;&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 连接已断开
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoClientHandler</span>) <span style=color:#a6e22e>ChannelInActive</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Infoln</span>(<span style=color:#e6db74>&#34;disconnected&#34;</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 读取到完整的消息回调
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoClientHandler</span>) <span style=color:#a6e22e>ChannelRead</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>, <span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>msg</span>.([]<span style=color:#66d9ef>byte</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Warnf</span>(<span style=color:#e6db74>&#34;unknown msg type: %+v&#34;</span>, <span style=color:#a6e22e>msg</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>str</span> <span style=color:#f92672>:=</span> string(<span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Infoln</span>(<span style=color:#e6db74>&#34;receive &#34;</span>, <span style=color:#a6e22e>str</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 1秒后发送数据给服务器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>AfterFunc</span>(<span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Second</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>WriteAndFlush</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;client say:%s\r\n&#34;</span>, <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Now</span>().<span style=color:#a6e22e>String</span>())); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithError</span>(<span style=color:#a6e22e>err</span>).<span style=color:#a6e22e>Warnln</span>(<span style=color:#e6db74>&#34;write error&#34;</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=maingo>main.go</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span> <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;halia/bootstrap&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;halia/channel&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;halia/handler/codec&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetOutput</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetLevel</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>DebugLevel</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>client</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bootstrap</span>.<span style=color:#a6e22e>NewClient</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>bootstrap</span>.<span style=color:#a6e22e>ClientOptions</span>{
</span></span><span style=display:flex><span>        <span style=color:#75715e>// 将原始net.Conn包装为Channel实现，一般情况下用DefaultChannel即可
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>ChannelFactory</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>conn</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>Conn</span>) <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>Channel</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>NewDefaultChannel</span>(<span style=color:#a6e22e>conn</span>)
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 添加解码器，换行符分割报文解码器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>AddInbound</span>(<span style=color:#e6db74>&#34;decoder&#34;</span>, <span style=color:#a6e22e>codec</span>.<span style=color:#a6e22e>NewLineBasedFrameDecoder</span>())
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 添加业务处理器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>AddInbound</span>(<span style=color:#e6db74>&#34;handler&#34;</span>, <span style=color:#a6e22e>NewEchoClientHandler</span>())
</span></span><span style=display:flex><span>            <span style=color:#75715e>// 添加编码器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>AddOutbound</span>(<span style=color:#e6db74>&#34;encoder&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>StringToByteEncoder</span>{})
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>	<span style=color:#75715e>// 连接服务器
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;component&#34;</span>, <span style=color:#e6db74>&#34;client&#34;</span>).<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>Dial</span>(<span style=color:#e6db74>&#34;tcp&#34;</span>, <span style=color:#e6db74>&#34;127.0.0.1:8080&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=服务端代码>服务端代码</h3><h4 id=handlergo-1>handler.go</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span> <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;halia/channel&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;strings&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EchoServerHandler</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Entry</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewEchoServerHandler</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoServerHandler</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>EchoServerHandler</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>log</span>: <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;component&#34;</span>, <span style=color:#e6db74>&#34;EchoServerHandler&#34;</span>),
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoServerHandler</span>) <span style=color:#a6e22e>OnError</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>, <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Warnln</span>(<span style=color:#e6db74>&#34;error caught&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoServerHandler</span>) <span style=color:#a6e22e>ChannelActive</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Infoln</span>(<span style=color:#e6db74>&#34;connected&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;pipeline in: %v&#34;</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>InboundNames</span>(), <span style=color:#e6db74>&#34;-&gt;&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;pipeline out: %v&#34;</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>OutboundNames</span>(), <span style=color:#e6db74>&#34;-&gt;&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoServerHandler</span>) <span style=color:#a6e22e>ChannelInActive</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Infoln</span>(<span style=color:#e6db74>&#34;disconnected&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;pipeline in: %v&#34;</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>InboundNames</span>(), <span style=color:#e6db74>&#34;-&gt;&#34;</span>))
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Infof</span>(<span style=color:#e6db74>&#34;pipeline out: %v&#34;</span>, <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>OutboundNames</span>(), <span style=color:#e6db74>&#34;-&gt;&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>EchoServerHandler</span>) <span style=color:#a6e22e>ChannelRead</span>(<span style=color:#a6e22e>c</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>HandlerContext</span>, <span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>interface</span>{}) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>msg</span>.([]<span style=color:#66d9ef>byte</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Warnf</span>(<span style=color:#e6db74>&#34;unknown msg type: %+v&#34;</span>, <span style=color:#a6e22e>msg</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>str</span> <span style=color:#f92672>:=</span> string(<span style=color:#a6e22e>data</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>Infoln</span>(<span style=color:#e6db74>&#34;receive &#34;</span>, <span style=color:#a6e22e>str</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Write</span>(<span style=color:#e6db74>&#34;server:&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>str</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;\r\n&#34;</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;peer&#34;</span>, <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Channel</span>().<span style=color:#a6e22e>RemoteAddr</span>()).<span style=color:#a6e22e>WithError</span>(<span style=color:#a6e22e>err</span>).<span style=color:#a6e22e>Warnln</span>(<span style=color:#e6db74>&#34;write error&#34;</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=maingo-1>main.go</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span> <span style=color:#e6db74>&#34;github.com/sirupsen/logrus&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;halia/bootstrap&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;halia/channel&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;halia/handler/codec&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;net&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetOutput</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>SetLevel</span>(<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>DebugLevel</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bootstrap</span>.<span style=color:#a6e22e>NewServer</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>bootstrap</span>.<span style=color:#a6e22e>ServerOptions</span>{
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>ChannelFactory</span>: <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>conn</span> <span style=color:#a6e22e>net</span>.<span style=color:#a6e22e>Conn</span>) <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>Channel</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>channel</span>.<span style=color:#a6e22e>NewDefaultChannel</span>(<span style=color:#a6e22e>conn</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>AddInbound</span>(<span style=color:#e6db74>&#34;decoder&#34;</span>, <span style=color:#a6e22e>codec</span>.<span style=color:#a6e22e>NewLineBasedFrameDecoder</span>())
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>AddInbound</span>(<span style=color:#e6db74>&#34;handler&#34;</span>, <span style=color:#a6e22e>NewEchoServerHandler</span>())
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Pipeline</span>().<span style=color:#a6e22e>AddOutbound</span>(<span style=color:#e6db74>&#34;encoder&#34;</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>StringToByteEncoder</span>{})
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>
</span></span><span style=display:flex><span>		},
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>WithField</span>(<span style=color:#e6db74>&#34;component&#34;</span>, <span style=color:#e6db74>&#34;server&#34;</span>).<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Listen</span>(<span style=color:#e6db74>&#34;tcp&#34;</span>, <span style=color:#e6db74>&#34;0.0.0.0:8080&#34;</span>))
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=运行>运行</h3><p>先运行服务端，再运行客户端。</p><p>服务端输出</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>time=&#34;2021-01-12T11:30:13+08:00&#34; level=info msg=started addr=&#34;0.0.0.0:8080&#34; component=server network=tcp pid=7584
</span></span><span style=display:flex><span>time=&#34;2021-01-12T11:30:13+08:00&#34; level=info msg=initialized component=channelId machineId=a0c5895a25a3 pid=7584
</span></span><span style=display:flex><span>time=&#34;2021-01-12T11:30:18+08:00&#34; level=info msg=connected component=EchoServerHandler peer=&#34;127.0.0.1:57641&#34;
</span></span><span style=display:flex><span>time=&#34;2021-01-12T11:30:18+08:00&#34; level=info msg=&#34;pipeline in: InHeadContext-&gt;decoder-&gt;handler&#34; component=EchoServerHandler
</span></span><span style=display:flex><span>time=&#34;2021-01-12T11:30:18+08:00&#34; level=info msg=&#34;pipeline out: OutHeadContext-&gt;encoder-&gt;OutTailContext&#34; component=EchoServerHandler
</span></span><span style=display:flex><span>time=&#34;2021-01-12T11:30:18+08:00&#34; level=info msg=&#34;receive  Hello World&#34; component=EchoServerHandler peer=&#34;127.0.0.1:57641&#34;
</span></span><span style=display:flex><span>time=&#34;2021-01-12T11:30:19+08:00&#34; level=info msg=&#34;receive  client say:2021-01-12 11:30:19.5192868 +0800 CST m=+1.046443501&#34; component=EchoServerHandler peer=&#34;127.0.0.1:57641&#34;
</span></span><span style=display:flex><span>time=&#34;2021-01-12T11:30:20+08:00&#34; level=info msg=&#34;receive  client say:2021-01-12 11:30:20.5193884 +0800 CST m=+2.046545101&#34; component=EchoServerHandler peer=&#34;127.0.0.1:57641&#34;
</span></span><span style=display:flex><span>time=&#34;2021-01-12T11:30:21+08:00&#34; level=info msg=&#34;receive  client say:2021-01-12 11:30:21.5345887 +0800 CST m=+3.061745401&#34; component=EchoServerHandler peer=&#34;127.0.0.1:57641&#34;
</span></span><span style=display:flex><span>time=&#34;2021-01-12T11:30:22+08:00&#34; level=info msg=&#34;receive  client say:2021-01-12 11:30:22.5459978 +0800 CST m=+4.073154501&#34; component=EchoServerHandler peer=&#34;127.0.0.1:57641&#34;
</span></span></code></pre></div><p>客户端输出</p><pre tabindex=0><code>time=&#34;2021-01-12T11:30:18+08:00&#34; level=info msg=connected component=EchoClientHandler peer=&#34;127.0.0.1:8080&#34;
time=&#34;2021-01-12T11:30:18+08:00&#34; level=info msg=&#34;pipeline in: InHeadContext-&gt;decoder-&gt;handler&#34; component=EchoClientHandler
time=&#34;2021-01-12T11:30:18+08:00&#34; level=info msg=&#34;pipeline out: OutHeadContext-&gt;encoder-&gt;OutTailContext&#34; component=EchoClientHandler
time=&#34;2021-01-12T11:30:18+08:00&#34; level=info msg=&#34;receive  server:Hello World&#34; component=EchoClientHandler peer=&#34;127.0.0.1:8080&#34;
time=&#34;2021-01-12T11:30:18+08:00&#34; level=info msg=initialized component=channelId machineId=a0c5895a25a3 pid=960
time=&#34;2021-01-12T11:30:19+08:00&#34; level=info msg=&#34;receive  server:client say:2021-01-12 11:30:19.5192868 +0800 CST m=+1.046443501&#34; component=EchoClientHandler peer=&#34;127.0.0.1:8080&#34;
time=&#34;2021-01-12T11:30:20+08:00&#34; level=info msg=&#34;receive  server:client say:2021-01-12 11:30:20.5193884 +0800 CST m=+2.046545101&#34; component=EchoClientHandler peer=&#34;127.0.0.1:8080&#34;
time=&#34;2021-01-12T11:30:21+08:00&#34; level=info msg=&#34;receive  server:client say:2021-01-12 11:30:21.5345887 +0800 CST m=+3.061745401&#34; component=EchoClientHandler peer=&#34;127.0.0.1:8080&#34;
time=&#34;2021-01-12T11:30:22+08:00&#34; level=info msg=&#34;receive  server:client say:2021-01-12 11:30:22.5459978 +0800 CST m=+4.073154501&#34; component=EchoClientHandler peer=&#34;127.0.0.1:8080&#34;
</code></pre><h2 id=写在后面>写在后面</h2><p>Halia期待您的贡献！</p><ul><li><a href=https://halia-group.github.io/halia/>文档地址</a></li><li><a href=https://github.com/halia-group/halia>仓库地址</a></li></ul><p><img src="https://imgkr2.cn-bj.ufileos.com/ccd85d43-46ce-405b-8efb-6f22c0f9ec3f.png?UCloudPublicKey=TOKEN_8d8b72be-579a-4e83-bfd0-5f6ce1546f13&amp;Signature=APhNQ04SOdsYvwRWMyj6hc%252BUu5s%253D&amp;Expires=1610510873" alt></p></section><div class=paginator><a class=prev href=https://www.ddhigh.com/2021/02/06/go-wire-tutorial/><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M9.94496 9C9.28897 9.61644 7.63215 10.997 6.04814 11.7966 5.98257 11.8297 5.98456 11.9753 6.05061 12.0063c1.00435.4716 2.8788 1.9201 3.89435 2.9937M6.44444 11.9667C8.86549 12.0608 14 12 16 11" stroke="currentcolor" stroke-linecap="round"/></svg><span>golang依赖注入工具wire指南</span></a>
<a class=next href=https://www.ddhigh.com/2020/10/20/laravel-crontab-log-permission/><span>Laravel定时任务写入日志用户变为root导致Web进程无法写入日志问题</span><svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.77086 21.1546C11.0491 22.698 21.4339 21.7773 21.4339 16.3608V4.63375c0-.69413-.075800000000001-1.3284-.2422-1.86588M3.77086 21.1546C1.9934 20.7777.973585 18.7264 1.08749 16.688c.17931-3.209.06972-7.25665-.08236-10.47293C.87809 3.52811 3.12891 1.16316 5.51029 1.25008c4.25565.15534 9.86671-.04779 13.28091-.24466 1.2952-.074686 2.0494.62843 2.4005 1.76245M3.77086 21.1546C4.56586 21.4723 5.49168 21.7879 6.5 22.0658M21.1917 2.76787c1.918 1.4143 1.9383 9.65123 1.7087 13.59293-2.0526 7.6586-10.5943 7.3054-16.4004 5.705M21.1917 2.76787C21.7612 4.51192 22.7203 9.67216 22 16.3608 21.2797 23.0494 11.3665 22.9511 6.5 22.0658M12.055 9C12.711 9.61644 14.3679 10.997 15.9519 11.7966 16.0174 11.8297 16.0154 11.9753 15.9494 12.0063 14.945 12.4779 13.0706 13.9264 12.055 15m3.5006-3.0333C13.1345 12.0608 8 12 6 11" stroke="currentcolor" stroke-linecap="round"/></svg></a></div><div class=comments><script>const getTheme=window.localStorage&&window.localStorage.getItem("theme");let theme=getTheme==="dark"?"dark":"light",s=document.createElement("script");s.src="https://giscus.app/client.js",s.setAttribute("data-repo","xialeistudio/discussion"),s.setAttribute("data-repo-id","R_kgDOKurTRA"),s.setAttribute("data-category","General"),s.setAttribute("data-category-id","DIC_kwDOKurTRM4CbCJt"),s.setAttribute("data-mapping","pathname"),s.setAttribute("data-strict","0"),s.setAttribute("data-reactions-enabled","1"),s.setAttribute("data-emit-metadata","0"),s.setAttribute("data-input-position","bottom"),s.setAttribute("data-theme",theme),s.setAttribute("data-lang","en"),s.setAttribute("data-loading","lazy"),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></article></div><footer class=footer><p>&copy; 2014 - 2023 <a href=https://www.ddhigh.com>Lei Xia</a>
Powered by
<a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>
<a href=https://github.com/guangzhengli/hugo-theme-ladder rel=noopener target=_blank>Ladder</a>
<a href=https://umami-beta-peach.vercel.app/ target=_blank>Statistics</a>
️</p></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5376 22.7916C11.0152 22.7207 22.5795 21.1781 22.0978 10.4211 22.0536 9.43274 21.9303 8.53367 21.7387 7.71865M10.5376 22.7916C16.876 22.3728 20.0969 19.8899 21.5383 16.9142M10.5376 22.7916C9.7707 22.9055 8.97982 22.8964 8.19743 22.7725M21.7387 7.71865C21.4988 6.69828 21.1518 5.80967 20.7188 5.04257m1.0199 2.67608C22.6022 10.1105 23.0542 13.7848 21.5383 16.9142M20.7188 5.04257c-3.5504-6.28886-12.88753-4.410077-16.44303.0C2.88063 6.77451-.0433281 11.1668 1.38159 16.6571c.89322 3.4417 3.7911 5.6365 6.81584 6.1154M20.7188 5.04257c1.3509 1.89783 3.3111 6.34223 1.6353 10.37273M21.5383 16.9142C21.8737 16.4251 22.1428 15.9235 22.3541 15.4153M8.19743 22.7725C12.1971 23.4683 20.6281 22.971 22.3541 15.4153M14 10.945C13.3836 10.289 12.003 8.63215 11.2034 7.04814 11.1703 6.98257 11.0247 6.98456 10.9937 7.05061 10.5221 8.05496 9.07362 9.92941 8 10.945m3.0333-3.50056C10.9392 9.86549 11 15 12 17" stroke="currentcolor" stroke-linecap="round"/></svg></a><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const s=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Copy";function n(){t.innerHTML="Copied",setTimeout(()=>{t.innerHTML="Copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),n();return}const s=document.createRange();s.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(s);try{document.execCommand("copy"),n()}catch{}o.removeRange(s)}),e.parentNode.appendChild(t)})</script></main></body><script src=https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin=anonymous referrerpolicy=no-referrer></script><script>const images=Array.from(document.querySelectorAll(".blog-content img"));images.forEach(e=>{mediumZoom(e,{margin:10,scrollOffset:40,container:null,template:null,background:"rgba(0, 0, 0, 0.5)"})})</script><script src=/main.min.6bb26b69159420159c74dc9e097b06a578ed2b68c701466a91a44a9632d851bd0af167a1b30012387b4c512b48ad9ad4d3394e04d77ae38d57e1920fe4ed34fe.js integrity="sha512-a7JraRWUIBWcdNyeCXsGpXjtK2jHAUZqkaRKljLYUb0K8WehswASOHtMUStIrZrU0zlOBNd6441X4ZIP5O00/g==" crossorigin=anonymous defer></script></html>